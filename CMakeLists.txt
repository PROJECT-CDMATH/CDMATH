# nom du projet
PROJECT(CDMAT)
# version minimum de cmake
CMAKE_MINIMUM_REQUIRED(VERSION 2.8)

SET(MESH_DIR ${CDMAT_SOURCE_DIR}/mesh)
SET(CDMATH_SWIG_DIR ${CDMAT_SOURCE_DIR}/cdmath_swig)
SET(FV_DIR ${CDMAT_SOURCE_DIR}/finite_volume)
SET(AMR_DIR ${CDMAT_SOURCE_DIR}/amr)
SET(PRE_REQUIS_DIR ${CDMAT_SOURCE_DIR}/pre_requis)
SET(INTERP_KERNEL_DIR ${PRE_REQUIS_DIR}/INTERP_KERNEL)
SET(MED_COUPLING_DIR ${PRE_REQUIS_DIR}/MEDCoupling)
SET(MED_COUPLING_SWIG_DIR ${PRE_REQUIS_DIR}/MEDCoupling_Swig)
SET(MED_LOADER_DIR ${PRE_REQUIS_DIR}/MEDLoader)
SET(HDF5_DIR ${PRE_REQUIS_DIR}/HDF5)
SET(MED3_DIR ${PRE_REQUIS_DIR}/MEDFile)

SET(TESTS_DIR ${CDMAT_SOURCE_DIR}/tests)
SET(CMAKE_FILES_DIR ${CDMAT_SOURCE_DIR}/cmake_files)

INCLUDE(${CMAKE_FILES_DIR}/FindPYTHON.cmake)
FIND_PACKAGE(SWIG REQUIRED)

SET (HDF5_DEFINITIONS "-DH5_USE_16_API -D_HDF5USEDLL_")
SET (HDF_INSTALL_DIR ${CMAKE_CURRENT_BINARY_DIR}/pre_requis/HDF5)
SET (HDF5_INCLUDE_DIRS ${HDF_INSTALL_DIR}/include)
SET (HDF5_LIB ${HDF_INSTALL_DIR}/lib/libhdf5.so)
SET (HDF5_LIBS ${HDF5_LIB})

SET (MACHINE PCLINUX)
SET (MED3_DEFINITIONS "-D${MACHINE}")
SET (MED_INSTALL_DIR ${CMAKE_CURRENT_BINARY_DIR}/pre_requis/MEDFile)
SET (MED3_INCLUDE_DIRS ${CMAKE_CURRENT_SOURCE_DIR}/pre_requis/MEDFile/include ${CMAKE_CURRENT_BINARY_DIR}/pre_requis/MEDFile/include)
SET (MED3_LIB ${CMAKE_CURRENT_BINARY_DIR}/pre_requis/MEDFile/src/libmedC.so)
SET (MED3_LIBS ${MED3_LIB})

ADD_SUBDIRECTORY(${PRE_REQUIS_DIR})
ADD_SUBDIRECTORY(${MESH_DIR})
#ADD_SUBDIRECTORY(${REP_FV})
ADD_SUBDIRECTORY(${AMR_DIR})
IF (CMAKE_CDMATH_SWIG)
ADD_SUBDIRECTORY(${CDMATH_SWIG_DIR})
ENDIF (CMAKE_CDMATH_SWIG)

IF (CMAKE_CDMATH_TESTS)
    SET(CMAKE_EXE_LINKER_FLAGS "-pg -fprofile-arcs -ftest-coverage -lgcov")
    enable_testing()
    INCLUDE(${CMAKE_FILES_DIR}/FindCPPUNIT.cmake)
    ADD_SUBDIRECTORY(${TESTS_DIR})
ENDIF (CMAKE_CDMATH_TESTS)

