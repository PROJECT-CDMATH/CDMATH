<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>MED fichier: Concepts et fonctionnalit&eacute;s avanc&eacute;s sur les champs de r&eacute;sultat</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Généré par Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Documentation&nbsp;MED</span></a></li>
      <li class="current"><a href="pages.html"><span>Guides&nbsp;d'utilisation</span></a></li>
      <li><a href="modules.html"><span>Guides&nbsp;de&nbsp;référence</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="champ_avances">Concepts et fonctionnalit&eacute;s avanc&eacute;s sur les champs de r&eacute;sultat </a></h1><p><a class="anchor" id="____Concepts et fonctionnalit&eacute;s avanc&eacute;s sur les champs de r&eacute;sultat____"></a>  <a href="#1.">Cr&eacute;er et lire des champs avec gestion des profils</a>  </p>
<p><a href="#2.">Lire des champs cr&eacute;&eacute;s avec MED 2.x et d&eacute;finis sur plusieurs maillages</a>  </p>
<p><a href="#3.">Cr&eacute;er et lire un champ aux points d'int&eacute;gration des &eacute;l&eacute;ments</a>  </p>
<p><a href="#4.">Cr&eacute;er et lire un champ aux noeuds des &eacute;l&eacute;ments</a>  </p>
<p><a href="#5.">Cr&eacute;er et lire un champ li&eacute; &agrave; un maillage contenant des &eacute;l&eacute;ments de structure </a>  </p>
<p><a href="#6.">Ecrire et lire un maillage ou un champ en filtrant les donn&eacute;es</a>  </p>
<p><a href="#7.">Ecriture et lecture en parall&egrave;le dans un seul fichier</a>  </p>
<h3><a class="anchor" id="1."></a>Cr&eacute;er et lire des champs avec gestion des profils </h3>
<p>Au m&ecirc;me titre que pour un maillage &eacute;volutif, il est possible d'utiliser les profils pour s&eacute;lectionner les valeurs des champs de r&eacute;sultats. Les champs ne peuvent &ecirc;tre definis que sur une partie du maillage. Le profil d'un champ indique sur quelles entit&eacute;s du maillage se trouvent les valeurs. </p>
<p>A l'&eacute;criture des champs, l'utilisation des profils est possible pour l'&eacute;criture des valeurs du champ avec les routines <a class="el" href="a01004_gac369c1fc64c95923cadfc39e41ea8f8d.html#gac369c1fc64c95923cadfc39e41ea8f8d">MEDfieldValueWithProfileWr</a> / <a class="el" href="a01019_ga3e49d45076713d2d77de749dd166b9f8.html#ga3e49d45076713d2d77de749dd166b9f8">mfdrpw</a>, <a class="el" href="a01019_ga5078f5a9b967e74da8eff4d25a467d99.html#ga5078f5a9b967e74da8eff4d25a467d99">mfdipw</a>. </p>
<div class="fragment"><pre class="fragment"><span class="comment">/*  This file is part of MED.</span>
<span class="comment"> *</span>
<span class="comment"> *  COPYRIGHT (C) 1999 - 2012  EDF R&amp;D, CEA/DEN</span>
<span class="comment"> *  MED is free software: you can redistribute it and/or modify</span>
<span class="comment"> *  it under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> *  the Free Software Foundation, either version 3 of the License, or</span>
<span class="comment"> *  (at your option) any later version.</span>
<span class="comment"> *</span>
<span class="comment"> *  MED is distributed in the hope that it will be useful,</span>
<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment"> *  GNU Lesser General Public License for more details.</span>
<span class="comment"> *</span>
<span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> *  along with MED.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> */</span>

<span class="comment">/* </span>
<span class="comment"> * Field use case 7 : write a field with computing steps and profiles</span>
<span class="comment"> */</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;med_utils.h&gt;</span>

<span class="preprocessor">#include &lt;string.h&gt;</span>


<span class="keywordtype">int</span> <a class="code" href="a00750_a3c04138a5bfe5d72780bb7e82a18e627.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> fid;
  <span class="keyword">const</span> <span class="keywordtype">char</span> meshname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;2D unstructured mesh&quot;</span>;
  <span class="keyword">const</span> <span class="keywordtype">char</span> fieldname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;TEMPERATURE_FIELD&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> ncomponent = 1;
  <span class="keyword">const</span> <span class="keywordtype">char</span> componentname[<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1] = <span class="stringliteral">&quot;TEMPERATURE&quot;</span>;
  <span class="keyword">const</span> <span class="keywordtype">char</span> componentunit[<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1] = <span class="stringliteral">&quot;C&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> tria3values_step1_profile1[3] = {1000.,               4000.,                      8000.};
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> tria3values_step2_profile1[8] = {1500.,    0.,    0., 4500.,    0.,    0.,    0., 8500.};
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> tria3values_step2_profile2[8] = {   0., 2500., 3500.,    0., 5500., 6500., 7500.,   0.};
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> quad4values_step1[4] = {10000., 20000., 30000., 40000.};
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> quad4values_step2[4] = {15000., 25000., 35000., 45000.};
  <span class="keyword">const</span> <span class="keywordtype">char</span> profile1name[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;MED_TRIA3_PROFILE1&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> profile1[3] = {1, 4, 8}; 
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> profile1size = 3;
  <span class="keyword">const</span> <span class="keywordtype">char</span> profile2name[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;MED_TRIA3_PROFILE2&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> profile2[5] = {2, 3, 5, 6, 7}; 
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> profile2size = 5;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> ntria3 = 8;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nquad4 = 4;
  <span class="keywordtype">int</span> ret=-1;

  <span class="comment">/* file creation */</span>
  fid = <a class="code" href="a01005_ga9376a1654b7bf099c3f8941074c5fdfb.html#ga9376a1654b7bf099c3f8941074c5fdfb" title="Ouverture d&amp;#39;un fichier MED.">MEDfileOpen</a>(<span class="stringliteral">&quot;UsesCase_MEDfield_7.med&quot;</span>,<a class="code" href="a00321_adcd0322de9fec3b5e199ffeda3f44c85.html#adcd0322de9fec3b5e199ffeda3f44c85aa23dd1c18b596924d5f50c8402b84c8e">MED_ACC_CREAT</a>);
  <span class="keywordflow">if</span> (fid &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file creation ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/* create mesh link */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01009_ga08d1c8b15fbab77a11c6b59a0c600c4e.html#ga08d1c8b15fbab77a11c6b59a0c600c4e" title="Cette routine permet d&amp;#39;écrire un lien dans un fichier MED.">MEDlinkWr</a>(fid,meshname,<span class="stringliteral">&quot;./UsesCase_MEDmesh_1.med&quot;</span>) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : create mesh link ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }
  
  <span class="comment">/* create the profiles in the file */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01013_gaf7ec6ed01898dcfe98556f399ed044d1.html#gaf7ec6ed01898dcfe98556f399ed044d1" title="Cette routine permet d&amp;#39;écrire un profil dans un fichier MED.">MEDprofileWr</a>(fid, profile1name, profile1size, profile1 ) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : create profile ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR; 
  }
  
  <span class="keywordflow">if</span> (<a class="code" href="a01013_gaf7ec6ed01898dcfe98556f399ed044d1.html#gaf7ec6ed01898dcfe98556f399ed044d1" title="Cette routine permet d&amp;#39;écrire un profil dans un fichier MED.">MEDprofileWr</a>(fid, profile2name, profile2size, profile2 ) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : create profile ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR; 
  }
  
  <span class="comment">/* field creation : temperature field  : 1 component in celsius degree</span>
<span class="comment">   *                  the mesh is the 2D unstructured mesh of UsecaseMEDmesh_1.c</span>
<span class="comment">   *                  use case.</span>
<span class="comment">   *                  Computation step unit in &apos;ms&apos;</span>
<span class="comment">   */</span> 
  <span class="keywordflow">if</span> (<a class="code" href="a01004_ga8f73c6eb1a1b85f5e1e8bc1823c01ab9.html#ga8f73c6eb1a1b85f5e1e8bc1823c01ab9" title="Cette routine permet de créer un champ dans un fichier.">MEDfieldCr</a>(fid, fieldname, <a class="code" href="a00320_a7d730da9417184bffcdccc90a1749e27.html#a7d730da9417184bffcdccc90a1749e27ad44e111629f7a5811626b87c8b42b3ea">MED_FLOAT64</a>, ncomponent, 
                 componentname, componentunit,<span class="stringliteral">&quot;ms&quot;</span>, meshname) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : create field&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }
  
  <span class="comment">/* two computation steps */</span>
  <span class="comment">/* write values at cell centers : 8 MED_TRIA3 and 4 MED_QUAD4 */</span>

  <span class="comment">/* STEP 1 : dt1 = 5.5, it = 1*/</span>
  <span class="comment">/* MED_TRIA3 : with a profile of 3 values in compact memory storage mode */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01004_gac369c1fc64c95923cadfc39e41ea8f8d.html#gac369c1fc64c95923cadfc39e41ea8f8d" title="Cette routine permet d&amp;#39;écrire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileWr</a>(fid, fieldname, 1, 1, 5.5, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>,<a class="code" href="a00321_a4a1eb7ba296742a6f5eb8b5b23b39670.html#a4a1eb7ba296742a6f5eb8b5b23b39670">MED_TRIA3</a>, 
                                 <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, profile1name, <a class="code" href="a00321_a2acd5f0b336ddb4026fe1dd314fbd1e0.html#a2acd5f0b336ddb4026fe1dd314fbd1e0">MED_NO_LOCALIZATION</a>,
                                 <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>, ntria3,
                                 (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) tria3values_step1_profile1) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : write field values on MED_TRIA3&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }
   <span class="comment">/* MED_QUAD4  : with no profile */</span> 
  <span class="keywordflow">if</span> (<a class="code" href="a01004_gac369c1fc64c95923cadfc39e41ea8f8d.html#gac369c1fc64c95923cadfc39e41ea8f8d" title="Cette routine permet d&amp;#39;écrire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileWr</a>(fid, fieldname, 1, 1, 5.5, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>, <a class="code" href="a00321_a24ea9c52f5bde41d9a072925249ec06c.html#a24ea9c52f5bde41d9a072925249ec06c">MED_QUAD4</a>, 
                                 <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, <a class="code" href="a00321_aaa89a5e5e6d32de69614b70cf74e29cc.html#aaa89a5e5e6d32de69614b70cf74e29cc">MED_NO_PROFILE</a>, <a class="code" href="a00321_a2acd5f0b336ddb4026fe1dd314fbd1e0.html#a2acd5f0b336ddb4026fe1dd314fbd1e0">MED_NO_LOCALIZATION</a>,
                                 <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>, nquad4,
                                 (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) quad4values_step1) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : write field values on MED_QUAD4 &quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/* STEP 2 : dt2 = 8.9, it = 1*/</span>
  <span class="comment">/* MED_TRIA3 : with a profile of 3 values then a profile of 5 values in global memory storage mode */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01004_gac369c1fc64c95923cadfc39e41ea8f8d.html#gac369c1fc64c95923cadfc39e41ea8f8d" title="Cette routine permet d&amp;#39;écrire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileWr</a>(fid, fieldname, 2 , 1 , 8.9 , <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>, <a class="code" href="a00321_a4a1eb7ba296742a6f5eb8b5b23b39670.html#a4a1eb7ba296742a6f5eb8b5b23b39670">MED_TRIA3</a>, 
                                 <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da56cfcdcbbab7ddfc577de288697cd291">MED_GLOBAL_PFLMODE</a>, profile1name, <a class="code" href="a00321_a2acd5f0b336ddb4026fe1dd314fbd1e0.html#a2acd5f0b336ddb4026fe1dd314fbd1e0">MED_NO_LOCALIZATION</a>,    
                                 <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>, ntria3,
                                 (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) tria3values_step2_profile1) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : write field values on MED_TRIA3 ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }
  <span class="keywordflow">if</span> (<a class="code" href="a01004_gac369c1fc64c95923cadfc39e41ea8f8d.html#gac369c1fc64c95923cadfc39e41ea8f8d" title="Cette routine permet d&amp;#39;écrire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileWr</a>(fid, fieldname, 2 , 1 , 8.9 , <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>, <a class="code" href="a00321_a4a1eb7ba296742a6f5eb8b5b23b39670.html#a4a1eb7ba296742a6f5eb8b5b23b39670">MED_TRIA3</a>, 
                                 <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da56cfcdcbbab7ddfc577de288697cd291">MED_GLOBAL_PFLMODE</a>, profile2name, <a class="code" href="a00321_a2acd5f0b336ddb4026fe1dd314fbd1e0.html#a2acd5f0b336ddb4026fe1dd314fbd1e0">MED_NO_LOCALIZATION</a>,    
                                 <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>, ntria3,
                                 (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) tria3values_step2_profile2) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : write field values on MED_TRIA3 ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/* MED_QUAD4 : with no profile */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01004_gac369c1fc64c95923cadfc39e41ea8f8d.html#gac369c1fc64c95923cadfc39e41ea8f8d" title="Cette routine permet d&amp;#39;écrire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileWr</a>(fid, fieldname, 2, 1, 8.9, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>, <a class="code" href="a00321_a24ea9c52f5bde41d9a072925249ec06c.html#a24ea9c52f5bde41d9a072925249ec06c">MED_QUAD4</a>, 
                      <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, <a class="code" href="a00321_aaa89a5e5e6d32de69614b70cf74e29cc.html#aaa89a5e5e6d32de69614b70cf74e29cc">MED_NO_PROFILE</a>, <a class="code" href="a00321_a2acd5f0b336ddb4026fe1dd314fbd1e0.html#a2acd5f0b336ddb4026fe1dd314fbd1e0">MED_NO_LOCALIZATION</a>,
                      <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>, nquad4,
                      (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) quad4values_step2) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : write field values on MED_QUAD4 ... &quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  ret=0;
 ERROR:

  <span class="comment">/* close file */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01005_ga12a0e901c376be997a41a073ce426283.html#ga12a0e901c376be997a41a073ce426283" title="Fermeture d&amp;#39;un fichier MED.">MEDfileClose</a>(fid) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : close file ...&quot;</span>);             
    ret=-1; 
  } 
  
  <span class="keywordflow">return</span> ret;
}

</pre></div> <p>A la lecture, la routine <a class="el" href="a01004_gab8ce8c33cfe01cbccbde8474a4c433ba.html#gab8ce8c33cfe01cbccbde8474a4c433ba">MEDfieldnProfile</a> / <a class="el" href="a01019_ga1bfc80fc41bb1c9c11a4a946b199452f.html#ga1bfc80fc41bb1c9c11a4a946b199452f">mfdnpf</a> permet de lire le nombre de profil dans un champ pour une s&eacute;quence de calcul donn&eacute;e. La routine <a class="el" href="a01004_gaa45f3d32332f8410c35c51a77ee20740.html#gaa45f3d32332f8410c35c51a77ee20740">MEDfieldnValueWithProfile</a> / <a class="el" href="a01019_gafe5dacbacc6af9e74473c018e0e70f8a.html#gafe5dacbacc6af9e74473c018e0e70f8a">mfdnvp</a> permet de lire le nombre de valeurs &agrave; lire en tenant compte du profil et mode de stockage des donn&eacute;es en m&eacute;moire (<a class="el" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da56cfcdcbbab7ddfc577de288697cd291">MED_GLOBAL_PFLMODE</a> ou <a class="el" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>). Les routines <a class="el" href="a01004_ga85cf40e4f76b7f6e6036445a6c6108b4.html#ga85cf40e4f76b7f6e6036445a6c6108b4">MEDfieldValueWithProfileRd</a> / <a class="el" href="a01019_ga58433c346e2147cfa2724f0b1b15cb80.html#ga58433c346e2147cfa2724f0b1b15cb80">mfdrpr</a>, <a class="el" href="a01019_ga5258c859a394de1bcba468966b74b07d.html#ga5258c859a394de1bcba468966b74b07d">mfdipr</a> permettent de lire les valeurs du champ avec ou sans profil. </p>
<div class="fragment"><pre class="fragment"><span class="comment">/*  This file is part of MED.</span>
<span class="comment"> *</span>
<span class="comment"> *  COPYRIGHT (C) 1999 - 2012  EDF R&amp;D, CEA/DEN</span>
<span class="comment"> *  MED is free software: you can redistribute it and/or modify</span>
<span class="comment"> *  it under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> *  the Free Software Foundation, either version 3 of the License, or</span>
<span class="comment"> *  (at your option) any later version.</span>
<span class="comment"> *</span>
<span class="comment"> *  MED is distributed in the hope that it will be useful,</span>
<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment"> *  GNU Lesser General Public License for more details.</span>
<span class="comment"> *</span>
<span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> *  along with MED.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> */</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;med_utils.h&gt;</span>

<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;med_utils.h&gt;</span>

<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="comment">/* </span>
<span class="comment"> * Field use case 9 : read a field with computing steps and profiles (generic approach)</span>
<span class="comment"> */</span>


<span class="keywordtype">int</span> <a class="code" href="a00750_a3c04138a5bfe5d72780bb7e82a18e627.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> fid;
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> nfield, i, j;
  <span class="keywordtype">char</span> meshname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00321_a23f7fa6d76886ed3c91dc33b59190dee.html#a23f7fa6d76886ed3c91dc33b59190dee">med_bool</a> localmesh;
  <span class="keywordtype">char</span> fieldname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00321_a5615eeaf85e0b3f40b74bdd24178f2cd.html#a5615eeaf85e0b3f40b74bdd24178f2cd">med_field_type</a> fieldtype;
  <span class="keywordtype">char</span> *componentname = NULL;
  <span class="keywordtype">char</span> *componentunit = NULL;
  <span class="keywordtype">char</span> dtunit[<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> *values = NULL;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nstep, nvalues;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> ncomponent;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> csit, numit, numdt, it;
  <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> dt;
  <a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> geotype;
  <a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> *geotypes = <a class="code" href="a00499_a54c2e34174a890046d0a204fa1a918a8.html#a54c2e34174a890046d0a204fa1a918a8">MED_GET_CELL_GEOMETRY_TYPE</a>;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nprofile, pit, profilesize;
  <span class="keywordtype">char</span> profilename[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nintegrationpoint;
  <span class="keywordtype">char</span> localizationname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">int</span> ret=-1;

  <span class="comment">/* open file */</span>
  fid = <a class="code" href="a01005_ga9376a1654b7bf099c3f8941074c5fdfb.html#ga9376a1654b7bf099c3f8941074c5fdfb" title="Ouverture d&amp;#39;un fichier MED.">MEDfileOpen</a>(<span class="stringliteral">&quot;UsesCase_MEDfield_7.med&quot;</span>,<a class="code" href="a00321_adcd0322de9fec3b5e199ffeda3f44c85.html#adcd0322de9fec3b5e199ffeda3f44c85a616bf8345c622a34f0787f42eb400f25">MED_ACC_RDONLY</a>);
  <span class="keywordflow">if</span> (fid &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : open file ...&quot;</span>);
    <span class="keywordflow">return</span> -1;
  }

  <span class="comment">/*</span>
<span class="comment">   * generic approach : how many fields in the file and identification</span>
<span class="comment">   * of each field.</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> ((nfield = <a class="code" href="a01004_ga0d8be6c1b6b24ff150a5adcb58831d93.html#ga0d8be6c1b6b24ff150a5adcb58831d93" title="Cette routine permet de lire le nombre de champs dans un fichier.">MEDnField</a>(fid)) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : How many fields in the file ...&quot;</span>);
    <span class="keywordflow">return</span> -1;
  }

  <span class="comment">/* </span>
<span class="comment">   * read values for each field</span>
<span class="comment">   */</span>
  <span class="keywordflow">for</span> (i=0; i&lt;nfield; i++) {

    <span class="keywordflow">if</span> ((ncomponent = <a class="code" href="a01004_gabe6258ebc74592af81c9b51379b7b7af.html#gabe6258ebc74592af81c9b51379b7b7af" title="Cette routine lit le nombre de composantes d&amp;#39;un champ.">MEDfieldnComponent</a>(fid,i+1)) &lt; 0) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : number of field component ...&quot;</span>);
      <span class="keywordflow">return</span> -1;
    }
    
    <span class="keywordflow">if</span> ((componentname = (<span class="keywordtype">char</span> *) malloc(ncomponent*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1)) == NULL) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : memory allocation ...&quot;</span>);
      <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">if</span> ((componentunit = (<span class="keywordtype">char</span> *) malloc(ncomponent*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1)) == NULL) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : memory allocation ...&quot;</span>);
      <span class="keywordflow">return</span> -1;
    }    

    <span class="keywordflow">if</span> (<a class="code" href="a01004_gaf2169b6d6505a28d7ee5f8599d2fb25e.html#gaf2169b6d6505a28d7ee5f8599d2fb25e" title="Cette routine permet de lire les informations d&amp;#39;indentification d&amp;#39;un champ...">MEDfieldInfo</a>(fid, i+1, fieldname, meshname, &amp;localmesh, &amp;fieldtype,
                     componentname, componentunit, dtunit, &amp;nstep) &lt; 0) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : Field info ...&quot;</span>);
      free(componentname);
      free(componentunit);
      <span class="keywordflow">return</span> -1;
    }

    free(componentname);
    free(componentunit);

    <span class="comment">/*</span>
<span class="comment">     * Read field values for each computing step </span>
<span class="comment">     */</span> 
    <span class="keywordflow">for</span> (csit=0; csit&lt;nstep; csit++) {

      <span class="keywordflow">if</span> (<a class="code" href="a01004_ga5b0031d3002518f1b2e134ff8c03dbc5.html#ga5b0031d3002518f1b2e134ff8c03dbc5" title="Cette routine permet de lire les informations caractérisant une séquence de calcul...">MEDfieldComputingStepInfo</a>(fid, fieldname, csit+1, &amp;numdt, &amp;numit, &amp;dt) &lt; 0) {
        <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : Computing step info ...&quot;</span>);
        <span class="keywordflow">return</span> -1;
      }

      <span class="comment">/* </span>
<span class="comment">       * ... In our case, we suppose that the field values are only defined on cells ... </span>
<span class="comment">       */</span>
      <span class="keywordflow">for</span> (it=1; it&lt;=<a class="code" href="a00321_abd42d91233c317ca8eb9b592e4502053.html#abd42d91233c317ca8eb9b592e4502053">MED_N_CELL_FIXED_GEO</a>; it++) {

        geotype = geotypes[it];
        <span class="comment">/*</span>
<span class="comment">         * How many profile for each geometry type ? </span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> ((nprofile = <a class="code" href="a01004_gab8ce8c33cfe01cbccbde8474a4c433ba.html#gab8ce8c33cfe01cbccbde8474a4c433ba" title="Cette routine permet de lire le nombre de profils référencés dans un champ pour...">MEDfieldnProfile</a>(fid, fieldname, numdt, numit, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>, geotype,
                                         profilename, localizationname)) &lt; 0) {
          <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read number of profile &quot;</span>);
          <span class="keywordflow">return</span> -1;
        }

        <span class="comment">/* </span>
<span class="comment">         * Read values for each profile</span>
<span class="comment">         * We suppose that we have no localization name </span>
<span class="comment">         */</span>
        <span class="keywordflow">for</span> (pit=0; pit&lt;nprofile; pit++) {
          
          <span class="keywordflow">if</span> ((nvalues = <a class="code" href="a01004_gaa45f3d32332f8410c35c51a77ee20740.html#gaa45f3d32332f8410c35c51a77ee20740" title="Cette routine permet de lire le nombre de valeurs à lire dans un champ pour une...">MEDfieldnValueWithProfile</a>(fid, fieldname, numdt, numit, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>, geotype,
                                                   pit+1, <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, profilename, &amp;profilesize,
                                                   localizationname, &amp;nintegrationpoint)) &lt; 0) {
            <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read number of values with a profile ...&quot;</span>);
            <span class="keywordflow">return</span> -1;
          } 
          
          <span class="keywordflow">if</span> (nvalues) {
            <span class="keywordflow">if</span> ((values = (<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> *) malloc(<span class="keyword">sizeof</span>(<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>)*nvalues*ncomponent)) == NULL) {
              <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : memory allocation ...&quot;</span>);
              <span class="keywordflow">return</span> -1;
            }
            <span class="keywordflow">if</span> (<a class="code" href="a01004_ga85cf40e4f76b7f6e6036445a6c6108b4.html#ga85cf40e4f76b7f6e6036445a6c6108b4" title="Cette routine permet de lire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileRd</a>(fid, fieldname, numdt, numit, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>, geotype,
                                           <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, profilename, 
                                           <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)values) &lt; 0) {
              <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read fields values for cells ...&quot;</span>); 
              free(values);
              <span class="keywordflow">return</span> -1; 
            }  

            free(values);
          }
        }
      }
    }
  }

  ret=0;
 ERROR:
  
  <span class="comment">/* close file */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01005_ga12a0e901c376be997a41a073ce426283.html#ga12a0e901c376be997a41a073ce426283" title="Fermeture d&amp;#39;un fichier MED.">MEDfileClose</a>(fid) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : close file ...&quot;</span>);             
    ret=-1; 
  } 
  
  <span class="keywordflow">return</span> ret;
}
</pre></div> <h3><a class="anchor" id="2."></a>Lire des champs cr&eacute;&eacute;s avec MED 2.x et d&eacute;finis sur plusieurs maillages</h3>
<p>Dans MED 2.x, les champs pouvaient &ecirc;tre d&eacute;finis sur plusieurs maillages. Cette possibilit&eacute; dispara&icirc;t avec MED 3.0 et l'apparition des maillages &eacute;volutifs. MED 3.0 fournit n&eacute;anmoins des routines permettant la lecture de fichier MED 2.x pouvant contenir des champs d&eacute;finis sur plusieurs maillages. Ces routines sp&eacute;cifiques sont &agrave; utiliser en lieu et place de celles utilis&eacute;es dans le cas d'utilisation pr&eacute;c&eacute;dent (ces routines peuvent &eacute;videmment &eacute;galement lire des champs dans des fichiers MED 3.0), il s'agit de <a class="el" href="a01004_gac2f9fe6595887efff5412c2ed16b087b.html#gac2f9fe6595887efff5412c2ed16b087b">MEDfield23ComputingStepMeshInfo</a> / <a class="el" href="a01019_ga502b35eb4a896c2e15fe53ce80794334.html#ga502b35eb4a896c2e15fe53ce80794334">mfdoci</a>, <a class="el" href="a01004_gab551e1d90598c42819083eea1c71f6de.html#gab551e1d90598c42819083eea1c71f6de">MEDfield23nValueWithProfile</a> / <a class="el" href="a01019_ga50dd292a5958620cac2fd65a7552dea6.html#ga50dd292a5958620cac2fd65a7552dea6">mfdonv</a>, <a class="el" href="a01004_gab65a0b4b722065772868058d8a99b4a9.html#gab65a0b4b722065772868058d8a99b4a9">MEDfield23ValueWithProfileRd</a> / <a class="el" href="a01019_ga411356660c436b498d00405b3938442a.html#ga411356660c436b498d00405b3938442a">mfdorr</a>, <a class="el" href="a01019_gaafef8aaa1135e366f1aeab67d526c43a.html#gaafef8aaa1135e366f1aeab67d526c43a">mfdoir</a>. </p>
<p>Le cas d'utilisation suivant propose une approche g&eacute;n&eacute;rique pour lire les champs d'un fichier MED, bas&eacute;s sur un ou plusieurs maillages. </p>
<div class="fragment"><pre class="fragment"><span class="comment">/*  This file is part of MED.</span>
<span class="comment"> *</span>
<span class="comment"> *  COPYRIGHT (C) 1999 - 2012  EDF R&amp;D, CEA/DEN</span>
<span class="comment"> *  MED is free software: you can redistribute it and/or modify</span>
<span class="comment"> *  it under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> *  the Free Software Foundation, either version 3 of the License, or</span>
<span class="comment"> *  (at your option) any later version.</span>
<span class="comment"> *</span>
<span class="comment"> *  MED is distributed in the hope that it will be useful,</span>
<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment"> *  GNU Lesser General Public License for more details.</span>
<span class="comment"> *</span>
<span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> *  along with MED.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> */</span>

<span class="comment">/******************************************************************************</span>
<span class="comment"> * - Nom du fichier : test11.c</span>
<span class="comment"> *</span>
<span class="comment"> * - Description : lecture de champs de resultats MED</span>
<span class="comment"> *</span>
<span class="comment"> *****************************************************************************/</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &quot;med_utils.h&quot;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="preprocessor">#ifdef DEF_LECT_ECR</span>
<span class="preprocessor"></span><span class="preprocessor">#define MODE_ACCES MED_ACC_RDWR</span>
<span class="preprocessor"></span><span class="preprocessor">#elif DEF_LECT_AJOUT</span>
<span class="preprocessor"></span><span class="preprocessor">#define MODE_ACCES MED_ACC_RDEXT</span>
<span class="preprocessor"></span><span class="preprocessor">#else</span>
<span class="preprocessor"></span><span class="preprocessor">#define MODE_ACCES MED_ACC_CREAT</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifndef USER_INTERLACE</span>
<span class="preprocessor"></span><span class="preprocessor">#define USER_INTERLACE MED_FULL_INTERLACE</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#define USER_MODE MED_COMPACT_PFLMODE</span>
<span class="preprocessor"></span>
<a class="code" href="a00320_abd29d7c6abaef5da2a5ed1b73464f0ba.html#abd29d7c6abaef5da2a5ed1b73464f0ba">med_err</a> <a class="code" href="a00750_a04f094649b2e322a80036f52a4e866a1.html#a04f094649b2e322a80036f52a4e866a1">getFieldsOn</a>(<a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> fid, <span class="keywordtype">char</span> * nomcha, <a class="code" href="a00321_a5615eeaf85e0b3f40b74bdd24178f2cd.html#a5615eeaf85e0b3f40b74bdd24178f2cd">med_field_type</a> typcha, <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> ncomp,
                    <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470">med_entity_type</a> entite, <a class="code" href="a00321_a0d451e4036adbb12b14cb16d7db0c37d.html#a0d451e4036adbb12b14cb16d7db0c37d">med_switch_mode</a> stockage, <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> ncstp);

<span class="keywordtype">int</span> <a class="code" href="a00750_a3c04138a5bfe5d72780bb7e82a18e627.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)


{
  <a class="code" href="a00320_abd29d7c6abaef5da2a5ed1b73464f0ba.html#abd29d7c6abaef5da2a5ed1b73464f0ba">med_err</a> ret,lret;
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> fid;
  <span class="keywordtype">char</span> * fichier = NULL;
  <span class="keywordtype">char</span> maa[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">char</span> desc[<a class="code" href="a00321_ab69710ecf9f5257080a943579852d0f0.html#ab69710ecf9f5257080a943579852d0f0">MED_COMMENT_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">char</span> pflname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>,nomlien[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">char</span> _meshname [<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">char</span> _dtunit [<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">char</span> locname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">char</span> * lien = NULL;
  <span class="keywordtype">char</span> *comp= NULL, *unit= NULL;
  <span class="keywordtype">char</span> nomcha  [<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> mdim=0,sdim=0,ncomp,ncha,npro,nln,pflsize,*pflval,nval;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> _ncstp=0,ngauss=0,nloc=0,locsdim=0,lnsize=0;
  <span class="keywordtype">int</span> t1,t2,t3;
  <a class="code" href="a00321_a5615eeaf85e0b3f40b74bdd24178f2cd.html#a5615eeaf85e0b3f40b74bdd24178f2cd">med_field_type</a>    typcha;
  <a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> type_geo;
  <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> *refcoo, *gscoo, *wg;
  <span class="keywordtype">int</span> i,j;
  <a class="code" href="a00321_a23f7fa6d76886ed3c91dc33b59190dee.html#a23f7fa6d76886ed3c91dc33b59190dee">med_bool</a> _local;

  <span class="keywordtype">char</span> dtunit[<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">char</span> nomcoo[3*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">char</span> unicoo[3*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">char</span> geointerpname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">char</span> ipointstructmeshname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00321_a821a4dd94c5c6b095318432bdec8d8a1.html#a821a4dd94c5c6b095318432bdec8d8a1">med_mesh_type</a> type;
  <a class="code" href="a00321_a5b97067a30629cd60470d074691d6798.html#a5b97067a30629cd60470d074691d6798">med_sorting_type</a> sort;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nstep=0;
  <a class="code" href="a00321_a57867e4bed1d104c865cfc9d23c9204d.html#a57867e4bed1d104c865cfc9d23c9204d">med_axis_type</a> rep;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nsectionmeshcell;
  <a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> sectiongeotype;

  <span class="keywordflow">if</span> (argc != 2) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Aucun nom de fichier precise, fichier test10.med utilise &quot;</span>);
    fichier = <span class="stringliteral">&quot;test10.med&quot;</span>;
  } <span class="keywordflow">else</span> {
    fichier = argv[1];
  };


  <span class="comment">/* Ouverture du fichier med */</span>
  <span class="keywordflow">if</span> ((fid = <a class="code" href="a01005_ga9376a1654b7bf099c3f8941074c5fdfb.html#ga9376a1654b7bf099c3f8941074c5fdfb" title="Ouverture d&amp;#39;un fichier MED.">MEDfileOpen</a>(fichier,<a class="code" href="a00321_adcd0322de9fec3b5e199ffeda3f44c85.html#adcd0322de9fec3b5e199ffeda3f44c85a616bf8345c622a34f0787f42eb400f25">MED_ACC_RDONLY</a>)) &lt; 0){
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a l&apos;ouverture du fichier : &quot;</span>);<a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(fichier);
    <span class="keywordflow">return</span> -1;
  }

  ret = 0;


 <span class="comment">/* Lecture des infos concernant le premier maillage */</span>
  <span class="keywordflow">if</span> ( <a class="code" href="a01011_ga71e0d79fbb40abdc9c20bc5be01441ac.html#ga71e0d79fbb40abdc9c20bc5be01441ac" title="Cette routine permet de lire les informations relatives à un maillage dans un fichier...">MEDmeshInfo</a>( fid, 1,  maa, &amp;sdim, &amp;mdim, &amp;type, desc, dtunit, &amp;sort,
                    &amp;nstep,  &amp;rep, nomcoo,unicoo) &lt; 0 ) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la lecture des informations sur le maillage : &quot;</span>);<a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(maa);
    <span class="keywordflow">return</span> -1;
  } <span class="keywordflow">else</span> {
    printf(<span class="stringliteral">&quot;Maillage de nom : |%s| , de dimension : &quot;</span><a class="code" href="a00348_ad1c568efb9ee28e7f3b0e20bf7e79ff4.html#ad1c568efb9ee28e7f3b0e20bf7e79ff4">IFORMAT</a><span class="stringliteral">&quot; , et de type %d\n&quot;</span>,maa,mdim,type);
    printf(<span class="stringliteral">&quot;\t -Dimension de l&apos;espace : &quot;</span><a class="code" href="a00348_ad1c568efb9ee28e7f3b0e20bf7e79ff4.html#ad1c568efb9ee28e7f3b0e20bf7e79ff4">IFORMAT</a><span class="stringliteral">&quot;\n&quot;</span>,sdim);
    printf(<span class="stringliteral">&quot;\t -Description du maillage : %s\n&quot;</span>,desc);
    printf(<span class="stringliteral">&quot;\t -Noms des axes : |%s|\n&quot;</span>,nomcoo);
    printf(<span class="stringliteral">&quot;\t -Unités des axes : |%s|\n&quot;</span>,unicoo);
    printf(<span class="stringliteral">&quot;\t -Type de repère : %d\n&quot;</span>,rep);
    printf(<span class="stringliteral">&quot;\t -Nombre d&apos;étapes de calcul : &quot;</span><a class="code" href="a00348_ad1c568efb9ee28e7f3b0e20bf7e79ff4.html#ad1c568efb9ee28e7f3b0e20bf7e79ff4">IFORMAT</a><span class="stringliteral">&quot;\n&quot;</span>,nstep);
    printf(<span class="stringliteral">&quot;\t -Unité des dates : |%s|\n&quot;</span>,dtunit);
  }


  <span class="comment">/* combien de champs dans le fichier */</span>
  <span class="keywordflow">if</span> ((ncha = <a class="code" href="a01004_ga0d8be6c1b6b24ff150a5adcb58831d93.html#ga0d8be6c1b6b24ff150a5adcb58831d93" title="Cette routine permet de lire le nombre de champs dans un fichier.">MEDnField</a>(fid)) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Impossible de lire le nombre de champs : &quot;</span>);<a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(ncha);
    <span class="keywordflow">return</span> ncha;
  }

  printf(<span class="stringliteral">&quot;Nombre de champs : &quot;</span><a class="code" href="a00348_ad1c568efb9ee28e7f3b0e20bf7e79ff4.html#ad1c568efb9ee28e7f3b0e20bf7e79ff4">IFORMAT</a><span class="stringliteral">&quot; \n&quot;</span>,ncha);

  <span class="comment">/* lecture de tous les champs  */</span>
  <span class="keywordflow">for</span> (i =0;i&lt;ncha;i++) {
    lret = 0;
    printf(<span class="stringliteral">&quot;\nChamp numero : %d \n&quot;</span>,i+1);

    <span class="comment">/* Lecture du nombre de composantes */</span>
    <span class="keywordflow">if</span> ((ncomp = <a class="code" href="a01004_gabe6258ebc74592af81c9b51379b7b7af.html#gabe6258ebc74592af81c9b51379b7b7af" title="Cette routine lit le nombre de composantes d&amp;#39;un champ.">MEDfieldnComponent</a>(fid,i+1)) &lt; 0) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la lecture du nombre de composantes : &quot;</span>); <a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(ncomp);
      ret = -1; <span class="keywordflow">continue</span>;
    }

    <span class="comment">/* Lecture du type du champ, des noms des composantes et du nom de l&apos;unite*/</span>
    comp = (<span class="keywordtype">char</span>*) malloc(ncomp*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1);
    <a class="code" href="a00348_a1490910810b7b26086f3df4911027426.html#a1490910810b7b26086f3df4911027426">EXIT_IF</a>(comp == NULL,NULL,NULL);
    unit = (<span class="keywordtype">char</span>*) malloc(ncomp*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1);
    <a class="code" href="a00348_a1490910810b7b26086f3df4911027426.html#a1490910810b7b26086f3df4911027426">EXIT_IF</a>(unit == NULL,NULL,NULL);

    <span class="keywordflow">if</span> ( <a class="code" href="a01004_gaf2169b6d6505a28d7ee5f8599d2fb25e.html#gaf2169b6d6505a28d7ee5f8599d2fb25e" title="Cette routine permet de lire les informations d&amp;#39;indentification d&amp;#39;un champ...">MEDfieldInfo</a>(fid,i+1,nomcha,_meshname,&amp;_local,&amp;typcha,comp,unit,_dtunit,&amp;_ncstp) &lt; 0 ) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la demande d&apos;information sur les champs : &quot;</span>);
      <a class="code" href="a00348_ae7ba0433e91c450cd44c3808c2acb497.html#ae7ba0433e91c450cd44c3808c2acb497">ISCRUTE_int</a>(i+1);<a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(nomcha);<a class="code" href="a00348_ae7ba0433e91c450cd44c3808c2acb497.html#ae7ba0433e91c450cd44c3808c2acb497">ISCRUTE_int</a>(typcha);<a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(comp);<a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(unit);
      <a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(ncomp);
      ret = -1; <span class="keywordflow">continue</span>;
    }


    printf(<span class="stringliteral">&quot;Nom du champ : |%s| de type %d\n&quot;</span>,nomcha,typcha);
    printf(<span class="stringliteral">&quot;Nom des composantes : |%s|\n&quot;</span>,comp);
    printf(<span class="stringliteral">&quot;Unites des composantes : |%s| \n&quot;</span>,unit);
    printf(<span class="stringliteral">&quot;Unites des dates  : |%s| \n&quot;</span>,_dtunit);
    printf(<span class="stringliteral">&quot;Le maillage associé est |%s|\n&quot;</span>,_meshname);
    printf(<span class="stringliteral">&quot;Nombre de séquences de calcul |&quot;</span><a class="code" href="a00348_ad1c568efb9ee28e7f3b0e20bf7e79ff4.html#ad1c568efb9ee28e7f3b0e20bf7e79ff4">IFORMAT</a><span class="stringliteral">&quot;|\n&quot;</span>,_ncstp);

      <span class="comment">/* Le maillage reference est-il porte par un autre fichier */</span>
    <span class="keywordflow">if</span> ( !_local ) {

      <span class="keywordflow">if</span> ( (lnsize=<a class="code" href="a01009_ga8b2e785cb3126e02569c8b4f5564cd3d.html#ga8b2e785cb3126e02569c8b4f5564cd3d" title="Cette routine permet de lire les informations sur un lien dans un fichier MED.">MEDlinkInfoByName</a>(fid,_meshname) ) &lt; 0 )  {
        <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la lecture de la taille du lien : &quot;</span>);
        <a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(_meshname);
        ret = -1;
      } <span class="keywordflow">else</span> {

        lien = malloc((lnsize+1)*<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));
          <a class="code" href="a00348_a1490910810b7b26086f3df4911027426.html#a1490910810b7b26086f3df4911027426">EXIT_IF</a>(lien == NULL,NULL,NULL);

          <span class="keywordflow">if</span> ( <a class="code" href="a01009_gabdf9a46ed125db6ae1df407e7bf1342d.html#gabdf9a46ed125db6ae1df407e7bf1342d" title="Cette routine permet de lire un lien dans un fichier MED.">MEDlinkRd</a>(fid,_meshname, lien) &lt; 0 )  {
            <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la lecture du lien : &quot;</span>);
            <a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(_meshname);<a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(lien);
            ret = -1;
          } <span class="keywordflow">else</span> {
            printf(<span class="stringliteral">&quot;\tLe maillage |%s| est porte par un fichier distant |%s|\n&quot;</span>,_meshname,lien);
          }
          free(lien);
        }
      }
    
    free(comp);
    free(unit);
    
      
    lret = <a class="code" href="a00750_a04f094649b2e322a80036f52a4e866a1.html#a04f094649b2e322a80036f52a4e866a1">getFieldsOn</a>(fid, nomcha, typcha, ncomp, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a074507163b07b6d764823a78c5c07f0f">MED_NODE</a>, <a class="code" href="a00750_ac09b07847abc434cc4a161e367e6b9b0.html#ac09b07847abc434cc4a161e367e6b9b0">USER_INTERLACE</a>,_ncstp );
    
    <span class="keywordflow">if</span> (lret == 0) lret = <a class="code" href="a00750_a04f094649b2e322a80036f52a4e866a1.html#a04f094649b2e322a80036f52a4e866a1">getFieldsOn</a>(fid, nomcha, typcha, ncomp, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>, <a class="code" href="a00750_ac09b07847abc434cc4a161e367e6b9b0.html#ac09b07847abc434cc4a161e367e6b9b0">USER_INTERLACE</a>,_ncstp );
    <span class="keywordflow">else</span> { <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la lecture des champs aux noeuds &quot;</span>); ret = -1; <span class="keywordflow">continue</span>;}
   
    <span class="keywordflow">if</span> (lret == 0) lret = <a class="code" href="a00750_a04f094649b2e322a80036f52a4e866a1.html#a04f094649b2e322a80036f52a4e866a1">getFieldsOn</a>(fid, nomcha, typcha, ncomp, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a9168c75d6fb79842aeb30740f5146d25">MED_DESCENDING_FACE</a>,<a class="code" href="a00750_ac09b07847abc434cc4a161e367e6b9b0.html#ac09b07847abc434cc4a161e367e6b9b0">USER_INTERLACE</a>,_ncstp);
    <span class="keywordflow">else</span> { <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la lecture des champs aux mailles &quot;</span>); ret = -1; <span class="keywordflow">continue</span>;}
   
    <span class="keywordflow">if</span> (lret == 0) lret = <a class="code" href="a00750_a04f094649b2e322a80036f52a4e866a1.html#a04f094649b2e322a80036f52a4e866a1">getFieldsOn</a>(fid, nomcha, typcha, ncomp, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470aecea01a443c5512ff49ddba9f992aa0e">MED_DESCENDING_EDGE</a>,<a class="code" href="a00750_ac09b07847abc434cc4a161e367e6b9b0.html#ac09b07847abc434cc4a161e367e6b9b0">USER_INTERLACE</a>,_ncstp);
    <span class="keywordflow">else</span> {<a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la lecture des champs aux faces &quot;</span>); ret = -1; <span class="keywordflow">continue</span>;}
    
    <span class="keywordflow">if</span> (lret == 0) lret = <a class="code" href="a00750_a04f094649b2e322a80036f52a4e866a1.html#a04f094649b2e322a80036f52a4e866a1">getFieldsOn</a>(fid, nomcha, typcha, ncomp, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a809ee1b85589bf7c0cf796b7212abc25">MED_NODE_ELEMENT</a>,<a class="code" href="a00750_ac09b07847abc434cc4a161e367e6b9b0.html#ac09b07847abc434cc4a161e367e6b9b0">USER_INTERLACE</a>,_ncstp);
    <span class="keywordflow">else</span> {<a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la lecture des champs aux aretes&quot;</span>); ret = -1; <span class="keywordflow">continue</span>;}
    
    <span class="comment">/*TODO */</span>
<span class="comment">/*     if (lret == 0) lret = getFieldsOn(fid, nomcha, typcha, ncomp, MED_STRUCT_ELEMENT,USER_INTERLACE,_ncstp); */</span>
<span class="comment">/*     else {MESSAGE(&quot;Erreur a la lecture des champs aux éléments de structure&quot;); ret = -1; continue;} */</span>
    
    <span class="keywordflow">if</span>  (lret != 0) {<a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la lecture des champs aux noeuds des mailles &quot;</span>); ret = -1;};
  }


  <span class="comment">/* Interrogation des profils */</span>
  npro = <a class="code" href="a01013_ga984674c8806c7374a95cd451219f8e81.html#ga984674c8806c7374a95cd451219f8e81" title="Cette routine permet de lire le nombre de profil dans un fichier MED.">MEDnProfile</a>(fid);

  printf(<span class="stringliteral">&quot;\nNombre de profils stockes : &quot;</span><a class="code" href="a00348_ad1c568efb9ee28e7f3b0e20bf7e79ff4.html#ad1c568efb9ee28e7f3b0e20bf7e79ff4">IFORMAT</a><span class="stringliteral">&quot;\n\n&quot;</span>,npro);
  <span class="keywordflow">for</span> (i=1 ; i &lt;= npro ; i++ ) {
    <span class="keywordflow">if</span> ( <a class="code" href="a01013_ga58f36a5e3b4fb4a2e510b421c6608102.html#ga58f36a5e3b4fb4a2e510b421c6608102" title="Cette routine permet de lire les informations sur un profil dans un fichier MED.">MEDprofileInfo</a>(fid, i, pflname, &amp;nval) &lt; 0)  {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la demande d&apos;information sur le profil n° : &quot;</span>); <a class="code" href="a00348_ae7ba0433e91c450cd44c3808c2acb497.html#ae7ba0433e91c450cd44c3808c2acb497">ISCRUTE_int</a>(i);
      ret = -1;<span class="keywordflow">continue</span>;
    }
    printf(<span class="stringliteral">&quot;\t- Profil n°%i de nom |%s| et de taille &quot;</span><a class="code" href="a00348_ad1c568efb9ee28e7f3b0e20bf7e79ff4.html#ad1c568efb9ee28e7f3b0e20bf7e79ff4">IFORMAT</a><span class="stringliteral">&quot;\n&quot;</span>,i,pflname,nval);
    pflval = (<a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>)*nval);
    <span class="keywordflow">if</span> ( <a class="code" href="a01013_ga93bec578fad63ceaaae0d7ea511d7a3e.html#ga93bec578fad63ceaaae0d7ea511d7a3e" title="Cette routine permet de lire un profil dans un fichier MED.">MEDprofileRd</a>(fid, pflname, pflval) &lt; 0) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la lecture des valeurs du profil : &quot;</span>);
      <a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(pflname);
      ret = -1;
    } <span class="keywordflow">else</span> {
      printf(<span class="stringliteral">&quot;\t&quot;</span>);
      <span class="keywordflow">for</span> (j=0;j&lt;nval;j++) printf(<span class="stringliteral">&quot; &quot;</span><a class="code" href="a00348_ad1c568efb9ee28e7f3b0e20bf7e79ff4.html#ad1c568efb9ee28e7f3b0e20bf7e79ff4">IFORMAT</a><span class="stringliteral">&quot; &quot;</span>,*(pflval+j));
      printf(<span class="stringliteral">&quot;\n\n&quot;</span>);
    }
    free(pflval);
  }

  <span class="comment">/* Interrogation des liens */</span>
  nln = <a class="code" href="a01009_gafa53d1b44d84d4253e83af686857715d.html#gafa53d1b44d84d4253e83af686857715d" title="Cette routine permet la lecture du nombre de lien dans un fichier MED.">MEDnLink</a>(fid);

  printf(<span class="stringliteral">&quot;\nNombre de liens stockes : &quot;</span><a class="code" href="a00348_ad1c568efb9ee28e7f3b0e20bf7e79ff4.html#ad1c568efb9ee28e7f3b0e20bf7e79ff4">IFORMAT</a><span class="stringliteral">&quot;\n\n&quot;</span>,nln);
  <span class="keywordflow">for</span> (i=1 ; i &lt;= nln ; i++ ) {
    <span class="keywordflow">if</span> ( <a class="code" href="a01009_ga01f23204f72d19459c7c96b4b91b018e.html#ga01f23204f72d19459c7c96b4b91b018e" title="Cette routine permet de lire les informations sur un lien dans un fichier MED.">MEDlinkInfo</a>(fid, i, nomlien, &amp;nval) &lt; 0)  {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la demande d&apos;information sur le lien n° : &quot;</span>); <a class="code" href="a00348_ae7ba0433e91c450cd44c3808c2acb497.html#ae7ba0433e91c450cd44c3808c2acb497">ISCRUTE_int</a>(i);
      ret = -1;<span class="keywordflow">continue</span>;
    }
    printf(<span class="stringliteral">&quot;\t- Lien n°%i de nom |%s| et de taille &quot;</span><a class="code" href="a00348_ad1c568efb9ee28e7f3b0e20bf7e79ff4.html#ad1c568efb9ee28e7f3b0e20bf7e79ff4">IFORMAT</a><span class="stringliteral">&quot;\n&quot;</span>,i,nomlien,nval);

    lien = (<span class="keywordtype">char</span> * ) malloc((nval+1)*<span class="keyword">sizeof</span>(char));
    <a class="code" href="a00348_a1490910810b7b26086f3df4911027426.html#a1490910810b7b26086f3df4911027426">EXIT_IF</a>(lien == NULL,NULL,NULL);

    <span class="keywordflow">if</span> ( <a class="code" href="a01009_gabdf9a46ed125db6ae1df407e7bf1342d.html#gabdf9a46ed125db6ae1df407e7bf1342d" title="Cette routine permet de lire un lien dans un fichier MED.">MEDlinkRd</a>(fid, nomlien, lien ) &lt; 0 )  {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la lecture du lien : &quot;</span>);
      <a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(nomlien);<a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(lien);
      ret = -1;
    } <span class="keywordflow">else</span> {
      lien[nval] = <span class="charliteral">&apos;\0&apos;</span>;
      printf(<span class="stringliteral">&quot;\t\t|%s|\n\n&quot;</span>,lien);
    }
    free(lien);
  }

  <span class="comment">/* Interrogation des localisations des points de GAUSS */</span>
  nloc = <a class="code" href="a01010_ga20dffbd06dc5272536b66fc6071be154.html#ga20dffbd06dc5272536b66fc6071be154" title="Cette routine permet de lire le nombre de localisations de points d&amp;#39;intégration...">MEDnLocalization</a>(fid);

  printf(<span class="stringliteral">&quot;\nNombre de localisations stockees : &quot;</span><a class="code" href="a00348_ad1c568efb9ee28e7f3b0e20bf7e79ff4.html#ad1c568efb9ee28e7f3b0e20bf7e79ff4">IFORMAT</a><span class="stringliteral">&quot;\n\n&quot;</span>,nloc);
  <span class="keywordflow">for</span> (i=1 ; i &lt;= nloc ; i++ ) {
    <span class="keywordflow">if</span> ( <a class="code" href="a01010_gac03d0ad34b8c2263d77795919fd0f1a3.html#gac03d0ad34b8c2263d77795919fd0f1a3" title="Cette routine permet d&amp;#39;obtenir la description de la localisation de points d&amp;#39;intégration...">MEDlocalizationInfo</a>(fid, i, locname, &amp;type_geo, &amp;locsdim,&amp;ngauss,
                             geointerpname, ipointstructmeshname,&amp;nsectionmeshcell,
                             &amp;sectiongeotype) &lt; 0)  {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la demande d&apos;information sur la localisation n° : &quot;</span>); <a class="code" href="a00348_ae7ba0433e91c450cd44c3808c2acb497.html#ae7ba0433e91c450cd44c3808c2acb497">ISCRUTE_int</a>(i);
      ret = -1;<span class="keywordflow">continue</span>;
    }
    printf(<span class="stringliteral">&quot;\t- Loc. n°%i de nom |%s| de dimension &quot;</span><a class="code" href="a00348_ad1c568efb9ee28e7f3b0e20bf7e79ff4.html#ad1c568efb9ee28e7f3b0e20bf7e79ff4">IFORMAT</a><span class="stringliteral">&quot; avec &quot;</span><a class="code" href="a00348_ad1c568efb9ee28e7f3b0e20bf7e79ff4.html#ad1c568efb9ee28e7f3b0e20bf7e79ff4">IFORMAT</a><span class="stringliteral">&quot; pts de GAUSS \n&quot;</span>,i,locname,locsdim,ngauss);
    t1 = (type_geo%100)*(type_geo/100);
    t2 = ngauss*(type_geo/100);
    t3 = ngauss;
    refcoo = (<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> *) malloc(<span class="keyword">sizeof</span>(<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>)*t1 );
    gscoo  = (<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> *) malloc(<span class="keyword">sizeof</span>(<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>)*t2 );
    wg     = (<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> *) malloc(<span class="keyword">sizeof</span>(<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>)*t3 );

    <span class="keywordflow">if</span> ( <a class="code" href="a01010_ga613df7c12919f60dc27d49ff8f1f35a3.html#ga613df7c12919f60dc27d49ff8f1f35a3" title="Cette routine permet la lecture d&amp;#39;une localisation localizationname de points...">MEDlocalizationRd</a>(fid, locname, <a class="code" href="a00750_ac09b07847abc434cc4a161e367e6b9b0.html#ac09b07847abc434cc4a161e367e6b9b0">USER_INTERLACE</a>, refcoo, gscoo, wg  ) &lt; 0) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la lecture des valeurs de la localisation : &quot;</span>);
      <a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(locname);
      ret = -1;
    } <span class="keywordflow">else</span> {
      printf(<span class="stringliteral">&quot;\t  Coordonnees de l&apos;element de reference de type %i :\n\t\t&quot;</span>,type_geo);
      <span class="keywordflow">for</span> (j=0;j&lt;t1;j++) printf(<span class="stringliteral">&quot; %f &quot;</span>,*(refcoo+j));
      printf(<span class="stringliteral">&quot;\n&quot;</span>);
      printf(<span class="stringliteral">&quot;\t  Localisation des points de GAUSS : \n\t\t&quot;</span>);
      <span class="keywordflow">for</span> (j=0;j&lt;t2;j++) printf(<span class="stringliteral">&quot; %f &quot;</span>,*(gscoo+j));
      printf(<span class="stringliteral">&quot;\n&quot;</span>);
      printf(<span class="stringliteral">&quot;\t  Poids associes aux points de GAUSS :\n\t\t&quot;</span>);
      <span class="keywordflow">for</span> (j=0;j&lt;t3;j++) printf(<span class="stringliteral">&quot; %f &quot;</span>,*(wg+j));
      printf(<span class="stringliteral">&quot;\n\n&quot;</span>);
    }
    free(refcoo);
    free(gscoo);
    free(wg);
  }


  <span class="comment">/* fermeture du fichier */</span>
  <span class="keywordflow">if</span> ( <a class="code" href="a01005_ga12a0e901c376be997a41a073ce426283.html#ga12a0e901c376be997a41a073ce426283" title="Fermeture d&amp;#39;un fichier MED.">MEDfileClose</a>(fid) &lt; 0) <span class="keywordflow">return</span> -1;

  <span class="keywordflow">return</span> ret;
}

<a class="code" href="a00320_abd29d7c6abaef5da2a5ed1b73464f0ba.html#abd29d7c6abaef5da2a5ed1b73464f0ba">med_err</a> <a class="code" href="a00750_a04f094649b2e322a80036f52a4e866a1.html#a04f094649b2e322a80036f52a4e866a1">getFieldsOn</a>(<a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> fid, <span class="keywordtype">char</span> * nomcha, <a class="code" href="a00321_a5615eeaf85e0b3f40b74bdd24178f2cd.html#a5615eeaf85e0b3f40b74bdd24178f2cd">med_field_type</a> typcha, <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> ncomp,
                    <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470">med_entity_type</a> entite, <a class="code" href="a00321_a0d451e4036adbb12b14cb16d7db0c37d.html#a0d451e4036adbb12b14cb16d7db0c37d">med_switch_mode</a> stockage, <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> ncstp) {

  <span class="keywordtype">int</span> i,j,k,l,m,n,nb_geo=0;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nbpdtnor=0,pflsize,*pflval,ngauss=0,ngroup,*vale=NULL,nval;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> numdt=0,numo=0,_nprofile;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> meshnumdt=0,meshnumit=0;
  <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> *valr=NULL,dt=0.0;
  <a class="code" href="a00320_abd29d7c6abaef5da2a5ed1b73464f0ba.html#abd29d7c6abaef5da2a5ed1b73464f0ba">med_err</a> ret=0;
  <span class="keywordtype">char</span> pflname [<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">char</span> locname [<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">char</span> meshname [<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">char</span> * lien = NULL;
  <span class="keywordtype">char</span> dt_unit [<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1]=<span class="stringliteral">&quot;unknown&quot;</span>;
  <a class="code" href="a00321_a23f7fa6d76886ed3c91dc33b59190dee.html#a23f7fa6d76886ed3c91dc33b59190dee">med_bool</a> localmesh;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nmesh=0;

  <a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> * type_geo;

  <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> * AFF;
  <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> * AFF_ENT=<a class="code" href="a00499_ad72c4ec2628b95b86e62e893bdfc4d3a.html#ad72c4ec2628b95b86e62e893bdfc4d3a">MED_GET_ENTITY_TYPENAME</a>+1;
  <span class="keywordflow">switch</span> (entite) {
  <span class="keywordflow">case</span> <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a074507163b07b6d764823a78c5c07f0f">MED_NODE</a> :
    type_geo = <a class="code" href="a00499_a9afaa32b2a595015d236efffd6a6b8f1.html#a9afaa32b2a595015d236efffd6a6b8f1">MED_GET_NODE_GEOMETRY_TYPE</a>;
    nb_geo   = <a class="code" href="a00321_a94482e307ec77322dcfd9bde0e8f705f.html#a94482e307ec77322dcfd9bde0e8f705f">MED_N_NODE_FIXED_GEO</a>;
    AFF      = <a class="code" href="a00499_a80fceccb749c149ed5226f53596182e2.html#a80fceccb749c149ed5226f53596182e2">MED_GET_NODE_GEOMETRY_TYPENAME</a>;
    <span class="keywordflow">break</span>;
  <span class="keywordflow">case</span>  <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a> :
  <span class="keywordflow">case</span>  <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a809ee1b85589bf7c0cf796b7212abc25">MED_NODE_ELEMENT</a> :
    type_geo = <a class="code" href="a00499_a54c2e34174a890046d0a204fa1a918a8.html#a54c2e34174a890046d0a204fa1a918a8">MED_GET_CELL_GEOMETRY_TYPE</a>;
    nb_geo   = <a class="code" href="a00321_abd42d91233c317ca8eb9b592e4502053.html#abd42d91233c317ca8eb9b592e4502053">MED_N_CELL_FIXED_GEO</a>;
    AFF      = <a class="code" href="a00499_af132d1ce1d5887f7a690eae70010a9e6.html#af132d1ce1d5887f7a690eae70010a9e6">MED_GET_CELL_GEOMETRY_TYPENAME</a>;
    <span class="keywordflow">break</span>;
  <span class="keywordflow">case</span>  <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a9168c75d6fb79842aeb30740f5146d25">MED_DESCENDING_FACE</a> :
    type_geo = <a class="code" href="a00499_afd26706c57b29262890b417e48a360e6.html#afd26706c57b29262890b417e48a360e6">MED_GET_FACE_GEOMETRY_TYPE</a>;
    nb_geo   = <a class="code" href="a00321_ab0fae842b07280cb7fb20f10a68076ee.html#ab0fae842b07280cb7fb20f10a68076ee">MED_N_FACE_FIXED_GEO</a>;
    AFF      = <a class="code" href="a00499_ab2c7c692304448d9b705889ade145e56.html#ab2c7c692304448d9b705889ade145e56">MED_GET_FACE_GEOMETRY_TYPENAME</a>;
    <span class="keywordflow">break</span>;
  <span class="keywordflow">case</span>  <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470aecea01a443c5512ff49ddba9f992aa0e">MED_DESCENDING_EDGE</a> :
    type_geo = <a class="code" href="a00499_a824a6a6383128fcc9df409d0d12cfef0.html#a824a6a6383128fcc9df409d0d12cfef0">MED_GET_EDGE_GEOMETRY_TYPE</a>;
    nb_geo   = <a class="code" href="a00321_abc947dde9b1b8982162dde8888a79ab4.html#abc947dde9b1b8982162dde8888a79ab4">MED_N_EDGE_FIXED_GEO</a>;
    AFF      = <a class="code" href="a00499_ac7b61e15c064e78b7cec77aeabd7532e.html#ac7b61e15c064e78b7cec77aeabd7532e">MED_GET_EDGE_GEOMETRY_TYPENAME</a>;
    <span class="keywordflow">break</span>;
  }

  <span class="keywordflow">for</span> (k=1;k&lt;=nb_geo;k++) {

    <span class="comment">/* Combien de (PDT,NOR) a lire */</span>
    nbpdtnor = ncstp;
    <span class="keywordflow">if</span> (nbpdtnor &lt; 1 ) <span class="keywordflow">continue</span>;

    <span class="keywordflow">for</span> (j=0;j&lt;nbpdtnor;j++) {

      <span class="keywordflow">if</span> ( <a class="code" href="a01004_gac2f9fe6595887efff5412c2ed16b087b.html#gac2f9fe6595887efff5412c2ed16b087b" title="Cette routine permet de lire les informations caractérisant une séquence de calcul...">MEDfield23ComputingStepMeshInfo</a>(fid,nomcha,j+1, &amp;numdt, &amp;numo, &amp;dt,
                                           &amp;nmesh, meshname,&amp;localmesh, &amp;meshnumdt, &amp;meshnumit ) &lt;0) {
        <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la demande d&apos;information sur (pdt,nor) : &quot;</span>);
        <a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(numdt); <a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(numo);<a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(nmesh);<a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(meshname);<a class="code" href="a00348_ae7ba0433e91c450cd44c3808c2acb497.html#ae7ba0433e91c450cd44c3808c2acb497">ISCRUTE_int</a>(localmesh);
        <a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(meshnumdt);<a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(meshnumit);
        ret = -1; <span class="keywordflow">continue</span>;
      }

      <span class="keywordflow">for</span> (i=0;i&lt; nmesh;++i) {

        <span class="keywordflow">if</span> ( (_nprofile = <a class="code" href="a01004_gaaafce3aa29614e7102335e3a908da118.html#gaaafce3aa29614e7102335e3a908da118" title="Cette routine permet de lire le nombre de profils référencés dans un champ pour...">MEDfield23nProfile</a>(fid,nomcha,numdt,numo,entite,type_geo[k],i+1,meshname,
                                                pflname,locname   ) ) &lt; 0 ) {
          <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la demande du nombre de profils referencés par le champ : &quot;</span>);
          <a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(nomcha); <a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(numdt); <a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(numo);<a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(meshname);
          <a class="code" href="a00348_ae7ba0433e91c450cd44c3808c2acb497.html#ae7ba0433e91c450cd44c3808c2acb497">ISCRUTE_int</a>(entite);<a class="code" href="a00348_ae7ba0433e91c450cd44c3808c2acb497.html#ae7ba0433e91c450cd44c3808c2acb497">ISCRUTE_int</a>(type_geo[k]);<a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(pflname);<a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(locname);
          <a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(AFF_ENT[(<span class="keywordtype">int</span>)entite]);<a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(AFF[k]);
          ret = -1; <span class="keywordflow">continue</span>;
        };

        <span class="keywordflow">for</span> (l=0;l&lt;_nprofile;l++) {


          <span class="keywordflow">if</span> ( (nval = <a class="code" href="a01004_gab551e1d90598c42819083eea1c71f6de.html#gab551e1d90598c42819083eea1c71f6de" title="Cette routine permet de lire le nombre de valeurs à lire dans un champ pour une...">MEDfield23nValueWithProfile</a>(fid, nomcha, numdt, numo,  entite, type_geo[k],meshname,
                                                   l+1,  <a class="code" href="a00750_a4590bc240c9d6d928eecc7484553c2e7.html#a4590bc240c9d6d928eecc7484553c2e7">USER_MODE</a>, pflname,&amp;pflsize,
                                                   locname, &amp;ngauss) ) &lt; 0 ) {
            <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la lecture du nombre de valeurs du champ : &quot;</span>);
            <a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(nomcha);<a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(numdt);<a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(numo);<a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(meshname);
            <a class="code" href="a00348_ae7ba0433e91c450cd44c3808c2acb497.html#ae7ba0433e91c450cd44c3808c2acb497">ISCRUTE_int</a>(entite);<a class="code" href="a00348_ae7ba0433e91c450cd44c3808c2acb497.html#ae7ba0433e91c450cd44c3808c2acb497">ISCRUTE_int</a>(type_geo[k]);
            <a class="code" href="a00348_ae7ba0433e91c450cd44c3808c2acb497.html#ae7ba0433e91c450cd44c3808c2acb497">ISCRUTE_int</a>(<a class="code" href="a00750_a4590bc240c9d6d928eecc7484553c2e7.html#a4590bc240c9d6d928eecc7484553c2e7">USER_MODE</a>);
            ret = -1; <span class="keywordflow">continue</span>;
          };

          printf(<span class="stringliteral">&quot;\n  +Pas de Temps n.&quot;</span><a class="code" href="a00348_ad1c568efb9ee28e7f3b0e20bf7e79ff4.html#ad1c568efb9ee28e7f3b0e20bf7e79ff4">IFORMAT</a><span class="stringliteral">&quot; (%f) [%s], n. d&apos;ordre &quot;</span><a class="code" href="a00348_ad1c568efb9ee28e7f3b0e20bf7e79ff4.html#ad1c568efb9ee28e7f3b0e20bf7e79ff4">IFORMAT</a><span class="stringliteral">&quot;, avec &quot;</span><a class="code" href="a00348_ad1c568efb9ee28e7f3b0e20bf7e79ff4.html#ad1c568efb9ee28e7f3b0e20bf7e79ff4">IFORMAT</a><span class="stringliteral">&quot; valeur(s) par entité.\n&quot;</span>,numdt,dt,dt_unit,numo,ngauss);
          printf(<span class="stringliteral">&quot;\t- Il y a &quot;</span><a class="code" href="a00348_ad1c568efb9ee28e7f3b0e20bf7e79ff4.html#ad1c568efb9ee28e7f3b0e20bf7e79ff4">IFORMAT</a><span class="stringliteral">&quot; entités qui portent des valeurs en mode %i. Chaque entite %s\</span>
<span class="stringliteral"> de type geometrique %s associes au profile |%s| a &quot;</span><a class="code" href="a00348_ad1c568efb9ee28e7f3b0e20bf7e79ff4.html#ad1c568efb9ee28e7f3b0e20bf7e79ff4">IFORMAT</a><span class="stringliteral">&quot; valeurs associées \n&quot;</span>,
                 nval,<a class="code" href="a00750_a4590bc240c9d6d928eecc7484553c2e7.html#a4590bc240c9d6d928eecc7484553c2e7">USER_MODE</a>,AFF_ENT[(<span class="keywordtype">int</span>)entite],AFF[k],pflname,ngauss);
          printf(<span class="stringliteral">&quot;\t- Le maillage associé est |%s|\n&quot;</span>,meshname);

          <span class="comment">/*Lecture des valeurs du champ */</span>
          <span class="keywordflow">if</span> (typcha == <a class="code" href="a00320_a7d730da9417184bffcdccc90a1749e27.html#a7d730da9417184bffcdccc90a1749e27ad44e111629f7a5811626b87c8b42b3ea">MED_FLOAT64</a>) {

            valr = (<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>*) calloc(ncomp*nval*ngauss,<span class="keyword">sizeof</span>(<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>));
            <a class="code" href="a00348_a1490910810b7b26086f3df4911027426.html#a1490910810b7b26086f3df4911027426">EXIT_IF</a>(valr == NULL,NULL,NULL);

            <span class="keywordflow">if</span> (<a class="code" href="a01004_gab65a0b4b722065772868058d8a99b4a9.html#gab65a0b4b722065772868058d8a99b4a9" title="Cette routine permet de lire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfield23ValueWithProfileRd</a>(fid, nomcha, numdt,numo, entite,type_geo[k],meshname,
                                             <a class="code" href="a00750_a4590bc240c9d6d928eecc7484553c2e7.html#a4590bc240c9d6d928eecc7484553c2e7">USER_MODE</a>, pflname, stockage,<a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>,
                                           (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) valr) &lt; 0 ) {
              <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la lecture des valeurs du champ : &quot;</span>);
              <a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(nomcha);<a class="code" href="a00348_ae7ba0433e91c450cd44c3808c2acb497.html#ae7ba0433e91c450cd44c3808c2acb497">ISCRUTE_int</a>(entite);<a class="code" href="a00348_ae7ba0433e91c450cd44c3808c2acb497.html#ae7ba0433e91c450cd44c3808c2acb497">ISCRUTE_int</a>(type_geo[k]);
              <a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(numdt);<a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(numo);
              ret = -1;
            }
          } <span class="keywordflow">else</span> {

            vale = (<a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>*) calloc(ncomp*nval*ngauss,<span class="keyword">sizeof</span>(<a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>));
            <a class="code" href="a00348_a1490910810b7b26086f3df4911027426.html#a1490910810b7b26086f3df4911027426">EXIT_IF</a>(vale == NULL,NULL,NULL);

            <span class="keywordflow">if</span> (<a class="code" href="a01004_gab65a0b4b722065772868058d8a99b4a9.html#gab65a0b4b722065772868058d8a99b4a9" title="Cette routine permet de lire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfield23ValueWithProfileRd</a>(fid, nomcha, numdt,numo, entite,type_geo[k],meshname,
                                           <a class="code" href="a00750_a4590bc240c9d6d928eecc7484553c2e7.html#a4590bc240c9d6d928eecc7484553c2e7">USER_MODE</a>, pflname, stockage,<a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>,
                                           (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) vale) &lt; 0 ) {
              <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la lecture des valeurs du champ : &quot;</span>);
              <a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(nomcha);<a class="code" href="a00348_ae7ba0433e91c450cd44c3808c2acb497.html#ae7ba0433e91c450cd44c3808c2acb497">ISCRUTE_int</a>(entite);<a class="code" href="a00348_ae7ba0433e91c450cd44c3808c2acb497.html#ae7ba0433e91c450cd44c3808c2acb497">ISCRUTE_int</a>(type_geo[k]);
              <a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(numdt);<a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(numo);
              ret = -1;
            };
          }

          <span class="keywordflow">if</span> ( strlen(locname) )
            printf(<span class="stringliteral">&quot;\t- Modèle de localisation des points de Gauss de nom |%s|\n&quot;</span>,locname);

          <span class="keywordflow">if</span> (entite == <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a809ee1b85589bf7c0cf796b7212abc25">MED_NODE_ELEMENT</a>)
            ngroup = (type_geo[k] % 100);
          <span class="keywordflow">else</span>
            ngroup = ngauss;

          <span class="keywordflow">switch</span> (stockage) {

          <span class="keywordflow">case</span> <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a> :
            printf(<span class="stringliteral">&quot;\t- Valeurs :\n\t&quot;</span>);
            <span class="keywordflow">for</span> (m=0;m&lt;(nval*ngauss)/ngroup;m++) {
              printf(<span class="stringliteral">&quot;|&quot;</span>);
              <span class="keywordflow">for</span> (n=0;n&lt;ngroup*ncomp;n++)
                <span class="keywordflow">if</span> (typcha == <a class="code" href="a00320_a7d730da9417184bffcdccc90a1749e27.html#a7d730da9417184bffcdccc90a1749e27ad44e111629f7a5811626b87c8b42b3ea">MED_FLOAT64</a>)
                  printf(<span class="stringliteral">&quot; %f &quot;</span>,*(valr+(m*ngroup*ncomp)+n));
                <span class="keywordflow">else</span>
                  printf(<span class="stringliteral">&quot; &quot;</span>IFORMAT<span class="stringliteral">&quot; &quot;</span>,*(vale+(m*ngroup*ncomp)+n));

            }
            <span class="keywordflow">break</span>;

            <span class="comment">/*Affichage en fonction du profil à traiter*/</span>
          <span class="keywordflow">case</span> <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa5c7f85d1c271fe5dbaf9e9f1d3211fea">MED_NO_INTERLACE</a> :
            printf(<span class="stringliteral">&quot;\t- Valeurs :\n\t&quot;</span>);
            <span class="keywordflow">for</span> (m=0;m&lt;ncomp;m++) {
              printf(<span class="stringliteral">&quot;|&quot;</span>);
              <span class="keywordflow">for</span> (n=0;n&lt;(nval*ngauss);n++)
                <span class="keywordflow">if</span> (typcha == <a class="code" href="a00320_a7d730da9417184bffcdccc90a1749e27.html#a7d730da9417184bffcdccc90a1749e27ad44e111629f7a5811626b87c8b42b3ea">MED_FLOAT64</a>)
                  printf(<span class="stringliteral">&quot; %f &quot;</span>,*(valr+(m*nval)+n));
                <span class="keywordflow">else</span>
                  printf(<span class="stringliteral">&quot; &quot;</span>IFORMAT<span class="stringliteral">&quot; &quot;</span>,*(vale+(m*nval)+n));
            }
            <span class="keywordflow">break</span>;
          }

          printf(<span class="stringliteral">&quot;|\n&quot;</span>);
          <span class="keywordflow">if</span> (typcha == <a class="code" href="a00320_a7d730da9417184bffcdccc90a1749e27.html#a7d730da9417184bffcdccc90a1749e27ad44e111629f7a5811626b87c8b42b3ea">MED_FLOAT64</a>) {
            <span class="keywordflow">if</span> ( valr ) {free(valr);valr = NULL;}}
          <span class="keywordflow">else</span>
            <span class="keywordflow">if</span> (vale) { free(vale);vale = NULL; }

          <span class="comment">/*Lecture du profil associe */</span>
          <span class="keywordflow">if</span> (strcmp(pflname,<a class="code" href="a00321_aaa89a5e5e6d32de69614b70cf74e29cc.html#aaa89a5e5e6d32de69614b70cf74e29cc">MED_NO_PROFILE</a>) == 0 )
            printf(<span class="stringliteral">&quot;\t- Profil : MED_NO_PROFILE\n&quot;</span>);
          <span class="keywordflow">else</span> {
            <span class="keywordflow">if</span> ( (pflsize = <a class="code" href="a01013_ga2871de707744621f6a29a29633cc2e7b.html#ga2871de707744621f6a29a29633cc2e7b" title="Cette routine permet de lire la taille d&amp;#39;un profil dont on connait le nom.">MEDprofileSizeByName</a>(fid,pflname)) &lt;0 )  {
              <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la lecture du nombre de valeurs du profil : &quot;</span>);
              <a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(pflname);
              ret = -1; <span class="keywordflow">continue</span>;
            }

            printf(<span class="stringliteral">&quot;\t- Profil : |%s| de taille &quot;</span>IFORMAT<span class="stringliteral">&quot;\n&quot;</span>,pflname,pflsize);

            pflval = (<a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>)*pflsize);
            <a class="code" href="a00348_a1490910810b7b26086f3df4911027426.html#a1490910810b7b26086f3df4911027426">EXIT_IF</a>(pflval == NULL,NULL,NULL);
            <span class="keywordflow">if</span> ( <a class="code" href="a01013_ga93bec578fad63ceaaae0d7ea511d7a3e.html#ga93bec578fad63ceaaae0d7ea511d7a3e" title="Cette routine permet de lire un profil dans un fichier MED.">MEDprofileRd</a>(fid,pflname,pflval) &lt;0) {
              <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Erreur a la lecture des valeurs du profil : &quot;</span>);
              <a class="code" href="a00348_a257959db0a78623caa051d11ceb2f8cb.html#a257959db0a78623caa051d11ceb2f8cb">SSCRUTE</a>(pflname);
              ret = -1;
            }
            printf(<span class="stringliteral">&quot;\t&quot;</span>);
            <span class="keywordflow">for</span> (m=0;m&lt;pflsize;m++) printf(<span class="stringliteral">&quot; &quot;</span>IFORMAT<span class="stringliteral">&quot; &quot;</span>,*(pflval+m));
            printf(<span class="stringliteral">&quot;\n&quot;</span>);
            free(pflval);
          }
        }
      }
    }
  } <span class="comment">/* fin for sur les mailles*/</span>

  <span class="keywordflow">return</span> ret;
}

</pre></div> <h3><a class="anchor" id="3."></a>Cr&eacute;er et lire un champ aux points d'int&eacute;gration des &eacute;l&eacute;ments </h3>
<p>MED fournit la possibilit&eacute; d'exprimer les champs de r&eacute;sultat sur les points de Gauss (ou points d'int&eacute;gration) des &eacute;l&eacute;ments d'un maillage. Dans ce cadre, il est possible de localiser ces points sur des &eacute;l&eacute;ments de r&eacute;f&eacute;rence en des lieux diff&eacute;rents selon la mod&eacute;lisation num&eacute;rique choisie. Pour chaque type de mod&eacute;lisation, il est possible de sp&eacute;cifier cette localisation sur des &eacute;l&eacute;ments de r&eacute;f&eacute;rence. On distingue diff&eacute;rentes familles de points de Gauss en fonction du nombre de points d'int&eacute;gration. Chaque point d'int&eacute;gration est localis&eacute; au sein d'un &eacute;l&eacute;ment de r&eacute;f&eacute;rence par ses coordonn&eacute;es et se voit associer un poids.  </p>
<p>La localisation des points de Gauss pour un &eacute;l&eacute;ment de r&eacute;f&eacute;rence n&eacute;cessite donc de conna&icirc;tre le type g&eacute;om&eacute;trique de l'&eacute;l&eacute;ment, les coordonn&eacute;es des noeuds de l'&eacute;l&eacute;ment, les coordonn&eacute;es et le poids de chaque point de Gauss. L'expression des coordonn&eacute;es d'un &eacute;l&eacute;ment de r&eacute;f&eacute;rence peut se faire dans un rep&egrave;re de coordonn&eacute;es dont la dimension est sup&eacute;rieure &agrave; celle de l'&eacute;l&eacute;ment de r&eacute;f&eacute;rence. La r&eacute;f&eacute;rence &agrave; un &eacute;l&eacute;ment de r&eacute;f&eacute;rence se fait &agrave; l'appel des routines d'&eacute;criture et lecture des valeurs des champs.  </p>
<p>Si les points de Gauss se confondent avec les noeuds de l'&eacute;l&eacute;ment, il est inutile de cr&eacute;er une localisation factice avec des poids qui ne signifient rien et des coordonn&eacute;es des points de Gauss identiques &agrave; celles des noeuds. Dans ce cas de figure, il faut utiliser le mot cl&eacute; r&eacute;serv&eacute; <a class="el" href="a00321_a873a5b8b6a795c0bb74a9a7a6f964645.html#a873a5b8b6a795c0bb74a9a7a6f964645">MED_GAUSS_ELNO</a> &agrave; l'&eacute;criture des valeurs d'un champ pour indiquer le type de localisation. </p>
<p>Il est possible pour une m&ecirc;me type g&eacute;om&eacute;trique d'&eacute;l&eacute;ment d'associer plusieurs &eacute;l&eacute;ments de r&eacute;f&eacute;rence. Il suffit pour cela d'associer chaque localisation avec un profil lors de l'appel d'&eacute;criture et lecture des valeurs des champs. </p>
<p>MED permet &eacute;galement la prise en compte des fonctions de forme et des familles d'interpolation. Une famille d'interpolation est l'ensemble d'interpolations disponibles pour un champ donn&eacute;. Chacune des interpolations est d&eacute;crite par des fonctions de forme polynomiales. Le nombre de variable des fonctions de forme est &eacute;gale &agrave; la dimension de l'espace de la maille de r&eacute;f&eacute;rence utilis&eacute;e pour le construire. Il est donc possible d'associer &agrave; un champ plusieurs interpolations d&eacute;finies sur des mailles de r&eacute;f&eacute;rence des diff&eacute;rents types g&eacute;om&eacute;triques du maillage de calcul sur lequel repose le champ de r&eacute;sultat. </p>
<p>L'&eacute;criture des fonctions de forme et des familles d'interpolation est optionnelle pour &eacute;changer des champs aux points d'int&eacute;gration.  </p>
<p>A l'&eacute;criture, la cr&eacute;ation d'un &eacute;l&eacute;ment de r&eacute;f&eacute;rence se fait avec la routine <a class="el" href="a01010_ga77e9d9cfe12058f20762fe61fbf14172.html#ga77e9d9cfe12058f20762fe61fbf14172">MEDlocalizationWr</a> / <a class="el" href="a01025_ga3e3019bacad60cb167ad43a7d6b2fc22.html#ga3e3019bacad60cb167ad43a7d6b2fc22">mlclow</a>. Un &eacute;l&eacute;ment de r&eacute;f&eacute;rence peut &ecirc;tre associ&eacute; &agrave; une famille d'interpolation. La cr&eacute;ation d'une fonction d'interpolation se fait avec la routine <a class="el" href="a01007_ga092f59b381b4374b4225e947ca64a31d.html#ga092f59b381b4374b4225e947ca64a31d">MEDinterpBaseFunctionWr</a> / <a class="el" href="a01022_ga6043fb74b17a756d1cb0e0130560db67.html#ga6043fb74b17a756d1cb0e0130560db67">mipcre</a>. L'&eacute;criture d'une fonction de forme se fait avec la routine <a class="el" href="a01007_ga092f59b381b4374b4225e947ca64a31d.html#ga092f59b381b4374b4225e947ca64a31d">MEDinterpBaseFunctionWr</a> / <a class="el" href="a01022_ga47fb2995a1a920e720901127669bddc8.html#ga47fb2995a1a920e720901127669bddc8">mipbfw</a>. La routine <a class="el" href="a01004_ga24dcf45f4323786d26ad93dceeb67d06.html#ga24dcf45f4323786d26ad93dceeb67d06">MEDfieldInterpWr</a> / <a class="el" href="a01019_gaff326bd7f644131b28f5a568b7809933.html#gaff326bd7f644131b28f5a568b7809933">mfdinw</a> permet d'associer une famille d'interpolation &agrave; un champ r&eacute;sultat. </p>
<p>Le cas d'utilisation suivant montre un exemple d'&eacute;criture des valeurs des champs aux points de Gauss avec d&eacute;finition des &eacute;l&eacute;ments de r&eacute;f&eacute;rence et r&eacute;f&eacute;rence &agrave; une famille d'interpolation.  </p>
<div class="fragment"><pre class="fragment"><span class="comment">/*  This file is part of MED.</span>
<span class="comment"> *</span>
<span class="comment"> *  COPYRIGHT (C) 1999 - 2012  EDF R&amp;D, CEA/DEN</span>
<span class="comment"> *  MED is free software: you can redistribute it and/or modify</span>
<span class="comment"> *  it under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> *  the Free Software Foundation, either version 3 of the License, or</span>
<span class="comment"> *  (at your option) any later version.</span>
<span class="comment"> *</span>
<span class="comment"> *  MED is distributed in the hope that it will be useful,</span>
<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment"> *  GNU Lesser General Public License for more details.</span>
<span class="comment"> *</span>
<span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> *  along with MED.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> */</span>

<span class="comment">/* </span>
<span class="comment"> * Field use case 10 : write a field in a MED file with computing steps,</span>
<span class="comment"> *                     profiles, integration points and interpolation families</span>
<span class="comment"> */</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;med_utils.h&gt;</span>

<span class="preprocessor">#include &lt;string.h&gt;</span>


<span class="keywordtype">int</span> <a class="code" href="a00750_a3c04138a5bfe5d72780bb7e82a18e627.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> fid;
  <span class="keyword">const</span> <span class="keywordtype">char</span> meshname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;2D unstructured mesh&quot;</span>;
  <span class="keyword">const</span> <span class="keywordtype">char</span> fieldname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;TEMPERATURE_FIELD&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> ncomponent = 1;
  <span class="keyword">const</span> <span class="keywordtype">char</span> componentname[<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1] = <span class="stringliteral">&quot;TEMPERATURE&quot;</span>;
  <span class="keyword">const</span> <span class="keywordtype">char</span> componentunit[<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1] = <span class="stringliteral">&quot;C&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> tria3values_step1_profile1[9] = {1000.,1010.,1020.,    
                                                   4000.,4010.,4020.,    
                                                   8000.,8010.,8020. };
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> tria3values_step2_profile1[24] = {1500.,1510.,1520.,    
                                                    0.,   0.,   0.,
                                                    0.,   0.,   0.,
                                                    4500.,4510,4520.,
                                                    0.,   0.,   0.,
                                                    0.,   0.,   0.,
                                                    0.,   0.,   0.,
                                                    8500., 8510, 8520 };
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> tria3values_step2_profile2[32] = {   0.,   0.,   0.,  0.,
                                                       2500.,2510.,2520,2530., 
                                                       3500.,3510.,3520.,3530.,    
                                                       0.,   0.,   0.,  0.,
                                                       5500.,5510.,5520.,5530., 
                                                       6500.,6510.,6520.,6530., 
                                                       7500.,7510.,7520.,7530.,   
                                                       0.,   0.,   0.,   0. };
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> ntria3 = 8;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nquad4 = 4;
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> quad4values_step1[4] = {10000., 20000., 30000., 40000.};
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> quad4values_step2[4] = {15000., 25000., 35000., 45000.};
  <span class="keyword">const</span> <span class="keywordtype">char</span> profile1name[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;MED_TRIA3_PROFILE1&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> profile1[3] = {1, 4, 8}; 
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> profile1size = 3;
  <span class="keyword">const</span> <span class="keywordtype">char</span> profile2name[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;MED_TRIA3_PROFILE2&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> profile2[5] = {2, 3, 5, 6, 7}; 
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> profile2size = 5;
  <span class="keyword">const</span> <span class="keywordtype">char</span> localization1name[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;TRIA3_INTEGRATION_POINTS_3&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> weight1[3] = {1.0/6, 1.0/6, 1.0/6};
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> elementcoordinate[6] = {0.0, 0.0,  1.0, 0.0,  0.0,1.0};
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> ipoint1coordinate[6] = {1.0/6, 1.0/6,  2.0/3, 1.0/6,  1.0/6, 2.0/6};
  <span class="keyword">const</span> <span class="keywordtype">char</span> localization2name[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;TRIA3_INTEGRATION_POINTS_4&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> weight2[6] = {25.0/(24*4), 25.0/(24*4), 25.0/(24*4), -27.0/(24*4)};
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> ipoint2coordinate[8] = {1.0/5, 1.0/5,  3.0/5, 1.0/5,  1.0/5, 3.0/5,  1.0/3, 1.0/3};
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nipoint, spacedim;
  <span class="keyword">const</span> <span class="keywordtype">char</span> interpname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;MED_TRIA3 interpolation family&quot;</span>;
  <span class="keywordtype">int</span> ret=-1;

  <span class="comment">/* file creation */</span>
  fid = <a class="code" href="a01005_ga9376a1654b7bf099c3f8941074c5fdfb.html#ga9376a1654b7bf099c3f8941074c5fdfb" title="Ouverture d&amp;#39;un fichier MED.">MEDfileOpen</a>(<span class="stringliteral">&quot;UsesCase_MEDfield_10.med&quot;</span>,<a class="code" href="a00321_adcd0322de9fec3b5e199ffeda3f44c85.html#adcd0322de9fec3b5e199ffeda3f44c85aa23dd1c18b596924d5f50c8402b84c8e">MED_ACC_CREAT</a>);
  <span class="keywordflow">if</span> (fid &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file creation ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/* create mesh link */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01009_ga08d1c8b15fbab77a11c6b59a0c600c4e.html#ga08d1c8b15fbab77a11c6b59a0c600c4e" title="Cette routine permet d&amp;#39;écrire un lien dans un fichier MED.">MEDlinkWr</a>(fid,meshname,<span class="stringliteral">&quot;./UsesCase_MEDmesh_1.med&quot;</span>) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : create mesh link ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }
  
  <span class="comment">/* create the profiles in the file */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01013_gaf7ec6ed01898dcfe98556f399ed044d1.html#gaf7ec6ed01898dcfe98556f399ed044d1" title="Cette routine permet d&amp;#39;écrire un profil dans un fichier MED.">MEDprofileWr</a>(fid, profile1name, profile1size, profile1 ) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : create profile ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR; 
  }

  <span class="keywordflow">if</span> (<a class="code" href="a01013_gaf7ec6ed01898dcfe98556f399ed044d1.html#gaf7ec6ed01898dcfe98556f399ed044d1" title="Cette routine permet d&amp;#39;écrire un profil dans un fichier MED.">MEDprofileWr</a>(fid, profile2name, profile2size, profile2 ) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : create profile ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR; 
  }

  <span class="comment">/* create the localization elements for integration points */</span>
  spacedim = 2;
  nipoint = 3;
  <span class="keywordflow">if</span> (<a class="code" href="a01010_ga77e9d9cfe12058f20762fe61fbf14172.html#ga77e9d9cfe12058f20762fe61fbf14172" title="Cette routine permet l&amp;#39;écriture d&amp;#39;une localisation localizationname de points...">MEDlocalizationWr</a>(fid, localization1name, <a class="code" href="a00321_a4a1eb7ba296742a6f5eb8b5b23b39670.html#a4a1eb7ba296742a6f5eb8b5b23b39670">MED_TRIA3</a>, spacedim, 
                        elementcoordinate, <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, 
                        nipoint, ipoint1coordinate, weight1,
                        <a class="code" href="a00321_a3e7915fabbbc5946451ebbb836ca0816.html#a3e7915fabbbc5946451ebbb836ca0816">MED_NO_INTERPOLATION</a>, <a class="code" href="a00321_aeb44e16b6ecf0f5f8aeefab3e60a1a2c.html#aeb44e16b6ecf0f5f8aeefab3e60a1a2c">MED_NO_MESH_SUPPORT</a>) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : create famlily of integration points ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR; 
  }

  spacedim = 2;
  nipoint = 4;
  <span class="keywordflow">if</span> (<a class="code" href="a01010_ga77e9d9cfe12058f20762fe61fbf14172.html#ga77e9d9cfe12058f20762fe61fbf14172" title="Cette routine permet l&amp;#39;écriture d&amp;#39;une localisation localizationname de points...">MEDlocalizationWr</a>(fid, localization2name, <a class="code" href="a00321_a4a1eb7ba296742a6f5eb8b5b23b39670.html#a4a1eb7ba296742a6f5eb8b5b23b39670">MED_TRIA3</a>, spacedim, 
                        elementcoordinate, <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, 
                        nipoint, ipoint2coordinate, weight2, 
                        <a class="code" href="a00321_a3e7915fabbbc5946451ebbb836ca0816.html#a3e7915fabbbc5946451ebbb836ca0816">MED_NO_INTERPOLATION</a>, <a class="code" href="a00321_aeb44e16b6ecf0f5f8aeefab3e60a1a2c.html#aeb44e16b6ecf0f5f8aeefab3e60a1a2c">MED_NO_MESH_SUPPORT</a>) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : create famlily of integration points ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR; 
  }

  <span class="comment">/* </span>
<span class="comment">   * Temperature field  creation : </span>
<span class="comment">   * - 1 component </span>
<span class="comment">   * - component unit : celsius degree</span>
<span class="comment">   * - mesh is the 2D unstructured mesh of UsecaseMEDmesh_1.c use case.</span>
<span class="comment">   * - computation step unit in &apos;ms&apos;</span>
<span class="comment">   */</span> 
  <span class="keywordflow">if</span> (<a class="code" href="a01004_ga8f73c6eb1a1b85f5e1e8bc1823c01ab9.html#ga8f73c6eb1a1b85f5e1e8bc1823c01ab9" title="Cette routine permet de créer un champ dans un fichier.">MEDfieldCr</a>(fid, fieldname, <a class="code" href="a00320_a7d730da9417184bffcdccc90a1749e27.html#a7d730da9417184bffcdccc90a1749e27ad44e111629f7a5811626b87c8b42b3ea">MED_FLOAT64</a>, 
                 ncomponent, componentname, componentunit,
                 <span class="stringliteral">&quot;ms&quot;</span>, meshname) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : create field&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/* write interpolation family name for MED_TRIA3 cell type */</span>
  <span class="comment">/* The interpolation family &quot;interpname&quot; is created in the UsesCase_MEDinterp_1 </span>
<span class="comment">     use case */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01004_ga24dcf45f4323786d26ad93dceeb67d06.html#ga24dcf45f4323786d26ad93dceeb67d06" title="Cette routine associe une fonction d&amp;#39;interpolation interpname au champ résultat...">MEDfieldInterpWr</a>(fid,fieldname,interpname) &lt;0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : write field interpolation family name ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }  
  
  <span class="comment">/* two computation steps */</span>
  <span class="comment">/* write values at cell centers : 8 MED_TRIA3 and 4 MED_QUAD4 */</span>

  <span class="comment">/* STEP 1 : dt1 = 5.5, it = 1*/</span>
  <span class="comment">/* MED_TRIA3 : with a profile of 3 values in compact memory storage mode </span>
<span class="comment">     and a family of 3 integration points */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01004_gac369c1fc64c95923cadfc39e41ea8f8d.html#gac369c1fc64c95923cadfc39e41ea8f8d" title="Cette routine permet d&amp;#39;écrire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileWr</a>(fid, fieldname, 1, 1, 5.5, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>,<a class="code" href="a00321_a4a1eb7ba296742a6f5eb8b5b23b39670.html#a4a1eb7ba296742a6f5eb8b5b23b39670">MED_TRIA3</a>, 
                                 <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, profile1name, localization1name,    
                                 <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>, 
                                 ntria3, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) tria3values_step1_profile1) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : write field values on MED_TRIA3&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }
   <span class="comment">/* MED_QUAD4  : with no profile */</span> 
  <span class="keywordflow">if</span> (<a class="code" href="a01004_gac369c1fc64c95923cadfc39e41ea8f8d.html#gac369c1fc64c95923cadfc39e41ea8f8d" title="Cette routine permet d&amp;#39;écrire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileWr</a>(fid, fieldname, 1, 1, 5.5, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>, <a class="code" href="a00321_a24ea9c52f5bde41d9a072925249ec06c.html#a24ea9c52f5bde41d9a072925249ec06c">MED_QUAD4</a>, 
                                 <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, <a class="code" href="a00321_aaa89a5e5e6d32de69614b70cf74e29cc.html#aaa89a5e5e6d32de69614b70cf74e29cc">MED_NO_PROFILE</a>, <a class="code" href="a00321_a2acd5f0b336ddb4026fe1dd314fbd1e0.html#a2acd5f0b336ddb4026fe1dd314fbd1e0">MED_NO_LOCALIZATION</a>,
                                 <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>, 
                                 nquad4, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) quad4values_step1) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : write field values on MED_QUAD4 &quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/* STEP 2 : dt2 = 8.9, it = 1*/</span>
  <span class="comment">/* MED_TRIA3 : with a profile of 3 values then a profile of 5 values in global memory storage mode </span>
<span class="comment">   * For each profile, a family of 3 and then 4 integration points */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01004_gac369c1fc64c95923cadfc39e41ea8f8d.html#gac369c1fc64c95923cadfc39e41ea8f8d" title="Cette routine permet d&amp;#39;écrire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileWr</a>(fid, fieldname, 2 , 1 , 8.9 , <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>, <a class="code" href="a00321_a4a1eb7ba296742a6f5eb8b5b23b39670.html#a4a1eb7ba296742a6f5eb8b5b23b39670">MED_TRIA3</a>, 
                                 <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da56cfcdcbbab7ddfc577de288697cd291">MED_GLOBAL_PFLMODE</a>, profile1name, localization1name,    
                                 <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>,  
                                 ntria3, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) tria3values_step2_profile1) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : write field values on MED_TRIA3 ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }
  <span class="keywordflow">if</span> (<a class="code" href="a01004_gac369c1fc64c95923cadfc39e41ea8f8d.html#gac369c1fc64c95923cadfc39e41ea8f8d" title="Cette routine permet d&amp;#39;écrire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileWr</a>(fid, fieldname, 2 , 1 , 8.9 , <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>, <a class="code" href="a00321_a4a1eb7ba296742a6f5eb8b5b23b39670.html#a4a1eb7ba296742a6f5eb8b5b23b39670">MED_TRIA3</a>, 
                                 <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da56cfcdcbbab7ddfc577de288697cd291">MED_GLOBAL_PFLMODE</a>, profile2name, localization2name,    
                                 <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>,  
                                 ntria3, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) tria3values_step2_profile2) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : write field values on MED_TRIA3 ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/* MED_QUAD4 : with no profile */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01004_gac369c1fc64c95923cadfc39e41ea8f8d.html#gac369c1fc64c95923cadfc39e41ea8f8d" title="Cette routine permet d&amp;#39;écrire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileWr</a>(fid, fieldname, 2, 1, 8.9, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>, <a class="code" href="a00321_a24ea9c52f5bde41d9a072925249ec06c.html#a24ea9c52f5bde41d9a072925249ec06c">MED_QUAD4</a>, 
                                 <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, <a class="code" href="a00321_aaa89a5e5e6d32de69614b70cf74e29cc.html#aaa89a5e5e6d32de69614b70cf74e29cc">MED_NO_PROFILE</a>, <a class="code" href="a00321_a2acd5f0b336ddb4026fe1dd314fbd1e0.html#a2acd5f0b336ddb4026fe1dd314fbd1e0">MED_NO_LOCALIZATION</a>,
                                 <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>,  
                                 nquad4, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) quad4values_step2) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : write field values on MED_QUAD4 ... &quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  ret=0;
 ERROR:
  
  <span class="comment">/* close file */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01005_ga12a0e901c376be997a41a073ce426283.html#ga12a0e901c376be997a41a073ce426283" title="Fermeture d&amp;#39;un fichier MED.">MEDfileClose</a>(fid) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : close file ...&quot;</span>);             
    ret=-1; 
  } 
  
  <span class="keywordflow">return</span> ret;
}

</pre></div> <p>A la lecture, la routine <a class="el" href="a01010_gad851cf003d23c5eb44d6486a33704611.html#gad851cf003d23c5eb44d6486a33704611">MEDlocalizationInfoByName</a> / <a class="el" href="a01025_ga6683562b497f7f70bc268f59ff01cbd2.html#ga6683562b497f7f70bc268f59ff01cbd2">mlclni</a> permet de lire les informations relatives &agrave; un &eacute;l&eacute;ment de r&eacute;f&eacute;rence dont on conna&icirc;t le nom. Une autre possibilit&eacute; est de lire le nombre d'&eacute;l&eacute;ment de r&eacute;f&eacute;rence avec la routine <a class="el" href="a01010_ga20dffbd06dc5272536b66fc6071be154.html#ga20dffbd06dc5272536b66fc6071be154">MEDnLocalization</a> / <a class="el" href="a01025_ga3349b77eb4a864520044d01ab79c5aa2.html#ga3349b77eb4a864520044d01ab79c5aa2">mlcnlc</a> et d'it&eacute;rer afin de r&eacute;cup&eacute;rer &agrave; chaque it&eacute;ration les informations relatives &agrave; l'&eacute;l&eacute;ment de r&eacute;f&eacute;rence avec la routine <a class="el" href="a01010_gac03d0ad34b8c2263d77795919fd0f1a3.html#gac03d0ad34b8c2263d77795919fd0f1a3">MEDlocalizationInfo</a> / <a class="el" href="a01025_gab36033ae8452e632f1f97703f115f60e.html#gab36033ae8452e632f1f97703f115f60e">mlclci</a> et lire l'&eacute;l&eacute;ment de r&eacute;f&eacute;rence avec la routine <a class="el" href="a01010_ga613df7c12919f60dc27d49ff8f1f35a3.html#ga613df7c12919f60dc27d49ff8f1f35a3">MEDlocalizationRd</a> / <a class="el" href="a01025_gabf223114658bfda32dd18b4bdf7363a5.html#gabf223114658bfda32dd18b4bdf7363a5">mlclor</a>. </p>
<p>Pour les fonctions d'interpolation, la routine <a class="el" href="a01007_ga52db69ec1e254d7bce0db9e28b4a1c5b.html#ga52db69ec1e254d7bce0db9e28b4a1c5b">MEDinterpInfoByName</a> / <a class="el" href="a01022_gaa7dc205e0c8064ecfa76afaf828bb42e.html#gaa7dc205e0c8064ecfa76afaf828bb42e">mipiin</a> informe des caract&eacute;ristiques de la fonction d'interpolation dont on conna&icirc;t le nom. Il est &eacute;galement possible de lire le nombre de famille d'interpolation avec la routine <a class="el" href="a01007_ga926e9c439534535a36ab17ed0d531f4c.html#ga926e9c439534535a36ab17ed0d531f4c">MEDnInterp</a> / <a class="el" href="a01022_gab0bc5d8a91ff9decf980673eba3850f2.html#gab0bc5d8a91ff9decf980673eba3850f2">mipnip</a> et d'it&eacute;rer sur ces familles. Ces deux fonctions renvoie le nombre de fonctions de forme. Il reste donc &agrave; it&eacute;rer sur chacune d'entre elles et d'appeler la routine <a class="el" href="a01007_ga4b372925585a18f52d243848718c632f.html#ga4b372925585a18f52d243848718c632f">MEDinterpBaseFunctionRd</a> / <a class="el" href="a01022_gaffcbfcdc12ace78e5fdfa3d3162f8785.html#gaffcbfcdc12ace78e5fdfa3d3162f8785">mipbfr</a> pour lire chaque polyn&ocirc;me. </p>
<p>Dans un champ de r&eacute;sultat, il est possible de lire le nombre de famille d'interpolation associ&eacute; aux champ avec la routine <a class="el" href="a01004_ga40fb41da7fb1dbc79b818a331af900be.html#ga40fb41da7fb1dbc79b818a331af900be">MEDfieldnInterp</a> / <a class="el" href="a01019_ga77ca99515e8c5a7c63dd93be92524378.html#ga77ca99515e8c5a7c63dd93be92524378">mfdnin</a> . En it&eacute;rant sur toutes ces familles, on peut lire le nom de chacune d'entre elles avec la routine <a class="el" href="a01004_gab6d2abef7c23801680e333ae1e2d3dbd.html#gab6d2abef7c23801680e333ae1e2d3dbd">MEDfieldInterpInfo</a> / <a class="el" href="a01019_ga5f118efae9186210e83f2347eddd81eb.html#ga5f118efae9186210e83f2347eddd81eb">mfdini</a>. </p>
<p>Le cas d'utilisation suivant propose une approche g&eacute;n&eacute;rique pour lire des champs aux points de Gauss d&eacute;finies sur les mailles d'un maillage. </p>
<div class="fragment"><pre class="fragment"><span class="comment">/*  This file is part of MED.</span>
<span class="comment"> *</span>
<span class="comment"> *  COPYRIGHT (C) 1999 - 2012  EDF R&amp;D, CEA/DEN</span>
<span class="comment"> *  MED is free software: you can redistribute it and/or modify</span>
<span class="comment"> *  it under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> *  the Free Software Foundation, either version 3 of the License, or</span>
<span class="comment"> *  (at your option) any later version.</span>
<span class="comment"> *</span>
<span class="comment"> *  MED is distributed in the hope that it will be useful,</span>
<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment"> *  GNU Lesser General Public License for more details.</span>
<span class="comment"> *</span>
<span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> *  along with MED.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> */</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;med_utils.h&gt;</span>

<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;med_utils.h&gt;</span>

<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="comment">/* </span>
<span class="comment"> * Field use case 12 : read a field (generic approach) in a MED file with computing steps,</span>
<span class="comment"> *                     profiles, integration points and interpolation families   </span>
<span class="comment"> */</span>


<span class="keywordtype">int</span> <a class="code" href="a00750_a3c04138a5bfe5d72780bb7e82a18e627.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> fid;
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> nfield, i, j;
  <span class="keywordtype">char</span> meshname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00321_a23f7fa6d76886ed3c91dc33b59190dee.html#a23f7fa6d76886ed3c91dc33b59190dee">med_bool</a> localmesh;
  <span class="keywordtype">char</span> fieldname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00321_a5615eeaf85e0b3f40b74bdd24178f2cd.html#a5615eeaf85e0b3f40b74bdd24178f2cd">med_field_type</a> fieldtype;
  <span class="keywordtype">char</span> *componentname = NULL;
  <span class="keywordtype">char</span> *componentunit = NULL;
  <span class="keywordtype">char</span> dtunit[<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> *values = NULL;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nstep, nvalues;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> ncomponent;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> csit, numit, numdt, it;
  <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> dt;
  <a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> geotype;
  <a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> *geotypes = <a class="code" href="a00499_a54c2e34174a890046d0a204fa1a918a8.html#a54c2e34174a890046d0a204fa1a918a8">MED_GET_CELL_GEOMETRY_TYPE</a>;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nprofile, pit, profilesize;
  <span class="keywordtype">char</span> profilename[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nintegrationpoint;
  <span class="keywordtype">char</span> localizationname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">int</span> k;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> ninterp;
  <span class="keywordtype">char</span> interpname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1];
  <span class="keywordtype">int</span> ret=-1;


  <span class="comment">/* open file */</span>
  fid = <a class="code" href="a01005_ga9376a1654b7bf099c3f8941074c5fdfb.html#ga9376a1654b7bf099c3f8941074c5fdfb" title="Ouverture d&amp;#39;un fichier MED.">MEDfileOpen</a>(<span class="stringliteral">&quot;UsesCase_MEDfield_10.med&quot;</span>,<a class="code" href="a00321_adcd0322de9fec3b5e199ffeda3f44c85.html#adcd0322de9fec3b5e199ffeda3f44c85a616bf8345c622a34f0787f42eb400f25">MED_ACC_RDONLY</a>);
  <span class="keywordflow">if</span> (fid &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : open file ...&quot;</span>);
    <span class="keywordflow">return</span> -1;
  }

  <span class="comment">/*</span>
<span class="comment">   * generic approach : how many fields in the file and identification</span>
<span class="comment">   * of each field.</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> ((nfield = <a class="code" href="a01004_ga0d8be6c1b6b24ff150a5adcb58831d93.html#ga0d8be6c1b6b24ff150a5adcb58831d93" title="Cette routine permet de lire le nombre de champs dans un fichier.">MEDnField</a>(fid)) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : How many fields in the file ...&quot;</span>);
    <span class="keywordflow">return</span> -1;
  }

  <span class="comment">/* </span>
<span class="comment">   * read values for each field</span>
<span class="comment">   */</span>
  <span class="keywordflow">for</span> (i=0; i&lt;nfield; i++) {

    <span class="keywordflow">if</span> ((ncomponent = <a class="code" href="a01004_gabe6258ebc74592af81c9b51379b7b7af.html#gabe6258ebc74592af81c9b51379b7b7af" title="Cette routine lit le nombre de composantes d&amp;#39;un champ.">MEDfieldnComponent</a>(fid,i+1)) &lt; 0) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : number of field component ...&quot;</span>);
      <span class="keywordflow">return</span> -1;
    }
    
    <span class="keywordflow">if</span> ((componentname = (<span class="keywordtype">char</span> *) malloc(ncomponent*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1)) == NULL) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : memory allocation ...&quot;</span>);
      <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">if</span> ((componentunit = (<span class="keywordtype">char</span> *) malloc(ncomponent*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1)) == NULL) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : memory allocation ...&quot;</span>);
      <span class="keywordflow">return</span> -1;
    }    

    <span class="keywordflow">if</span> (<a class="code" href="a01004_gaf2169b6d6505a28d7ee5f8599d2fb25e.html#gaf2169b6d6505a28d7ee5f8599d2fb25e" title="Cette routine permet de lire les informations d&amp;#39;indentification d&amp;#39;un champ...">MEDfieldInfo</a>(fid, i+1, fieldname, meshname, &amp;localmesh, &amp;fieldtype,
                     componentname, componentunit, dtunit, &amp;nstep) &lt; 0) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : Field info ...&quot;</span>);
      free(componentname);
      free(componentunit);
      <span class="keywordflow">return</span> -1;
    }

    free(componentname);
    free(componentunit);

    <span class="comment">/* </span>
<span class="comment">     * Read how many interpolation family name in the field ?  </span>
<span class="comment">     */</span>
    <span class="keywordflow">if</span> ((ninterp = <a class="code" href="a01004_ga40fb41da7fb1dbc79b818a331af900be.html#ga40fb41da7fb1dbc79b818a331af900be" title="Cette routine renvoie le nombre de fonctions d&amp;#39;interpolation associées au champ...">MEDfieldnInterp</a>(fid, fieldname)) &lt; 0) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : Read how many interpolation functions for the field ...&quot;</span>);
      <span class="keywordflow">return</span> -1;
    }
    <span class="comment">/* - Read each interlolation family name </span>
<span class="comment">     * - The way to read an interploation family and it&apos;s basis functions </span>
<span class="comment">     *  is described in UsesCase_MEDinterp_2 and UsesCase_MEDinterp_3 uses case</span>
<span class="comment">     */</span>
    <span class="keywordflow">for</span> (it=0; it&lt;ninterp; it++) {
      <span class="keywordflow">if</span> (<a class="code" href="a01004_gab6d2abef7c23801680e333ae1e2d3dbd.html#gab6d2abef7c23801680e333ae1e2d3dbd" title="Cette routine indique le nom interpname de la interpit ème fonction d&amp;#39;interpolation...">MEDfieldInterpInfo</a>(fid,fieldname,it+1,interpname) &lt; 0) {
        <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read interpolation family name ...&quot;</span>);
        <span class="keywordflow">return</span> -1;
      }
    }

    <span class="comment">/*</span>
<span class="comment">     * Read field values for each computing step </span>
<span class="comment">     */</span> 
    <span class="keywordflow">for</span> (csit=0; csit&lt;nstep; csit++) {

      <span class="keywordflow">if</span> (<a class="code" href="a01004_ga5b0031d3002518f1b2e134ff8c03dbc5.html#ga5b0031d3002518f1b2e134ff8c03dbc5" title="Cette routine permet de lire les informations caractérisant une séquence de calcul...">MEDfieldComputingStepInfo</a>(fid, fieldname, csit+1, &amp;numdt, &amp;numit, &amp;dt) &lt; 0) {
        <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : Computing step info ...&quot;</span>);
        <span class="keywordflow">return</span> -1;
      }

      <span class="comment">/* </span>
<span class="comment">       * ... In our case, we suppose that the field values are only defined on cells ... </span>
<span class="comment">       */</span>
      <span class="keywordflow">for</span> (it=1; it&lt;=<a class="code" href="a00321_abd42d91233c317ca8eb9b592e4502053.html#abd42d91233c317ca8eb9b592e4502053">MED_N_CELL_FIXED_GEO</a>; it++) {

        geotype = geotypes[it];

        <span class="comment">/*</span>
<span class="comment">         * How many profile for each geometry type ? </span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> ((nprofile = <a class="code" href="a01004_gab8ce8c33cfe01cbccbde8474a4c433ba.html#gab8ce8c33cfe01cbccbde8474a4c433ba" title="Cette routine permet de lire le nombre de profils référencés dans un champ pour...">MEDfieldnProfile</a>(fid, fieldname, numdt, numit, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>, geotype,
                                         profilename, localizationname)) &lt; 0) {
          <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read number of profile &quot;</span>);
          <span class="keywordflow">return</span> -1;
        }

        <span class="comment">/* </span>
<span class="comment">         * Read values for each profile</span>
<span class="comment">         */</span>
        <span class="keywordflow">for</span> (pit=0; pit&lt;nprofile; pit++) {
          
          <span class="keywordflow">if</span> ((nvalues = <a class="code" href="a01004_gaa45f3d32332f8410c35c51a77ee20740.html#gaa45f3d32332f8410c35c51a77ee20740" title="Cette routine permet de lire le nombre de valeurs à lire dans un champ pour une...">MEDfieldnValueWithProfile</a>(fid, fieldname, numdt, numit, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>, geotype,
                                                   pit+1, <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, profilename, &amp;profilesize,
                                                   localizationname, &amp;nintegrationpoint)) &lt; 0) {
            <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read number of values with a profile ...&quot;</span>);
            <span class="keywordflow">return</span> -1;
          } 
          
          <span class="keywordflow">if</span> (nvalues) {
            <span class="keywordflow">if</span> ((values = (<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> *) malloc(<span class="keyword">sizeof</span>(<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>)*nvalues*ncomponent*nintegrationpoint)) == NULL) {
              <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : memory allocation ...&quot;</span>);
              <span class="keywordflow">return</span> -1;
            }
            <span class="keywordflow">if</span> (<a class="code" href="a01004_ga85cf40e4f76b7f6e6036445a6c6108b4.html#ga85cf40e4f76b7f6e6036445a6c6108b4" title="Cette routine permet de lire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileRd</a>(fid, fieldname, numdt, numit, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>, geotype,
                                           <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, profilename,
                                           <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>, 
                                           (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) values) &lt; 0) {
              <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read fields values for cells ...&quot;</span>); 
              free(values);
              <span class="keywordflow">return</span> -1; 
            }  
            free(values);
          }
        }
      }
    }
  }
  
  ret=0;
 ERROR:

  <span class="comment">/* close file */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01005_ga12a0e901c376be997a41a073ce426283.html#ga12a0e901c376be997a41a073ce426283" title="Fermeture d&amp;#39;un fichier MED.">MEDfileClose</a>(fid) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : close file ...&quot;</span>);             
    ret=-1; 
  } 
  
  <span class="keywordflow">return</span> ret;
}
</pre></div> <p>Le cas d'utilisation suivant montre un exemple de cr&eacute;ation d'une famille d'interpolation. </p>
<div class="fragment"><pre class="fragment"><span class="comment">/*  This file is part of MED.</span>
<span class="comment"> *</span>
<span class="comment"> *  COPYRIGHT (C) 1999 - 2012  EDF R&amp;D, CEA/DEN</span>
<span class="comment"> *  MED is free software: you can redistribute it and/or modify</span>
<span class="comment"> *  it under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> *  the Free Software Foundation, either version 3 of the License, or</span>
<span class="comment"> *  (at your option) any later version.</span>
<span class="comment"> *</span>
<span class="comment"> *  MED is distributed in the hope that it will be useful,</span>
<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment"> *  GNU Lesser General Public License for more details.</span>
<span class="comment"> *</span>
<span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> *  along with MED.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> */</span>

<span class="comment">/* </span>
<span class="comment"> * Interp use case 1 : write an interpolation family </span>
<span class="comment"> * In this example, the interpolation family can be used with </span>
<span class="comment"> * the TEMPERATURE field of UsesCase_MEDfield_10 use case</span>
<span class="comment"> */</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;med_utils.h&gt;</span>

<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="keywordtype">int</span> <a class="code" href="a00750_a3c04138a5bfe5d72780bb7e82a18e627.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> fid;
  <span class="keywordtype">char</span> interpname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;MED_TRIA3 interpolation family&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nvariable=2;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> maxdegree=1;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nmaxcoefficient=3;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>         ncoefficient1_1 = 3;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>   <span class="keyword">const</span> power1_1[]         = {0,0,1,0,0,1};
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> <span class="keyword">const</span> coefficient1_1[]   = {1,-1,-1};

  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>         ncoefficient1_2 = 1;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>   <span class="keyword">const</span> power1_2[]         = {1,0};
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> <span class="keyword">const</span> coefficient1_2[]   = {1};

  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>         ncoefficient1_3 = 1;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>   <span class="keyword">const</span> power1_3[]         = {0,1};
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> <span class="keyword">const</span> coefficient1_3[]   = {1};
  <span class="keywordtype">int</span> ret=-1;

  <span class="comment">/* file creation */</span>
  fid = <a class="code" href="a01005_ga9376a1654b7bf099c3f8941074c5fdfb.html#ga9376a1654b7bf099c3f8941074c5fdfb" title="Ouverture d&amp;#39;un fichier MED.">MEDfileOpen</a>(<span class="stringliteral">&quot;UsesCase_MEDinterp_1.med&quot;</span>,<a class="code" href="a00321_adcd0322de9fec3b5e199ffeda3f44c85.html#adcd0322de9fec3b5e199ffeda3f44c85aa23dd1c18b596924d5f50c8402b84c8e">MED_ACC_CREAT</a>);
  <span class="keywordflow">if</span> (fid &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file creation ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }
 
  <span class="comment">/* Family interpolation creation :</span>
<span class="comment">     - reference element = MED_TRIA3 </span>
<span class="comment">     - integration points of UsesCase_MEDfield_10 use case </span>
<span class="comment">     are used to build the interpolation                 </span>
<span class="comment">     - basis functions are P1(X)= 1-X1-X2, P2(X)= X1, P3(X)= X2 </span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01007_ga0ce117ef792d8e10af325a57158bf58c.html#ga0ce117ef792d8e10af325a57158bf58c" title="Cette routine permet de créer une nouvelle fonction d&amp;#39;interpolation polynômiale...">MEDinterpCr</a>(fid, interpname, <a class="code" href="a00321_a4a1eb7ba296742a6f5eb8b5b23b39670.html#a4a1eb7ba296742a6f5eb8b5b23b39670">MED_TRIA3</a>, <a class="code" href="a00321_a23f7fa6d76886ed3c91dc33b59190dee.html#a23f7fa6d76886ed3c91dc33b59190deea30b70cc2a253ed4141db9a78ba696046">MED_FALSE</a>, nvariable, maxdegree, nmaxcoefficient) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : interpolation family creation ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/* Basis functions creation */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01007_ga092f59b381b4374b4225e947ca64a31d.html#ga092f59b381b4374b4225e947ca64a31d" title="Cette routine permet l&amp;#39;écriture d&amp;#39;une fonction de base/forme de l&amp;#39;interpolation...">MEDinterpBaseFunctionWr</a>(fid,interpname,1,ncoefficient1_1,power1_1,coefficient1_1) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : first base function creation ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }
  
  <span class="keywordflow">if</span> (<a class="code" href="a01007_ga092f59b381b4374b4225e947ca64a31d.html#ga092f59b381b4374b4225e947ca64a31d" title="Cette routine permet l&amp;#39;écriture d&amp;#39;une fonction de base/forme de l&amp;#39;interpolation...">MEDinterpBaseFunctionWr</a>(fid,interpname,2,ncoefficient1_2,power1_2,coefficient1_2) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : second base function creation ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="keywordflow">if</span> (<a class="code" href="a01007_ga092f59b381b4374b4225e947ca64a31d.html#ga092f59b381b4374b4225e947ca64a31d" title="Cette routine permet l&amp;#39;écriture d&amp;#39;une fonction de base/forme de l&amp;#39;interpolation...">MEDinterpBaseFunctionWr</a>(fid,interpname,3,ncoefficient1_3,power1_3,coefficient1_3) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : third base function creation ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  ret=0;
 ERROR:

  <span class="comment">/* close file */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01005_ga12a0e901c376be997a41a073ce426283.html#ga12a0e901c376be997a41a073ce426283" title="Fermeture d&amp;#39;un fichier MED.">MEDfileClose</a>(fid) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : close file ...&quot;</span>);             
    ret=-1; 
  } 
  
  <span class="keywordflow">return</span> ret;
}
</pre></div> <p>Le cas d'utilisation suivant montre un exemple de lecture de famille d'interpolation dont on conna&icirc;t le nom. </p>
<div class="fragment"><pre class="fragment"><span class="comment">/*  This file is part of MED.</span>
<span class="comment"> *</span>
<span class="comment"> *  COPYRIGHT (C) 1999 - 2012  EDF R&amp;D, CEA/DEN</span>
<span class="comment"> *  MED is free software: you can redistribute it and/or modify</span>
<span class="comment"> *  it under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> *  the Free Software Foundation, either version 3 of the License, or</span>
<span class="comment"> *  (at your option) any later version.</span>
<span class="comment"> *</span>
<span class="comment"> *  MED is distributed in the hope that it will be useful,</span>
<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment"> *  GNU Lesser General Public License for more details.</span>
<span class="comment"> *</span>
<span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> *  along with MED.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> */</span>

<span class="comment">/* </span>
<span class="comment"> * Interp use case 2 : read an interpolation family with a direct access by name</span>
<span class="comment"> * In this example, the interpolation family can be used with </span>
<span class="comment"> * the TEMPERATURE field of UsesCase_MEDfield_10 use case</span>
<span class="comment"> */</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;med_utils.h&gt;</span>

<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="keywordtype">int</span> <a class="code" href="a00750_a3c04138a5bfe5d72780bb7e82a18e627.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> fid;
  <span class="keyword">const</span> <span class="keywordtype">char</span> interpname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;MED_TRIA3 interpolation family&quot;</span>;
  <a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> geotype                    =<a class="code" href="a00321_a9a2843c7d6eacffdd9377b5bfb8a6de3.html#a9a2843c7d6eacffdd9377b5bfb8a6de3">MED_NONE</a>;
  <a class="code" href="a00321_a23f7fa6d76886ed3c91dc33b59190dee.html#a23f7fa6d76886ed3c91dc33b59190dee">med_bool</a>          cellnodes                  =<a class="code" href="a00321_a23f7fa6d76886ed3c91dc33b59190dee.html#a23f7fa6d76886ed3c91dc33b59190deea30b70cc2a253ed4141db9a78ba696046">MED_FALSE</a>;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>           nbasisfunc              =0;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>           nvariable               =0;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>           maxdegree                  =0;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>           nmaxcoefficient            =0;
  <span class="keywordtype">int</span>               basisfuncit                =0;
  <span class="keywordtype">int</span>               powerit                    =0;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>           ncoefficient            =0;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>*          power                      =NULL;
  <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>*        coefficient                =NULL;
  <span class="keywordtype">int</span>               coefficientit              =0;
  <span class="keywordtype">int</span> ret=-1;


  <span class="comment">/* file creation */</span>
  fid = <a class="code" href="a01005_ga9376a1654b7bf099c3f8941074c5fdfb.html#ga9376a1654b7bf099c3f8941074c5fdfb" title="Ouverture d&amp;#39;un fichier MED.">MEDfileOpen</a>(<span class="stringliteral">&quot;UsesCase_MEDinterp_1.med&quot;</span>,<a class="code" href="a00321_adcd0322de9fec3b5e199ffeda3f44c85.html#adcd0322de9fec3b5e199ffeda3f44c85a616bf8345c622a34f0787f42eb400f25">MED_ACC_RDONLY</a>);
  <span class="keywordflow">if</span> (fid &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file creation ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }
 
  <span class="comment">/* with direct access by the family name */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01007_ga52db69ec1e254d7bce0db9e28b4a1c5b.html#ga52db69ec1e254d7bce0db9e28b4a1c5b" title="Cette fonction informe des caractéristiques de la fonction d&amp;#39;interpolation nommée...">MEDinterpInfoByName</a>(fid,interpname,&amp;geotype,&amp;cellnodes,&amp;nbasisfunc,
                          &amp;nvariable,&amp;maxdegree,&amp;nmaxcoefficient) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : interpolation function information ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/* read each basis function */</span>
  <span class="keywordflow">for</span> ( basisfuncit=1; basisfuncit&lt;= nbasisfunc; ++basisfuncit) {

    <span class="keywordflow">if</span> ((ncoefficient = <a class="code" href="a01007_ga39b5f9f4822173655561a8e558bc9745.html#ga39b5f9f4822173655561a8e558bc9745" title="Cette routine retourne ne nombre de coefficients/monômes de la fonction de base/forme...">MEDinterpBaseFunctionCoefSize</a>(fid,interpname,basisfuncit) ) &lt;0 ) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read number of coefficient in the base function ...&quot;</span>);
      <span class="keywordflow">goto</span> ERROR;
    }

    coefficient = (<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>*) calloc(<span class="keyword">sizeof</span>(<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>),ncoefficient);
    power       = (<a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>*)   calloc(<span class="keyword">sizeof</span>(<a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>),nvariable*ncoefficient);
    
    <span class="keywordflow">if</span> (<a class="code" href="a01007_ga4b372925585a18f52d243848718c632f.html#ga4b372925585a18f52d243848718c632f" title="Cette routine permet la lecture d&amp;#39;une fonction de base/forme de l&amp;#39;interpolation...">MEDinterpBaseFunctionRd</a>(fid,interpname,basisfuncit,&amp;ncoefficient,power,coefficient) &lt; 0) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read base function ...&quot;</span>);
      free(coefficient); free(power);
      <span class="keywordflow">goto</span> ERROR;
    }

    free(coefficient);
    free(power);
  }

  ret=0;
 ERROR:
  
  
  <span class="comment">/* close file */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01005_ga12a0e901c376be997a41a073ce426283.html#ga12a0e901c376be997a41a073ce426283" title="Fermeture d&amp;#39;un fichier MED.">MEDfileClose</a>(fid) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : close file ...&quot;</span>);             
    ret=-1; 
  } 
  
  <span class="keywordflow">return</span> ret;
}
</pre></div> <p>Le cas d'utilisation suivant montre un exemple de lecture de famille d'interpolation par une approche it&eacute;rative. </p>
<div class="fragment"><pre class="fragment"><span class="comment">/*  This file is part of MED.</span>
<span class="comment"> *</span>
<span class="comment"> *  COPYRIGHT (C) 1999 - 2012  EDF R&amp;D, CEA/DEN</span>
<span class="comment"> *  MED is free software: you can redistribute it and/or modify</span>
<span class="comment"> *  it under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> *  the Free Software Foundation, either version 3 of the License, or</span>
<span class="comment"> *  (at your option) any later version.</span>
<span class="comment"> *</span>
<span class="comment"> *  MED is distributed in the hope that it will be useful,</span>
<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment"> *  GNU Lesser General Public License for more details.</span>
<span class="comment"> *</span>
<span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> *  along with MED.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> */</span>

<span class="comment">/* </span>
<span class="comment"> * Interp use case 1 : read an interpolation family with a generic access by an iterator.</span>
<span class="comment"> * In this example, the interpolation family can be used with </span>
<span class="comment"> * the TEMPERATURE field of UsesCase_MEDfield_10 use case</span>
<span class="comment"> */</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;med_utils.h&gt;</span>

<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="keywordtype">int</span> <a class="code" href="a00750_a3c04138a5bfe5d72780bb7e82a18e627.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> fid;
  <span class="keywordtype">char</span>              interpname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>           ninterp                    =0;
  <span class="keywordtype">int</span>               it                         =0;
  <a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> geotype                    =<a class="code" href="a00321_a9a2843c7d6eacffdd9377b5bfb8a6de3.html#a9a2843c7d6eacffdd9377b5bfb8a6de3">MED_NONE</a>;
  <a class="code" href="a00321_a23f7fa6d76886ed3c91dc33b59190dee.html#a23f7fa6d76886ed3c91dc33b59190dee">med_bool</a>          cellnodes                  =<a class="code" href="a00321_a23f7fa6d76886ed3c91dc33b59190dee.html#a23f7fa6d76886ed3c91dc33b59190deea30b70cc2a253ed4141db9a78ba696046">MED_FALSE</a>;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>           nbasisfunc              =0;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>           nvariable               =0;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>           maxdegree                  =0;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>           nmaxcoefficient            =0;
  <span class="keywordtype">int</span>               basisfuncit                =0;
  <span class="keywordtype">int</span>               powerit                    =0;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>           ncoefficient            =0;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>*          power                      =NULL;
  <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>*        coefficient                =NULL;
  <span class="keywordtype">int</span>               coefficientit              =0;
  <span class="keywordtype">int</span> ret=-1;


  <span class="comment">/* file creation */</span>
  fid = <a class="code" href="a01005_ga9376a1654b7bf099c3f8941074c5fdfb.html#ga9376a1654b7bf099c3f8941074c5fdfb" title="Ouverture d&amp;#39;un fichier MED.">MEDfileOpen</a>(<span class="stringliteral">&quot;UsesCase_MEDinterp_1.med&quot;</span>,<a class="code" href="a00321_adcd0322de9fec3b5e199ffeda3f44c85.html#adcd0322de9fec3b5e199ffeda3f44c85a616bf8345c622a34f0787f42eb400f25">MED_ACC_RDONLY</a>);
  <span class="keywordflow">if</span> (fid &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file creation ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }
 
  <span class="comment">/* how many interpolation family in the file ? */</span>
  <span class="keywordflow">if</span> ((ninterp = <a class="code" href="a01007_ga926e9c439534535a36ab17ed0d531f4c.html#ga926e9c439534535a36ab17ed0d531f4c" title="Cette routine renvoie le nombre d&amp;#39;interpolations disponibles dans le fichier...">MEDnInterp</a>(fid)) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read number of interpolation ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/* read each interpolation family */</span>
  <span class="comment">/* with an access by an iterator */</span>
  <span class="keywordflow">for</span> (it=1; it&lt;= ninterp; it++) {

    <span class="keywordflow">if</span> (<a class="code" href="a01007_ga9627e71ada4bcf04274dce8b0c0d0c7a.html#ga9627e71ada4bcf04274dce8b0c0d0c7a" title="Cette fonction informe des caractéristiques de la fonction d&amp;#39;interpolation n°...">MEDinterpInfo</a>(fid,it,interpname,&amp;geotype,&amp;cellnodes,&amp;nbasisfunc,
                      &amp;nvariable,&amp;maxdegree,&amp;nmaxcoefficient) &lt; 0) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : interpolation function information ...&quot;</span>);
      <span class="keywordflow">goto</span> ERROR;
    }

    <span class="comment">/* read each basis function */</span>
    <span class="keywordflow">for</span> ( basisfuncit=1; basisfuncit&lt;= nbasisfunc; ++basisfuncit) {
      <span class="keywordflow">if</span> ((ncoefficient = <a class="code" href="a01007_ga39b5f9f4822173655561a8e558bc9745.html#ga39b5f9f4822173655561a8e558bc9745" title="Cette routine retourne ne nombre de coefficients/monômes de la fonction de base/forme...">MEDinterpBaseFunctionCoefSize</a>(fid,interpname,basisfuncit) ) &lt;0 ) {
        <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read number of coefficient in the base function ...&quot;</span>);
        <span class="keywordflow">goto</span> ERROR;
      }
      
      coefficient = (<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>*) calloc(<span class="keyword">sizeof</span>(<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>),ncoefficient);
      power       = (<a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>*)   calloc(<span class="keyword">sizeof</span>(<a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>),nvariable*ncoefficient);
      
      <span class="keywordflow">if</span> (<a class="code" href="a01007_ga4b372925585a18f52d243848718c632f.html#ga4b372925585a18f52d243848718c632f" title="Cette routine permet la lecture d&amp;#39;une fonction de base/forme de l&amp;#39;interpolation...">MEDinterpBaseFunctionRd</a>(fid,interpname,basisfuncit,&amp;ncoefficient,power,coefficient) &lt; 0) {
        <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read base function ...&quot;</span>);
        free(coefficient); free(power);
        <span class="keywordflow">goto</span> ERROR;
      }

      free(coefficient);
      free(power);
    }

  }

  ret=0;
 ERROR:
  
  <span class="comment">/* close file */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01005_ga12a0e901c376be997a41a073ce426283.html#ga12a0e901c376be997a41a073ce426283" title="Fermeture d&amp;#39;un fichier MED.">MEDfileClose</a>(fid) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : close file ...&quot;</span>);             
    ret=-1; 
  } 
  
  <span class="keywordflow">return</span> ret;
}
</pre></div> <h3><a class="anchor" id="4."></a>Cr&eacute;er et lire un champ aux noeuds des &eacute;l&eacute;ments</h3>
<p>MED permet d'&eacute;crire et lire des champs aux noeuds des &eacute;l&eacute;ments d'un maillage. Pour cela, il suffit d'indiquer le mot cl&eacute; <a class="el" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a809ee1b85589bf7c0cf796b7212abc25">MED_NODE_ELEMENT</a> comme type d'entit&eacute; lors de l'appel des routines d'&eacute;criture / lecture des valeurs des champs comme le montrent les deux cas d'utilisation suivants. </p>
<div class="fragment"><pre class="fragment"><span class="comment">/*  This file is part of MED.</span>
<span class="comment"> *</span>
<span class="comment"> *  COPYRIGHT (C) 1999 - 2012  EDF R&amp;D, CEA/DEN</span>
<span class="comment"> *  MED is free software: you can redistribute it and/or modify</span>
<span class="comment"> *  it under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> *  the Free Software Foundation, either version 3 of the License, or</span>
<span class="comment"> *  (at your option) any later version.</span>
<span class="comment"> *</span>
<span class="comment"> *  MED is distributed in the hope that it will be useful,</span>
<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment"> *  GNU Lesser General Public License for more details.</span>
<span class="comment"> *</span>
<span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> *  along with MED.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> */</span>

<span class="comment">/* </span>
<span class="comment"> * Field use case 13 : write a field on nodes elements in a MED file</span>
<span class="comment"> */</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;med_utils.h&gt;</span>

<span class="preprocessor">#include &lt;string.h&gt;</span>


<span class="keywordtype">int</span> <a class="code" href="a00750_a3c04138a5bfe5d72780bb7e82a18e627.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> fid;
  <span class="keyword">const</span> <span class="keywordtype">char</span> meshname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;2D unstructured mesh&quot;</span>;
  <span class="keyword">const</span> <span class="keywordtype">char</span> fieldname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;TEMPERATURE_FIELD&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> ncomponent = 1;
  <span class="keyword">const</span> <span class="keywordtype">char</span> componentname[<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1] = <span class="stringliteral">&quot;TEMPERATURE&quot;</span>;
  <span class="keyword">const</span> <span class="keywordtype">char</span> componentunit[<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1] = <span class="stringliteral">&quot;C&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nquad4 = 4;
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> quad4values_step1[4*4] = { 10000.,  20000.,  30000.,  40000.,
                                             50000.,  60000.,  70000.,  80000.,
                                             90000., 100000., 110000., 120000.,
                                             130000., 140000., 150000., 160000. };
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> quad4values_step2[4*4] = { 100.,  200.,  300.,  400.,
                                             500.,  600.,  700.,  800.,
                                             900., 1000., 1100., 1200.,
                                             1300., 1400., 1500., 1600. };
  <span class="keywordtype">int</span> ret=-1;
  
  <span class="comment">/* file creation */</span>
  fid = <a class="code" href="a01005_ga9376a1654b7bf099c3f8941074c5fdfb.html#ga9376a1654b7bf099c3f8941074c5fdfb" title="Ouverture d&amp;#39;un fichier MED.">MEDfileOpen</a>(<span class="stringliteral">&quot;UsesCase_MEDfield_13.med&quot;</span>,<a class="code" href="a00321_adcd0322de9fec3b5e199ffeda3f44c85.html#adcd0322de9fec3b5e199ffeda3f44c85aa23dd1c18b596924d5f50c8402b84c8e">MED_ACC_CREAT</a>);
  <span class="keywordflow">if</span> (fid &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file creation ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/* create mesh link */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01009_ga08d1c8b15fbab77a11c6b59a0c600c4e.html#ga08d1c8b15fbab77a11c6b59a0c600c4e" title="Cette routine permet d&amp;#39;écrire un lien dans un fichier MED.">MEDlinkWr</a>(fid,meshname,<span class="stringliteral">&quot;./UsesCase_MEDmesh_1.med&quot;</span>) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : create mesh link ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }
  
  <span class="comment">/* </span>
<span class="comment">   * Temperature field  creation : </span>
<span class="comment">   * - 1 component </span>
<span class="comment">   * - component unit : celsius degree</span>
<span class="comment">   * - mesh is the 2D unstructured mesh of UsecaseMEDmesh_1.c use case.</span>
<span class="comment">   * - computation step unit in &apos;ms&apos;</span>
<span class="comment">   */</span> 
  <span class="keywordflow">if</span> (<a class="code" href="a01004_ga8f73c6eb1a1b85f5e1e8bc1823c01ab9.html#ga8f73c6eb1a1b85f5e1e8bc1823c01ab9" title="Cette routine permet de créer un champ dans un fichier.">MEDfieldCr</a>(fid, fieldname, <a class="code" href="a00320_a7d730da9417184bffcdccc90a1749e27.html#a7d730da9417184bffcdccc90a1749e27ad44e111629f7a5811626b87c8b42b3ea">MED_FLOAT64</a>, 
                 ncomponent, componentname, componentunit,
                 <span class="stringliteral">&quot;ms&quot;</span>, meshname) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : create field&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }
  
  <span class="comment">/* two computation steps */</span>
  <span class="comment">/* write values at nodes elements : 4 MED_QUAD4 */</span>

  <span class="comment">/* STEP 1 : dt1 = 5.5, it = 1*/</span>
  <span class="comment">/* MED_QUAD4  : with no profile */</span> 
  <span class="keywordflow">if</span> (<a class="code" href="a01004_gac369c1fc64c95923cadfc39e41ea8f8d.html#gac369c1fc64c95923cadfc39e41ea8f8d" title="Cette routine permet d&amp;#39;écrire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileWr</a>(fid, fieldname, 1, 1, 5.5, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a809ee1b85589bf7c0cf796b7212abc25">MED_NODE_ELEMENT</a>, <a class="code" href="a00321_a24ea9c52f5bde41d9a072925249ec06c.html#a24ea9c52f5bde41d9a072925249ec06c">MED_QUAD4</a>, 
                                 <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, <a class="code" href="a00321_aaa89a5e5e6d32de69614b70cf74e29cc.html#aaa89a5e5e6d32de69614b70cf74e29cc">MED_NO_PROFILE</a>, <a class="code" href="a00321_a2acd5f0b336ddb4026fe1dd314fbd1e0.html#a2acd5f0b336ddb4026fe1dd314fbd1e0">MED_NO_LOCALIZATION</a>,
                                 <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>, 
                                 nquad4, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) quad4values_step1) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : write field values on MED_QUAD4 &quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/* STEP 2 : dt2 = 8.9, it = 1*/</span>
  <span class="comment">/* MED_QUAD4 : with no profile */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01004_gac369c1fc64c95923cadfc39e41ea8f8d.html#gac369c1fc64c95923cadfc39e41ea8f8d" title="Cette routine permet d&amp;#39;écrire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileWr</a>(fid, fieldname, 2, 1, 8.9, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a809ee1b85589bf7c0cf796b7212abc25">MED_NODE_ELEMENT</a>, <a class="code" href="a00321_a24ea9c52f5bde41d9a072925249ec06c.html#a24ea9c52f5bde41d9a072925249ec06c">MED_QUAD4</a>, 
                                 <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, <a class="code" href="a00321_aaa89a5e5e6d32de69614b70cf74e29cc.html#aaa89a5e5e6d32de69614b70cf74e29cc">MED_NO_PROFILE</a>, <a class="code" href="a00321_a2acd5f0b336ddb4026fe1dd314fbd1e0.html#a2acd5f0b336ddb4026fe1dd314fbd1e0">MED_NO_LOCALIZATION</a>,
                                 <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>,  
                                 nquad4, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) quad4values_step2) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : write field values on MED_QUAD4 ... &quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  ret=0;
 ERROR:
  
  <span class="comment">/* close file */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01005_ga12a0e901c376be997a41a073ce426283.html#ga12a0e901c376be997a41a073ce426283" title="Fermeture d&amp;#39;un fichier MED.">MEDfileClose</a>(fid) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : close file ...&quot;</span>);             
    ret=-1; 
  } 
  
  <span class="keywordflow">return</span> ret;
}

</pre></div> <div class="fragment"><pre class="fragment"><span class="comment">/*  This file is part of MED.</span>
<span class="comment"> *</span>
<span class="comment"> *  COPYRIGHT (C) 1999 - 2012  EDF R&amp;D, CEA/DEN</span>
<span class="comment"> *  MED is free software: you can redistribute it and/or modify</span>
<span class="comment"> *  it under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> *  the Free Software Foundation, either version 3 of the License, or</span>
<span class="comment"> *  (at your option) any later version.</span>
<span class="comment"> *</span>
<span class="comment"> *  MED is distributed in the hope that it will be useful,</span>
<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment"> *  GNU Lesser General Public License for more details.</span>
<span class="comment"> *</span>
<span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> *  along with MED.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> */</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;med_utils.h&gt;</span>

<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;med_utils.h&gt;</span>

<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="comment">/* </span>
<span class="comment"> * Field use case 14 : read a field on nodes elements (generic approach) in a MED file</span>
<span class="comment"> */</span>


<span class="keywordtype">int</span> <a class="code" href="a00750_a3c04138a5bfe5d72780bb7e82a18e627.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> fid;
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> nfield, i, j;
  <span class="keywordtype">char</span> meshname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00321_a23f7fa6d76886ed3c91dc33b59190dee.html#a23f7fa6d76886ed3c91dc33b59190dee">med_bool</a> localmesh;
  <span class="keywordtype">char</span> fieldname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00321_a5615eeaf85e0b3f40b74bdd24178f2cd.html#a5615eeaf85e0b3f40b74bdd24178f2cd">med_field_type</a> fieldtype;
  <span class="keywordtype">char</span> *componentname = NULL;
  <span class="keywordtype">char</span> *componentunit = NULL;
  <span class="keywordtype">char</span> dtunit[<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> *values = NULL;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nstep, nvalues;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> ncomponent;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> csit, numit, numdt, it;
  <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> dt;
  <a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> geotype;
  <a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> *geotypes = <a class="code" href="a00499_a54c2e34174a890046d0a204fa1a918a8.html#a54c2e34174a890046d0a204fa1a918a8">MED_GET_CELL_GEOMETRY_TYPE</a>;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nprofile, pit, profilesize;
  <span class="keywordtype">char</span> profilename[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nintegrationpoint;
  <span class="keywordtype">char</span> localizationname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">int</span> k;
  <span class="keywordtype">int</span> ret=-1;

  <span class="comment">/* open file */</span>
  fid = <a class="code" href="a01005_ga9376a1654b7bf099c3f8941074c5fdfb.html#ga9376a1654b7bf099c3f8941074c5fdfb" title="Ouverture d&amp;#39;un fichier MED.">MEDfileOpen</a>(<span class="stringliteral">&quot;UsesCase_MEDfield_13.med&quot;</span>,<a class="code" href="a00321_adcd0322de9fec3b5e199ffeda3f44c85.html#adcd0322de9fec3b5e199ffeda3f44c85a616bf8345c622a34f0787f42eb400f25">MED_ACC_RDONLY</a>);
  <span class="keywordflow">if</span> (fid &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : open file ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/*</span>
<span class="comment">   * generic approach : how many fields in the file and identification</span>
<span class="comment">   * of each field.</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> ((nfield = <a class="code" href="a01004_ga0d8be6c1b6b24ff150a5adcb58831d93.html#ga0d8be6c1b6b24ff150a5adcb58831d93" title="Cette routine permet de lire le nombre de champs dans un fichier.">MEDnField</a>(fid)) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : How many fields in the file ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/* </span>
<span class="comment">   * read values for each field</span>
<span class="comment">   */</span>
  <span class="keywordflow">for</span> (i=0; i&lt;nfield; i++) {

    <span class="keywordflow">if</span> ((ncomponent = <a class="code" href="a01004_gabe6258ebc74592af81c9b51379b7b7af.html#gabe6258ebc74592af81c9b51379b7b7af" title="Cette routine lit le nombre de composantes d&amp;#39;un champ.">MEDfieldnComponent</a>(fid,i+1)) &lt; 0) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : number of field component ...&quot;</span>);
      <span class="keywordflow">goto</span> ERROR;
    }
    
    <span class="keywordflow">if</span> ((componentname = (<span class="keywordtype">char</span> *) malloc(ncomponent*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1)) == NULL) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : memory allocation ...&quot;</span>);
      <span class="keywordflow">goto</span> ERROR;
    }

    <span class="keywordflow">if</span> ((componentunit = (<span class="keywordtype">char</span> *) malloc(ncomponent*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1)) == NULL) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : memory allocation ...&quot;</span>);
      <span class="keywordflow">goto</span> ERROR;
    }    

    <span class="keywordflow">if</span> (<a class="code" href="a01004_gaf2169b6d6505a28d7ee5f8599d2fb25e.html#gaf2169b6d6505a28d7ee5f8599d2fb25e" title="Cette routine permet de lire les informations d&amp;#39;indentification d&amp;#39;un champ...">MEDfieldInfo</a>(fid, i+1, fieldname, meshname, &amp;localmesh, &amp;fieldtype,
                     componentname, componentunit, dtunit, &amp;nstep) &lt; 0) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : Field info ...&quot;</span>);
      free(componentname);
      free(componentunit);
      <span class="keywordflow">goto</span> ERROR;
    }

    free(componentname);
    free(componentunit);

    <span class="comment">/*</span>
<span class="comment">     * Read field values for each computing step </span>
<span class="comment">     */</span> 
    <span class="keywordflow">for</span> (csit=0; csit&lt;nstep; csit++) {

      <span class="keywordflow">if</span> (<a class="code" href="a01004_ga5b0031d3002518f1b2e134ff8c03dbc5.html#ga5b0031d3002518f1b2e134ff8c03dbc5" title="Cette routine permet de lire les informations caractérisant une séquence de calcul...">MEDfieldComputingStepInfo</a>(fid, fieldname, csit+1, &amp;numdt, &amp;numit, &amp;dt) &lt; 0) {
        <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : Computing step info ...&quot;</span>);
        <span class="keywordflow">goto</span> ERROR;
      }

      <span class="comment">/* </span>
<span class="comment">       * ... In our case, we suppose that the field values are only defined on nodes element ... </span>
<span class="comment">       */</span>
      <span class="keywordflow">for</span> (it=1; it&lt;= <a class="code" href="a00321_abd42d91233c317ca8eb9b592e4502053.html#abd42d91233c317ca8eb9b592e4502053">MED_N_CELL_FIXED_GEO</a>; it++) {

        geotype = geotypes[it];
        <span class="comment">/*</span>
<span class="comment">         * How many profile for each geometry type ? </span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> ((nprofile = <a class="code" href="a01004_gab8ce8c33cfe01cbccbde8474a4c433ba.html#gab8ce8c33cfe01cbccbde8474a4c433ba" title="Cette routine permet de lire le nombre de profils référencés dans un champ pour...">MEDfieldnProfile</a>(fid, fieldname, numdt, numit, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a809ee1b85589bf7c0cf796b7212abc25">MED_NODE_ELEMENT</a>, geotype,
                                         profilename, localizationname)) &lt; 0) {
          <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read number of profile &quot;</span>);
          <span class="keywordflow">goto</span> ERROR;
        }

        <span class="comment">/* </span>
<span class="comment">         * Read values for each profile</span>
<span class="comment">         */</span>
        <span class="keywordflow">for</span> (pit=0; pit&lt;nprofile; pit++) {
          
          <span class="keywordflow">if</span> ((nvalues = <a class="code" href="a01004_gaa45f3d32332f8410c35c51a77ee20740.html#gaa45f3d32332f8410c35c51a77ee20740" title="Cette routine permet de lire le nombre de valeurs à lire dans un champ pour une...">MEDfieldnValueWithProfile</a>(fid, fieldname, numdt, numit, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a809ee1b85589bf7c0cf796b7212abc25">MED_NODE_ELEMENT</a>, geotype,
                                                   pit+1, <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, profilename, &amp;profilesize,
                                                   localizationname, &amp;nintegrationpoint)) &lt; 0) {
            <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read number of values with a profile ...&quot;</span>);
            <span class="keywordflow">goto</span> ERROR;
          } 
          
          <span class="keywordflow">if</span> (nvalues) {
            <span class="keywordflow">if</span> ((values = (<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> *) malloc(<span class="keyword">sizeof</span>(<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>)*nvalues*ncomponent*nintegrationpoint)) == NULL) {
              <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : memory allocation ...&quot;</span>);
              <span class="keywordflow">goto</span> ERROR;
            }
            <span class="keywordflow">if</span> (<a class="code" href="a01004_ga85cf40e4f76b7f6e6036445a6c6108b4.html#ga85cf40e4f76b7f6e6036445a6c6108b4" title="Cette routine permet de lire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileRd</a>(fid, fieldname, numdt, numit, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a809ee1b85589bf7c0cf796b7212abc25">MED_NODE_ELEMENT</a>, geotype,
                                           <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, profilename,
                                           <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>, 
                                           (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) values) &lt; 0) {
              <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read fields values for cells ...&quot;</span>); 
              free(values);
              <span class="keywordflow">goto</span> ERROR; 
            }  
            free(values);
          }
        }
      }
    }
  }

  ret=0;
 ERROR:

  <span class="comment">/* close file */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01005_ga12a0e901c376be997a41a073ce426283.html#ga12a0e901c376be997a41a073ce426283" title="Fermeture d&amp;#39;un fichier MED.">MEDfileClose</a>(fid) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : close file ...&quot;</span>);             
    ret=-1; 
  } 
  
  <span class="keywordflow">return</span> ret;
}
</pre></div> <h3 style="page-break-before: always"><a class="anchor" id="5."></a>Cr&eacute;er et lire un champ li&eacute; &agrave; un maillage contenant des &eacute;l&eacute;ments de structure </h3>
<p>Au m&ecirc;me titre que pour types d'&eacute;l&eacute;ments pr&eacute;-d&eacute;finis dans le mod&egrave;le MED, MED permet l'&eacute;criture et la lecture de champs sur les &eacute;l&eacute;ments de structure. Pour cela, il suffit d'indiquer le mot cl&eacute; <a class="el" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470abdd6b14142920f599bbe4e97c4bb921e">MED_STRUCT_ELEMENT</a> comme type d'entit&eacute; lors de l'appel des routines d'&eacute;criture / lecture des valeurs des champs comme le montrent les deux cas d'utilisation suivants. </p>
<div class="fragment"><pre class="fragment"><span class="comment">/*  This file is part of MED.</span>
<span class="comment"> *</span>
<span class="comment"> *  COPYRIGHT (C) 1999 - 2012  EDF R&amp;D, CEA/DEN</span>
<span class="comment"> *  MED is free software: you can redistribute it and/or modify</span>
<span class="comment"> *  it under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> *  the Free Software Foundation, either version 3 of the License, or</span>
<span class="comment"> *  (at your option) any later version.</span>
<span class="comment"> *</span>
<span class="comment"> *  MED is distributed in the hope that it will be useful,</span>
<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment"> *  GNU Lesser General Public License for more details.</span>
<span class="comment"> *</span>
<span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> *  along with MED.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> */</span>

<span class="comment">/*</span>
<span class="comment"> * Field use case 15 : write a field in a MED file with </span>
<span class="comment"> * values defined on struct elements</span>
<span class="comment"> */</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;med_utils.h&gt;</span>

<span class="preprocessor">#include &lt;string.h&gt;</span>


<span class="keywordtype">int</span> <a class="code" href="a00750_a3c04138a5bfe5d72780bb7e82a18e627.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> fid=0,mfid=0;
  <span class="keyword">const</span> <span class="keywordtype">char</span> meshname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;COMPUT_MESH&quot;</span>;
  <span class="keyword">const</span> <span class="keywordtype">char</span> fieldname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;SPEED&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> ncomponent = 3;
  <span class="comment">/*                                              123456789012345612345678901234561234567890123456 */</span>   
  <span class="keyword">const</span> <span class="keywordtype">char</span> componentname[3*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1] = <span class="stringliteral">&quot;Vx              Vy              Vz&quot;</span>;
  <span class="keyword">const</span> <span class="keywordtype">char</span> componentunit[3*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1] = <span class="stringliteral">&quot;m/s             m/s             m/s&quot;</span>;
  <a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> geotype=<a class="code" href="a00321_a9a2843c7d6eacffdd9377b5bfb8a6de3.html#a9a2843c7d6eacffdd9377b5bfb8a6de3">MED_NONE</a>;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> npart = 3;
  <span class="keywordtype">char</span> structelementname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> part_speed1[3*3] = { 1.1, 2.2, 3.3,
                                 4.4, 5.5, 6.6,
                                 7.7, 8.8, 9.9 };
  <span class="keywordtype">int</span> ret=-1;


  <span class="comment">/* File creation to write the field */</span>
  fid = <a class="code" href="a01005_ga9376a1654b7bf099c3f8941074c5fdfb.html#ga9376a1654b7bf099c3f8941074c5fdfb" title="Ouverture d&amp;#39;un fichier MED.">MEDfileOpen</a>(<span class="stringliteral">&quot;UsesCase_MEDfield_15.med&quot;</span>,<a class="code" href="a00321_adcd0322de9fec3b5e199ffeda3f44c85.html#adcd0322de9fec3b5e199ffeda3f44c85aa23dd1c18b596924d5f50c8402b84c8e">MED_ACC_CREAT</a>);
  <span class="keywordflow">if</span> (fid &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file creation ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/* Create mesh link */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01009_ga08d1c8b15fbab77a11c6b59a0c600c4e.html#ga08d1c8b15fbab77a11c6b59a0c600c4e" title="Cette routine permet d&amp;#39;écrire un lien dans un fichier MED.">MEDlinkWr</a>(fid,meshname,<span class="stringliteral">&quot;./UsesCase_MEDstructElement_1.med&quot;</span>) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : create mesh link ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/*</span>
<span class="comment">   * Read struct element geometric type</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (( mfid=<a class="code" href="a01005_ga48b7eb3761d58928eb0e0b12d481e05a.html#ga48b7eb3761d58928eb0e0b12d481e05a" title="Cette routine permet de monter dans le fichier courant un type de données (exemples...">MEDfileObjectsMount</a>(fid,  <span class="stringliteral">&quot;UsesCase_MEDstructElement_1.med&quot;</span>,<a class="code" href="a00321_a5e06cfaa421118c530bd15f0628dc648.html#a5e06cfaa421118c530bd15f0628dc648a422c5a461a7ab3dba706091e79863ea1">MED_ELSTRUCT</a>)) &lt; 0 ) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file mounting ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  strcpy(structelementname,<a class="code" href="a00321_a786e7850e4d89a31047496e6fd48476d.html#a786e7850e4d89a31047496e6fd48476d">MED_PARTICLE_NAME</a>);
  geotype = <a class="code" href="a01014_gaf49779dbddeb78a562de0f913d3d087c.html#gaf49779dbddeb78a562de0f913d3d087c" title="Cette routine renvoie le type géométrique mgeotype associé au modèle d&amp;#39;éléments...">MEDstructElementGeotype</a>(fid,structelementname);


  <span class="comment">/*</span>
<span class="comment">   * Speed field  creation for particles :</span>
<span class="comment">   * - 3 component</span>
<span class="comment">   * - component unit : m/s</span>
<span class="comment">   * - mesh is the 3D computation mesh of UsesCase_MEDstructElement_1 use case.</span>
<span class="comment">   * - computation step unit in &apos;ms&apos;</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01004_ga8f73c6eb1a1b85f5e1e8bc1823c01ab9.html#ga8f73c6eb1a1b85f5e1e8bc1823c01ab9" title="Cette routine permet de créer un champ dans un fichier.">MEDfieldCr</a>(fid, fieldname, <a class="code" href="a00320_a7d730da9417184bffcdccc90a1749e27.html#a7d730da9417184bffcdccc90a1749e27ad44e111629f7a5811626b87c8b42b3ea">MED_FLOAT64</a>,
                 ncomponent, componentname, componentunit,
                 <span class="stringliteral">&quot;ms&quot;</span>, meshname) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : create field&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="keywordflow">if</span> (<a class="code" href="a01004_gac369c1fc64c95923cadfc39e41ea8f8d.html#gac369c1fc64c95923cadfc39e41ea8f8d" title="Cette routine permet d&amp;#39;écrire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileWr</a>(fid, fieldname, <a class="code" href="a00321_a8f72b6ceb3b6f5a67f9efd46cb90707a.html#a8f72b6ceb3b6f5a67f9efd46cb90707a">MED_NO_DT</a>, <a class="code" href="a00321_a95919207fd7a18ba26e6e03f04811e3f.html#a95919207fd7a18ba26e6e03f04811e3f">MED_NO_IT</a>, <a class="code" href="a00321_a609885580ce660eb5b7c80074d64f93f.html#a609885580ce660eb5b7c80074d64f93f">MED_UNDEF_DT</a>, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470abdd6b14142920f599bbe4e97c4bb921e">MED_STRUCT_ELEMENT</a>, geotype, 
                                 <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, <a class="code" href="a00321_aaa89a5e5e6d32de69614b70cf74e29cc.html#aaa89a5e5e6d32de69614b70cf74e29cc">MED_NO_PROFILE</a>, <a class="code" href="a00321_a2acd5f0b336ddb4026fe1dd314fbd1e0.html#a2acd5f0b336ddb4026fe1dd314fbd1e0">MED_NO_LOCALIZATION</a>,
                                 <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>,
                                 npart, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) part_speed1) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : write field values on MED_PARTICLE &quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="keywordflow">if</span> ( <a class="code" href="a01005_ga73ad912a369c3da7f22caf482093e47b.html#ga73ad912a369c3da7f22caf482093e47b" title="Une fois le démontage effectué, les données précédemment montées ne sont plus...">MEDfileObjectsUnmount</a>(fid, mfid, <a class="code" href="a00321_a5e06cfaa421118c530bd15f0628dc648.html#a5e06cfaa421118c530bd15f0628dc648a422c5a461a7ab3dba706091e79863ea1">MED_ELSTRUCT</a>) &lt; 0 ) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file unmounting ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  ret=0;
 ERROR:

  <span class="comment">/* close file */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01005_ga12a0e901c376be997a41a073ce426283.html#ga12a0e901c376be997a41a073ce426283" title="Fermeture d&amp;#39;un fichier MED.">MEDfileClose</a>(fid) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : close file ...&quot;</span>);
    ret=-1;
  }
  
  <span class="keywordflow">return</span> ret;
}

</pre></div> <div class="fragment"><pre class="fragment"><span class="comment">/*  This file is part of MED.</span>
<span class="comment"> *</span>
<span class="comment"> *  COPYRIGHT (C) 1999 - 2012  EDF R&amp;D, CEA/DEN</span>
<span class="comment"> *  MED is free software: you can redistribute it and/or modify</span>
<span class="comment"> *  it under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> *  the Free Software Foundation, either version 3 of the License, or</span>
<span class="comment"> *  (at your option) any later version.</span>
<span class="comment"> *</span>
<span class="comment"> *  MED is distributed in the hope that it will be useful,</span>
<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment"> *  GNU Lesser General Public License for more details.</span>
<span class="comment"> *</span>
<span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> *  along with MED.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> */</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;med_utils.h&gt;</span>

<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;med_utils.h&gt;</span>

<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="comment">/* </span>
<span class="comment"> * Field use case 16 : read a field (generic approach) in a MED file with </span>
<span class="comment"> * - values defined on struct elements</span>
<span class="comment"> */</span>


<span class="keywordtype">int</span> <a class="code" href="a00750_a3c04138a5bfe5d72780bb7e82a18e627.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> fid,mfid,sfid;
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> nfield, i, j;
  <span class="keywordtype">char</span> meshname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00321_a23f7fa6d76886ed3c91dc33b59190dee.html#a23f7fa6d76886ed3c91dc33b59190dee">med_bool</a> localmesh;
  <span class="keywordtype">char</span> fieldname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00321_a5615eeaf85e0b3f40b74bdd24178f2cd.html#a5615eeaf85e0b3f40b74bdd24178f2cd">med_field_type</a> fieldtype;
  <span class="keywordtype">char</span> *componentname = NULL;
  <span class="keywordtype">char</span> *componentunit = NULL;
  <span class="keywordtype">char</span> dtunit[<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> *values = NULL;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nstep, nvalues;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> ncomponent;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> csit, numit, numdt, it;
  <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> dt;
  <a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> *geotypes, geotype;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nmodels;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nprofile, pit, profilesize;
  <span class="keywordtype">char</span> profilename[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nintegrationpoint;
  <span class="keywordtype">char</span> localizationname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">int</span> k;
  <span class="keywordtype">char</span> elementname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1];
  <span class="keywordtype">char</span> supportmeshname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1];
  <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470">med_entity_type</a> entitype;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> elementdim;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nnode,ncell;
  <a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> geocelltype;
  <a class="code" href="a00321_a23f7fa6d76886ed3c91dc33b59190dee.html#a23f7fa6d76886ed3c91dc33b59190dee">med_bool</a> anyprofile=0;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nconstatt, *nvaratt;
  <span class="keywordtype">int</span> ret=-1;

  <span class="comment">/* open file */</span>
  fid = <a class="code" href="a01005_ga9376a1654b7bf099c3f8941074c5fdfb.html#ga9376a1654b7bf099c3f8941074c5fdfb" title="Ouverture d&amp;#39;un fichier MED.">MEDfileOpen</a>(<span class="stringliteral">&quot;UsesCase_MEDfield_15.med&quot;</span>,<a class="code" href="a00321_adcd0322de9fec3b5e199ffeda3f44c85.html#adcd0322de9fec3b5e199ffeda3f44c85ab53f10a6b700d1087d7a50710fe29f00">MED_ACC_RDWR</a>);
  <span class="keywordflow">if</span> (fid &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : open file ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="keywordflow">if</span> (( mfid=<a class="code" href="a01005_ga48b7eb3761d58928eb0e0b12d481e05a.html#ga48b7eb3761d58928eb0e0b12d481e05a" title="Cette routine permet de monter dans le fichier courant un type de données (exemples...">MEDfileObjectsMount</a>(fid,  <span class="stringliteral">&quot;UsesCase_MEDstructElement_1.med&quot;</span>,<a class="code" href="a00321_a5e06cfaa421118c530bd15f0628dc648.html#a5e06cfaa421118c530bd15f0628dc648aacc8c82fc9fded29cf134979f0379a06">MED_MESH_SUPPORT</a>)) &lt; 0 ) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file mounting ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="keywordflow">if</span> (( sfid=<a class="code" href="a01005_ga48b7eb3761d58928eb0e0b12d481e05a.html#ga48b7eb3761d58928eb0e0b12d481e05a" title="Cette routine permet de monter dans le fichier courant un type de données (exemples...">MEDfileObjectsMount</a>(fid,  <span class="stringliteral">&quot;UsesCase_MEDstructElement_1.med&quot;</span>,<a class="code" href="a00321_a5e06cfaa421118c530bd15f0628dc648.html#a5e06cfaa421118c530bd15f0628dc648a422c5a461a7ab3dba706091e79863ea1">MED_ELSTRUCT</a>)) &lt; 0 ) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file mounting ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/* How many struct element models ? */</span>
  <span class="keywordflow">if</span> ((nmodels =  <a class="code" href="a01014_ga09f7085855b24af662c32291d0816a59.html#ga09f7085855b24af662c32291d0816a59" title="Cette routine renvoie le nombre de modèles d&amp;#39;éléments de structure.">MEDnStructElement</a>(mfid)) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read number of struct element models ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }
  geotypes = (<a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> *) malloc(<span class="keyword">sizeof</span>(<a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a>)*nmodels);
  nvaratt = (<a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> *) malloc(<span class="keyword">sizeof</span>(<a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>)*nmodels);

  <span class="keywordflow">for</span> (it=0; it&lt;nmodels; it++) {
    <span class="keywordflow">if</span> (<a class="code" href="a01014_ga6caf4937712d2a1d39ab1fd1482f61a3.html#ga6caf4937712d2a1d39ab1fd1482f61a3" title="Cette routine décrit les caractéristiques d&amp;#39;un modèle d&amp;#39;élément de structure...">MEDstructElementInfo</a>(mfid, it+1, elementname, geotypes+it, &amp;elementdim,
                             supportmeshname, &amp;entitype, &amp;nnode, &amp;ncell,
                             &amp;geocelltype, &amp;nconstatt, &amp;anyprofile, nvaratt+it) &lt; 0) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : struct element models information ...&quot;</span>);
      free(nvaratt);
      <span class="keywordflow">goto</span> ERROR;
    }
  }
  free(nvaratt);


  <span class="comment">/*</span>
<span class="comment">   * generic approach : how many fields in the file and identification</span>
<span class="comment">   * of each field.</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> ((nfield = <a class="code" href="a01004_ga0d8be6c1b6b24ff150a5adcb58831d93.html#ga0d8be6c1b6b24ff150a5adcb58831d93" title="Cette routine permet de lire le nombre de champs dans un fichier.">MEDnField</a>(fid)) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : How many fields in the file ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/*</span>
<span class="comment">   * read values for each field</span>
<span class="comment">   */</span>
  <span class="keywordflow">for</span> (i=0; i&lt;nfield; i++) {

    <span class="keywordflow">if</span> ((ncomponent = <a class="code" href="a01004_gabe6258ebc74592af81c9b51379b7b7af.html#gabe6258ebc74592af81c9b51379b7b7af" title="Cette routine lit le nombre de composantes d&amp;#39;un champ.">MEDfieldnComponent</a>(fid,i+1)) &lt; 0) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : number of field component ...&quot;</span>);
      <span class="keywordflow">goto</span> ERROR;
    }
    
    <span class="keywordflow">if</span> ((componentname = (<span class="keywordtype">char</span> *) malloc(ncomponent*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1)) == NULL) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : memory allocation ...&quot;</span>);
      <span class="keywordflow">goto</span> ERROR;
    }

    <span class="keywordflow">if</span> ((componentunit = (<span class="keywordtype">char</span> *) malloc(ncomponent*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1)) == NULL) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : memory allocation ...&quot;</span>);
      <span class="keywordflow">goto</span> ERROR;
    }

    <span class="keywordflow">if</span> (<a class="code" href="a01004_gaf2169b6d6505a28d7ee5f8599d2fb25e.html#gaf2169b6d6505a28d7ee5f8599d2fb25e" title="Cette routine permet de lire les informations d&amp;#39;indentification d&amp;#39;un champ...">MEDfieldInfo</a>(fid, i+1, fieldname, meshname, &amp;localmesh, &amp;fieldtype,
                     componentname, componentunit, dtunit, &amp;nstep) &lt; 0) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : Field info ...&quot;</span>);
      free(componentname);
      free(componentunit);
      <span class="keywordflow">goto</span> ERROR;
    }

    free(componentname);
    free(componentunit);

    <span class="comment">/*</span>
<span class="comment">     * Read field values for each computing step </span>
<span class="comment">     */</span> 
    <span class="keywordflow">for</span> (csit=0; csit&lt;nstep; csit++) {

      <span class="keywordflow">if</span> (<a class="code" href="a01004_ga5b0031d3002518f1b2e134ff8c03dbc5.html#ga5b0031d3002518f1b2e134ff8c03dbc5" title="Cette routine permet de lire les informations caractérisant une séquence de calcul...">MEDfieldComputingStepInfo</a>(fid, fieldname, csit+1, &amp;numdt, &amp;numit, &amp;dt) &lt; 0) {
        <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : Computing step info ...&quot;</span>);
        <span class="keywordflow">goto</span> ERROR;
      }

      <span class="comment">/* </span>
<span class="comment">       * ... In our case, we suppose that the field values are only defined on struct element ... </span>
<span class="comment">       */</span>
      <span class="keywordflow">for</span> (it=0; it&lt;nmodels; it++) {

        geotype = *(geotypes+it);
     
        <span class="comment">/*</span>
<span class="comment">         * How many profile for each geometry type ? </span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> ((nprofile = <a class="code" href="a01004_gab8ce8c33cfe01cbccbde8474a4c433ba.html#gab8ce8c33cfe01cbccbde8474a4c433ba" title="Cette routine permet de lire le nombre de profils référencés dans un champ pour...">MEDfieldnProfile</a>(fid, fieldname, numdt, numit, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470abdd6b14142920f599bbe4e97c4bb921e">MED_STRUCT_ELEMENT</a>, geotype,
                                         profilename, localizationname)) &lt; 0) {
          <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read number of profile &quot;</span>);
          <span class="keywordflow">goto</span> ERROR;
        }
        
        <span class="comment">/* </span>
<span class="comment">         * Read values for each profile</span>
<span class="comment">         */</span>
        <span class="keywordflow">for</span> (pit=0; pit&lt;nprofile; pit++) {
          
          <span class="keywordflow">if</span> ((nvalues = <a class="code" href="a01004_gaa45f3d32332f8410c35c51a77ee20740.html#gaa45f3d32332f8410c35c51a77ee20740" title="Cette routine permet de lire le nombre de valeurs à lire dans un champ pour une...">MEDfieldnValueWithProfile</a>(fid, fieldname, numdt, numit, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470abdd6b14142920f599bbe4e97c4bb921e">MED_STRUCT_ELEMENT</a>, geotype,
                                                   pit+1, <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, profilename, &amp;profilesize,
                                                   localizationname, &amp;nintegrationpoint)) &lt; 0) {
            <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read number of values with a profile ...&quot;</span>);
            <span class="keywordflow">goto</span> ERROR;
          } 
          
          <span class="keywordflow">if</span> (nvalues) {
            <span class="keywordflow">if</span> ((values = (<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> *) malloc(<span class="keyword">sizeof</span>(<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>)*nvalues*ncomponent*nintegrationpoint)) == NULL) {
              <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : memory allocation ...&quot;</span>);
              <span class="keywordflow">goto</span> ERROR;
            }
            <span class="keywordflow">if</span> (<a class="code" href="a01004_ga85cf40e4f76b7f6e6036445a6c6108b4.html#ga85cf40e4f76b7f6e6036445a6c6108b4" title="Cette routine permet de lire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileRd</a>(fid, fieldname, numdt, numit, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470abdd6b14142920f599bbe4e97c4bb921e">MED_STRUCT_ELEMENT</a>, geotype,
                                           <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, profilename,
                                           <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>, 
                                           (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) values) &lt; 0) {
              <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read fields values for cells ...&quot;</span>); 
              <span class="keywordflow">goto</span> ERROR; 
              free(values);
            }  
            free(values);
          }
        }
      }
    }
  }
  
  ret=0;
 ERROR :

  free(geotypes);

  <span class="keywordflow">if</span> ( <a class="code" href="a01005_ga73ad912a369c3da7f22caf482093e47b.html#ga73ad912a369c3da7f22caf482093e47b" title="Une fois le démontage effectué, les données précédemment montées ne sont plus...">MEDfileObjectsUnmount</a>(fid, sfid, <a class="code" href="a00321_a5e06cfaa421118c530bd15f0628dc648.html#a5e06cfaa421118c530bd15f0628dc648a422c5a461a7ab3dba706091e79863ea1">MED_ELSTRUCT</a>) &lt; 0 ) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file unmounting ...&quot;</span>);
    ret=-1;
  }

  <span class="keywordflow">if</span> ( <a class="code" href="a01005_ga73ad912a369c3da7f22caf482093e47b.html#ga73ad912a369c3da7f22caf482093e47b" title="Une fois le démontage effectué, les données précédemment montées ne sont plus...">MEDfileObjectsUnmount</a>(fid, mfid, <a class="code" href="a00321_a5e06cfaa421118c530bd15f0628dc648.html#a5e06cfaa421118c530bd15f0628dc648aacc8c82fc9fded29cf134979f0379a06">MED_MESH_SUPPORT</a>) &lt; 0 ) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file unmounting ...&quot;</span>);
    ret= -1;
  }

  <span class="comment">/* close file */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01005_ga12a0e901c376be997a41a073ce426283.html#ga12a0e901c376be997a41a073ce426283" title="Fermeture d&amp;#39;un fichier MED.">MEDfileClose</a>(fid) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : close file ...&quot;</span>);             
    ret= -1; 
  } 
  
  <span class="keywordflow">return</span> ret;
}
</pre></div> <p>Il est &eacute;galement possible de d&eacute;finir des champs aux points d'int&eacute;gration des &eacute;l&eacute;ments de structure. Dans ce cas l&agrave;, l'&eacute;l&eacute;ment de r&eacute;f&eacute;rence est d&eacute;j&agrave; d&eacute;crit &agrave; la d&eacute;finition de l'&eacute;l&eacute;ment de structure. Les coordonn&eacute;es des points d'int&eacute;gration y sont relatives. Il est possible d'indiquer l'utilisation d'un maillage support d&eacute;finissant une section du mod&egrave;le d'&eacute;l&eacute;ment de structure. Ce maillage support est alors utilis&eacute; comme section de l'&eacute;l&eacute;ment de structure &agrave; chaque point d'int&eacute;gration. Auquel cas un champ utilisant cette localisation d&eacute;finira autant de valeur par &eacute;l&eacute;ment qu'il y a de maille dans le maillage section de chaque point d'int&eacute;gration comme montrent les deux cas d'utilisation suivants. </p>
<div class="fragment"><pre class="fragment"><span class="comment">/*  This file is part of MED.</span>
<span class="comment"> *</span>
<span class="comment"> *  COPYRIGHT (C) 1999 - 2012  EDF R&amp;D, CEA/DEN</span>
<span class="comment"> *  MED is free software: you can redistribute it and/or modify</span>
<span class="comment"> *  it under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> *  the Free Software Foundation, either version 3 of the License, or</span>
<span class="comment"> *  (at your option) any later version.</span>
<span class="comment"> *</span>
<span class="comment"> *  MED is distributed in the hope that it will be useful,</span>
<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment"> *  GNU Lesser General Public License for more details.</span>
<span class="comment"> *</span>
<span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> *  along with MED.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> */</span>

<span class="comment">/*</span>
<span class="comment"> * Field use case 17 : write a field in a MED file with </span>
<span class="comment"> *                     values defined on integration points</span>
<span class="comment"> *                     on struct elements </span>
<span class="comment"> */</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;med_utils.h&gt;</span>

<span class="preprocessor">#include &lt;string.h&gt;</span>


<span class="keywordtype">int</span> <a class="code" href="a00750_a3c04138a5bfe5d72780bb7e82a18e627.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> fid=0,mfid=0,sfid=0;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> spacedim = 3;
  <span class="keyword">const</span> <span class="keywordtype">char</span> meshname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;COMPUT_MESH&quot;</span>;
  <span class="keyword">const</span> <span class="keywordtype">char</span> fieldname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;TEMPERATURE&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> ncomponent = 1;
  <span class="comment">/*                                      1234567890123456123456*/</span>   
  <span class="keyword">const</span> <span class="keywordtype">char</span> componentname[<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1] = <span class="stringliteral">&quot;TEMP            &quot;</span>;
  <span class="keyword">const</span> <span class="keywordtype">char</span> componentunit[<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1] = <span class="stringliteral">&quot;CELSIUS         &quot;</span>;
  <a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> geotype=<a class="code" href="a00321_a9a2843c7d6eacffdd9377b5bfb8a6de3.html#a9a2843c7d6eacffdd9377b5bfb8a6de3">MED_NONE</a>;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nbeam = 1;
  <span class="keywordtype">char</span> structelementname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1];
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> tempvalue[3*1*4] = { 1.1, 2.2, 3.3, 4.4, 
                                       5.5, 6.6, 7.7, 8.8, 
                                       9.9, 10.1,11.11, 12.12};
  <span class="keyword">const</span> <span class="keywordtype">char</span> localization[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;BEAM_INTEGRATION_POINTS&quot;</span>;
  <span class="keyword">const</span> <span class="keywordtype">char</span> localization2[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;BEAM_INTEGRATION_TRANSF&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> elementcoordinate[3*3] = { 0.0,0.0,0.0,
                                             0.0,0.0,0.0,
                                             0.0,0.0,0.0,};
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> ipointcoordinate[3*3] = { 0.0,0.0,2.5,
                                            0.0,0.0,3.5,
                                            0.0,0.0,4.5};
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> weight[4] = {1.0/4, 1.0/4, 1.0/4, 1.0/4};
  <span class="keyword">const</span> <span class="keywordtype">char</span> beamsectionname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;BEAM_SECTION_MESH&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nipoint = 3;
  <span class="keywordtype">char</span> interpname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1] = <span class="stringliteral">&quot;geometrical transformation&quot;</span>;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nvariable=2;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> maxdegree=1;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nmaxcoefficient=3;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>         ncoefficient1_1 = 3;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>   <span class="keyword">const</span> power1_1[]         = {0,0,1,0,0,1};
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> <span class="keyword">const</span> coefficient1_1[]   = {1,-1,-1};
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>         ncoefficient1_2 = 1;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>   <span class="keyword">const</span> power1_2[]         = {1,0};
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> <span class="keyword">const</span> coefficient1_2[]   = {1};
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>         ncoefficient1_3 = 1;
  <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>   <span class="keyword">const</span> power1_3[]         = {0,1};
  <span class="keyword">const</span> <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> <span class="keyword">const</span> coefficient1_3[]   = {1};
  <span class="keywordtype">int</span> ret=-1;


  <span class="comment">/* Open file to write the field */</span>
  fid = <a class="code" href="a01005_ga9376a1654b7bf099c3f8941074c5fdfb.html#ga9376a1654b7bf099c3f8941074c5fdfb" title="Ouverture d&amp;#39;un fichier MED.">MEDfileOpen</a>(<span class="stringliteral">&quot;UsesCase_MEDfield_17.med&quot;</span>,<a class="code" href="a00321_adcd0322de9fec3b5e199ffeda3f44c85.html#adcd0322de9fec3b5e199ffeda3f44c85aa23dd1c18b596924d5f50c8402b84c8e">MED_ACC_CREAT</a>);
  <span class="keywordflow">if</span> (fid &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file creation ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="keywordflow">if</span> (( mfid=<a class="code" href="a01005_ga48b7eb3761d58928eb0e0b12d481e05a.html#ga48b7eb3761d58928eb0e0b12d481e05a" title="Cette routine permet de monter dans le fichier courant un type de données (exemples...">MEDfileObjectsMount</a>(fid,  <span class="stringliteral">&quot;UsesCase_MEDstructElement_1.med&quot;</span>,<a class="code" href="a00321_a5e06cfaa421118c530bd15f0628dc648.html#a5e06cfaa421118c530bd15f0628dc648aacc8c82fc9fded29cf134979f0379a06">MED_MESH_SUPPORT</a>)) &lt; 0 ) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file mounting ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="keywordflow">if</span> (( sfid=<a class="code" href="a01005_ga48b7eb3761d58928eb0e0b12d481e05a.html#ga48b7eb3761d58928eb0e0b12d481e05a" title="Cette routine permet de monter dans le fichier courant un type de données (exemples...">MEDfileObjectsMount</a>(fid,  <span class="stringliteral">&quot;UsesCase_MEDstructElement_1.med&quot;</span>,<a class="code" href="a00321_a5e06cfaa421118c530bd15f0628dc648.html#a5e06cfaa421118c530bd15f0628dc648a422c5a461a7ab3dba706091e79863ea1">MED_ELSTRUCT</a>)) &lt; 0 ) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file mounting ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/* Create mesh link */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01009_ga08d1c8b15fbab77a11c6b59a0c600c4e.html#ga08d1c8b15fbab77a11c6b59a0c600c4e" title="Cette routine permet d&amp;#39;écrire un lien dans un fichier MED.">MEDlinkWr</a>(fid,meshname,<span class="stringliteral">&quot;./UsesCase_MEDstructElement_1.med&quot;</span>) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : create mesh link ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/*</span>
<span class="comment">   * Read struct element geometric type</span>
<span class="comment">   */</span>
  strcpy(structelementname,<a class="code" href="a00321_a738baa2a243efa4f2e957c2a75b616c1.html#a738baa2a243efa4f2e957c2a75b616c1">MED_BEAM_NAME</a>);
  geotype = <a class="code" href="a01014_gaf49779dbddeb78a562de0f913d3d087c.html#gaf49779dbddeb78a562de0f913d3d087c" title="Cette routine renvoie le type géométrique mgeotype associé au modèle d&amp;#39;éléments...">MEDstructElementGeotype</a>(fid,structelementname);


  <span class="comment">/* create a geometrical transformation fonction */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01007_ga0ce117ef792d8e10af325a57158bf58c.html#ga0ce117ef792d8e10af325a57158bf58c" title="Cette routine permet de créer une nouvelle fonction d&amp;#39;interpolation polynômiale...">MEDinterpCr</a>(fid, interpname, geotype, <a class="code" href="a00321_a23f7fa6d76886ed3c91dc33b59190dee.html#a23f7fa6d76886ed3c91dc33b59190deea30b70cc2a253ed4141db9a78ba696046">MED_FALSE</a>, nvariable, maxdegree, nmaxcoefficient) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : interpolation family creation ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }
  <span class="comment">/* Basis functions creation */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01007_ga092f59b381b4374b4225e947ca64a31d.html#ga092f59b381b4374b4225e947ca64a31d" title="Cette routine permet l&amp;#39;écriture d&amp;#39;une fonction de base/forme de l&amp;#39;interpolation...">MEDinterpBaseFunctionWr</a>(fid,interpname,1,ncoefficient1_1,power1_1,coefficient1_1) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : first base function creation ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }
  
  <span class="keywordflow">if</span> (<a class="code" href="a01007_ga092f59b381b4374b4225e947ca64a31d.html#ga092f59b381b4374b4225e947ca64a31d" title="Cette routine permet l&amp;#39;écriture d&amp;#39;une fonction de base/forme de l&amp;#39;interpolation...">MEDinterpBaseFunctionWr</a>(fid,interpname,2,ncoefficient1_2,power1_2,coefficient1_2) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : second base function creation ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="keywordflow">if</span> (<a class="code" href="a01007_ga092f59b381b4374b4225e947ca64a31d.html#ga092f59b381b4374b4225e947ca64a31d" title="Cette routine permet l&amp;#39;écriture d&amp;#39;une fonction de base/forme de l&amp;#39;interpolation...">MEDinterpBaseFunctionWr</a>(fid,interpname,3,ncoefficient1_3,power1_3,coefficient1_3) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : third base function creation ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }


  <span class="comment">/* create the families of integration points </span>
<span class="comment">     for the struct element */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01010_ga77e9d9cfe12058f20762fe61fbf14172.html#ga77e9d9cfe12058f20762fe61fbf14172" title="Cette routine permet l&amp;#39;écriture d&amp;#39;une localisation localizationname de points...">MEDlocalizationWr</a>(fid, localization, geotype, spacedim, 
                        elementcoordinate, <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, 
                        nipoint, ipointcoordinate, weight, 
                        <a class="code" href="a00321_a3e7915fabbbc5946451ebbb836ca0816.html#a3e7915fabbbc5946451ebbb836ca0816">MED_NO_INTERPOLATION</a>, beamsectionname) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : create famlily of integration points ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR; 
  }

  <span class="keywordflow">if</span> (<a class="code" href="a01010_ga77e9d9cfe12058f20762fe61fbf14172.html#ga77e9d9cfe12058f20762fe61fbf14172" title="Cette routine permet l&amp;#39;écriture d&amp;#39;une localisation localizationname de points...">MEDlocalizationWr</a>(fid, localization2, geotype, spacedim, 
                        elementcoordinate, <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, 
                        nipoint, ipointcoordinate, weight, 
                        interpname, beamsectionname) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : create famlily of integration points ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR; 
  }

  <span class="comment">/*</span>
<span class="comment">   * Temperature  field creation for beam struct element :</span>
<span class="comment">   * - 1 component, 3 integration points, 4 cells in the support mesh for each </span>
<span class="comment">   *   the section of each integration point </span>
<span class="comment">   * - mesh is the 3D computation mesh of UsesCase_MEDstructElement_1 use case.</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01004_ga8f73c6eb1a1b85f5e1e8bc1823c01ab9.html#ga8f73c6eb1a1b85f5e1e8bc1823c01ab9" title="Cette routine permet de créer un champ dans un fichier.">MEDfieldCr</a>(fid, fieldname, <a class="code" href="a00320_a7d730da9417184bffcdccc90a1749e27.html#a7d730da9417184bffcdccc90a1749e27ad44e111629f7a5811626b87c8b42b3ea">MED_FLOAT64</a>,
                 ncomponent, componentname, componentunit,
                 <span class="stringliteral">&quot;ms&quot;</span>, meshname) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : create field&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="keywordflow">if</span> (<a class="code" href="a01004_gac369c1fc64c95923cadfc39e41ea8f8d.html#gac369c1fc64c95923cadfc39e41ea8f8d" title="Cette routine permet d&amp;#39;écrire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileWr</a>(fid, fieldname, <a class="code" href="a00321_a8f72b6ceb3b6f5a67f9efd46cb90707a.html#a8f72b6ceb3b6f5a67f9efd46cb90707a">MED_NO_DT</a>, <a class="code" href="a00321_a95919207fd7a18ba26e6e03f04811e3f.html#a95919207fd7a18ba26e6e03f04811e3f">MED_NO_IT</a>, <a class="code" href="a00321_a609885580ce660eb5b7c80074d64f93f.html#a609885580ce660eb5b7c80074d64f93f">MED_UNDEF_DT</a>, 
                                 <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470abdd6b14142920f599bbe4e97c4bb921e">MED_STRUCT_ELEMENT</a>, geotype, 
                                 <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, <a class="code" href="a00321_aaa89a5e5e6d32de69614b70cf74e29cc.html#aaa89a5e5e6d32de69614b70cf74e29cc">MED_NO_PROFILE</a>, localization,
                                 <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>,
                                 nbeam, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) tempvalue) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : write field values on MED_BEAM &quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="keywordflow">if</span> (<a class="code" href="a01004_gac369c1fc64c95923cadfc39e41ea8f8d.html#gac369c1fc64c95923cadfc39e41ea8f8d" title="Cette routine permet d&amp;#39;écrire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileWr</a>(fid, fieldname, <a class="code" href="a00321_a8f72b6ceb3b6f5a67f9efd46cb90707a.html#a8f72b6ceb3b6f5a67f9efd46cb90707a">MED_NO_DT</a>, 1, <a class="code" href="a00321_a609885580ce660eb5b7c80074d64f93f.html#a609885580ce660eb5b7c80074d64f93f">MED_UNDEF_DT</a>, 
                                 <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470abdd6b14142920f599bbe4e97c4bb921e">MED_STRUCT_ELEMENT</a>, geotype, 
                                 <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, <a class="code" href="a00321_aaa89a5e5e6d32de69614b70cf74e29cc.html#aaa89a5e5e6d32de69614b70cf74e29cc">MED_NO_PROFILE</a>, localization2,
                                 <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>,
                                 nbeam, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) tempvalue) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : write field values on MED_BEAM &quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="comment">/* unmount file objects */</span>


  <span class="keywordflow">if</span> ( <a class="code" href="a01005_ga73ad912a369c3da7f22caf482093e47b.html#ga73ad912a369c3da7f22caf482093e47b" title="Une fois le démontage effectué, les données précédemment montées ne sont plus...">MEDfileObjectsUnmount</a>(fid, mfid, <a class="code" href="a00321_a5e06cfaa421118c530bd15f0628dc648.html#a5e06cfaa421118c530bd15f0628dc648aacc8c82fc9fded29cf134979f0379a06">MED_MESH_SUPPORT</a>) &lt; 0 ) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file unmounting ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  <span class="keywordflow">if</span> ( <a class="code" href="a01005_ga73ad912a369c3da7f22caf482093e47b.html#ga73ad912a369c3da7f22caf482093e47b" title="Une fois le démontage effectué, les données précédemment montées ne sont plus...">MEDfileObjectsUnmount</a>(fid, sfid, <a class="code" href="a00321_a5e06cfaa421118c530bd15f0628dc648.html#a5e06cfaa421118c530bd15f0628dc648a422c5a461a7ab3dba706091e79863ea1">MED_ELSTRUCT</a>) &lt; 0 ) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file unmounting ...&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }

  ret=0;
 ERROR:

  <span class="comment">/* close file */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01005_ga12a0e901c376be997a41a073ce426283.html#ga12a0e901c376be997a41a073ce426283" title="Fermeture d&amp;#39;un fichier MED.">MEDfileClose</a>(fid) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : close file ...&quot;</span>);
    ret=-1;
  }
  
  <span class="keywordflow">return</span> ret;
}

</pre></div> <div class="fragment"><pre class="fragment"><span class="comment">/*  This file is part of MED.</span>
<span class="comment"> *</span>
<span class="comment"> *  COPYRIGHT (C) 1999 - 2012  EDF R&amp;D, CEA/DEN</span>
<span class="comment"> *  MED is free software: you can redistribute it and/or modify</span>
<span class="comment"> *  it under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> *  the Free Software Foundation, either version 3 of the License, or</span>
<span class="comment"> *  (at your option) any later version.</span>
<span class="comment"> *</span>
<span class="comment"> *  MED is distributed in the hope that it will be useful,</span>
<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment"> *  GNU Lesser General Public License for more details.</span>
<span class="comment"> *</span>
<span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> *  along with MED.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> */</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;med_utils.h&gt;</span>

<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;med_utils.h&gt;</span>

<span class="preprocessor">#include &lt;string.h&gt;</span>

<span class="comment">/* </span>
<span class="comment"> * Field use case 18 : read a field (generic approach) in a MED file with</span>
<span class="comment"> *                     values defined on integration points on struct elements</span>
<span class="comment"> */</span>


<span class="keywordtype">int</span> <a class="code" href="a00750_a3c04138a5bfe5d72780bb7e82a18e627.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) {
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> fid,mfid,sfid,cmfid;
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> nfield, i, j;
  <span class="keywordtype">char</span> meshname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00321_a23f7fa6d76886ed3c91dc33b59190dee.html#a23f7fa6d76886ed3c91dc33b59190dee">med_bool</a> localmesh;
  <span class="keywordtype">char</span> fieldname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00321_a5615eeaf85e0b3f40b74bdd24178f2cd.html#a5615eeaf85e0b3f40b74bdd24178f2cd">med_field_type</a> fieldtype;
  <span class="keywordtype">char</span> *componentname = NULL;
  <span class="keywordtype">char</span> *componentunit = NULL;
  <span class="keywordtype">char</span> dtunit[<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> *values = NULL;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nstep, nvalues;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> ncomponent;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> csit, numit, numdt, it;
  <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> dt;
  <a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> *geotypes=NULL, geotype;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nmodels;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nprofile, pit, profilesize;
  <span class="keywordtype">char</span> profilename[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nintegrationpoint;
  <span class="keywordtype">char</span> localizationname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">int</span> k;
  <span class="keywordtype">char</span> elementname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <span class="keywordtype">char</span> supportmeshname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
  <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470">med_entity_type</a> entitype;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> elementdim;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nnode,ncell;
  <a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> geocelltype;
  <a class="code" href="a00321_a23f7fa6d76886ed3c91dc33b59190dee.html#a23f7fa6d76886ed3c91dc33b59190dee">med_bool</a> anyprofile=0;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nconstatt, *nvaratt=NULL;
  <a class="code" href="a00321_a23f7fa6d76886ed3c91dc33b59190dee.html#a23f7fa6d76886ed3c91dc33b59190dee">med_bool</a> coordinatechangement;
  <a class="code" href="a00321_a23f7fa6d76886ed3c91dc33b59190dee.html#a23f7fa6d76886ed3c91dc33b59190dee">med_bool</a> geotransformation;
  <span class="keywordtype">int</span> ret=-1;


  <span class="comment">/* open file */</span>
  fid = <a class="code" href="a01005_ga9376a1654b7bf099c3f8941074c5fdfb.html#ga9376a1654b7bf099c3f8941074c5fdfb" title="Ouverture d&amp;#39;un fichier MED.">MEDfileOpen</a>(<span class="stringliteral">&quot;UsesCase_MEDfield_17.med&quot;</span>,<a class="code" href="a00321_adcd0322de9fec3b5e199ffeda3f44c85.html#adcd0322de9fec3b5e199ffeda3f44c85ab53f10a6b700d1087d7a50710fe29f00">MED_ACC_RDWR</a>);
  <span class="keywordflow">if</span> (fid &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : open file ...&quot;</span>);
    <span class="keywordflow">return</span> -1;
  }

  <span class="keywordflow">if</span> (( mfid=<a class="code" href="a01005_ga48b7eb3761d58928eb0e0b12d481e05a.html#ga48b7eb3761d58928eb0e0b12d481e05a" title="Cette routine permet de monter dans le fichier courant un type de données (exemples...">MEDfileObjectsMount</a>(fid,  <span class="stringliteral">&quot;UsesCase_MEDstructElement_1.med&quot;</span>,<a class="code" href="a00321_a5e06cfaa421118c530bd15f0628dc648.html#a5e06cfaa421118c530bd15f0628dc648aacc8c82fc9fded29cf134979f0379a06">MED_MESH_SUPPORT</a>)) &lt; 0 ) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file mounting ...&quot;</span>);
    <span class="keywordflow">return</span> -1;
  }

  <span class="keywordflow">if</span> (( sfid=<a class="code" href="a01005_ga48b7eb3761d58928eb0e0b12d481e05a.html#ga48b7eb3761d58928eb0e0b12d481e05a" title="Cette routine permet de monter dans le fichier courant un type de données (exemples...">MEDfileObjectsMount</a>(fid,  <span class="stringliteral">&quot;UsesCase_MEDstructElement_1.med&quot;</span>,<a class="code" href="a00321_a5e06cfaa421118c530bd15f0628dc648.html#a5e06cfaa421118c530bd15f0628dc648a422c5a461a7ab3dba706091e79863ea1">MED_ELSTRUCT</a>)) &lt; 0 ) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file mounting ...&quot;</span>);
    <span class="keywordflow">return</span> -1;
  }

  <span class="keywordflow">if</span> (( cmfid=<a class="code" href="a01005_ga48b7eb3761d58928eb0e0b12d481e05a.html#ga48b7eb3761d58928eb0e0b12d481e05a" title="Cette routine permet de monter dans le fichier courant un type de données (exemples...">MEDfileObjectsMount</a>(fid,  <span class="stringliteral">&quot;UsesCase_MEDstructElement_1.med&quot;</span>,<a class="code" href="a00321_a5e06cfaa421118c530bd15f0628dc648.html#a5e06cfaa421118c530bd15f0628dc648a741065b9e55fc3dc2ca055b74461adc9">MED_MESH</a>)) &lt; 0 ) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file mounting ...&quot;</span>);
    <span class="keywordflow">return</span> -1;
  }


  <span class="comment">/*</span>
<span class="comment">   * generic approach : how many fields in the file and identification</span>
<span class="comment">   * of each field.</span>
<span class="comment">   */</span>
  <span class="keywordflow">if</span> ((nfield = <a class="code" href="a01004_ga0d8be6c1b6b24ff150a5adcb58831d93.html#ga0d8be6c1b6b24ff150a5adcb58831d93" title="Cette routine permet de lire le nombre de champs dans un fichier.">MEDnField</a>(fid)) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : How many fields in the file ...&quot;</span>);
    <span class="keywordflow">return</span> -1;
  }

  <span class="comment">/*</span>
<span class="comment">   * read values for each field</span>
<span class="comment">   */</span>
  <span class="keywordflow">for</span> (i=0; i&lt;nfield; i++) {

    <span class="keywordflow">if</span> ((ncomponent = <a class="code" href="a01004_gabe6258ebc74592af81c9b51379b7b7af.html#gabe6258ebc74592af81c9b51379b7b7af" title="Cette routine lit le nombre de composantes d&amp;#39;un champ.">MEDfieldnComponent</a>(fid,i+1)) &lt; 0) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : number of field component ...&quot;</span>);
      <span class="keywordflow">return</span> -1;
    }
    
    <span class="keywordflow">if</span> ((componentname = (<span class="keywordtype">char</span> *) malloc(ncomponent*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1)) == NULL) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : memory allocation ...&quot;</span>);
      <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">if</span> ((componentunit = (<span class="keywordtype">char</span> *) malloc(ncomponent*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1)) == NULL) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : memory allocation ...&quot;</span>);
      <span class="keywordflow">return</span> -1;
    }

    <span class="keywordflow">if</span> (<a class="code" href="a01004_gaf2169b6d6505a28d7ee5f8599d2fb25e.html#gaf2169b6d6505a28d7ee5f8599d2fb25e" title="Cette routine permet de lire les informations d&amp;#39;indentification d&amp;#39;un champ...">MEDfieldInfo</a>(fid, i+1, fieldname, meshname, &amp;localmesh, &amp;fieldtype,
                     componentname, componentunit, dtunit, &amp;nstep) &lt; 0) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : Field info ...&quot;</span>);
      free(componentname);
      free(componentunit);
      <span class="keywordflow">return</span> -1;
    }

    free(componentname);
    free(componentunit);

    <span class="comment">/* read how many struct element models in the mesh ? */</span>
    <span class="keywordflow">if</span> ((nmodels = <a class="code" href="a01011_ga45758103360dacf7b8a6c53ebfa4d7e5.html#ga45758103360dacf7b8a6c53ebfa4d7e5" title="Cette routine permet de lire le nombre d&amp;#39;entités dans un maillage pour une séquence...">MEDmeshnEntity</a>(fid, meshname, <a class="code" href="a00321_a8f72b6ceb3b6f5a67f9efd46cb90707a.html#a8f72b6ceb3b6f5a67f9efd46cb90707a">MED_NO_DT</a>, <a class="code" href="a00321_a95919207fd7a18ba26e6e03f04811e3f.html#a95919207fd7a18ba26e6e03f04811e3f">MED_NO_IT</a>, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470abdd6b14142920f599bbe4e97c4bb921e">MED_STRUCT_ELEMENT</a>, <a class="code" href="a00321_ad9a7aaf0f9d302fa8e22f98cb8fe0371.html#ad9a7aaf0f9d302fa8e22f98cb8fe0371">MED_GEO_ALL</a>,
                                  <a class="code" href="a00321_a25ee4b3675737fc23511b28b3245c61b.html#a25ee4b3675737fc23511b28b3245c61bab36865870154d1aa71cda04491911275">MED_UNDEF_DATATYPE</a>, <a class="code" href="a00321_afcd26ca66a179b9aa82f5c90602c4ed8.html#afcd26ca66a179b9aa82f5c90602c4ed8a2b1e772016688b78b808e96a44d1ee02">MED_NO_CMODE</a>,&amp;coordinatechangement,
                                  &amp;geotransformation)) &lt; 0) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : number of nodes ...&quot;</span>);
      <span class="keywordflow">return</span> -1;
    }
    geotypes = (<a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a> *) malloc(<span class="keyword">sizeof</span>(<a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a>)*nmodels);
    nvaratt = (<a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> *) malloc(<span class="keyword">sizeof</span>(<a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>)*nmodels);
    
    <span class="keywordflow">for</span> (it=0; it&lt;nmodels; it++) {
      <span class="keywordflow">if</span> (<a class="code" href="a01014_ga6caf4937712d2a1d39ab1fd1482f61a3.html#ga6caf4937712d2a1d39ab1fd1482f61a3" title="Cette routine décrit les caractéristiques d&amp;#39;un modèle d&amp;#39;élément de structure...">MEDstructElementInfo</a>(mfid, it+1, elementname, geotypes+it, &amp;elementdim,
                               supportmeshname, &amp;entitype, &amp;nnode, &amp;ncell,
                               &amp;geocelltype, &amp;nconstatt, &amp;anyprofile, nvaratt+it) &lt; 0) {
        <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : struct element models information ...&quot;</span>);
        <span class="keywordflow">return</span> -1;
      }
    }


    <span class="comment">/*</span>
<span class="comment">     * Read field values for each computing step </span>
<span class="comment">     */</span> 
    <span class="keywordflow">for</span> (csit=0; csit&lt;nstep; csit++) {

      <span class="keywordflow">if</span> (<a class="code" href="a01004_ga5b0031d3002518f1b2e134ff8c03dbc5.html#ga5b0031d3002518f1b2e134ff8c03dbc5" title="Cette routine permet de lire les informations caractérisant une séquence de calcul...">MEDfieldComputingStepInfo</a>(fid, fieldname, csit+1, &amp;numdt, &amp;numit, &amp;dt) &lt; 0) {
        <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : Computing step info ...&quot;</span>);
        <span class="keywordflow">return</span> -1;
      }

      <span class="comment">/* </span>
<span class="comment">       * ... In our case, we suppose that the field values are only defined on struct element ... </span>
<span class="comment">       */</span>
      <span class="keywordflow">for</span> (it=0; it&lt;nmodels; it++) {
        geotype = *(geotypes+it);
        
        <span class="comment">/*</span>
<span class="comment">         * How many profile for each geometry type ? </span>
<span class="comment">         */</span>
        <span class="keywordflow">if</span> ((nprofile = <a class="code" href="a01004_gab8ce8c33cfe01cbccbde8474a4c433ba.html#gab8ce8c33cfe01cbccbde8474a4c433ba" title="Cette routine permet de lire le nombre de profils référencés dans un champ pour...">MEDfieldnProfile</a>(fid, fieldname, numdt, numit, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470abdd6b14142920f599bbe4e97c4bb921e">MED_STRUCT_ELEMENT</a>, geotype,
                                         profilename, localizationname)) &lt; 0) {
          <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read number of profile &quot;</span>);
          <span class="keywordflow">return</span> -1;
        }

        <span class="comment">/* </span>
<span class="comment">         * Read values for each profile</span>
<span class="comment">         */</span>
        <span class="keywordflow">for</span> (pit=0; pit&lt;nprofile; pit++) {
          
          <span class="keywordflow">if</span> ((nvalues = <a class="code" href="a01004_gaa45f3d32332f8410c35c51a77ee20740.html#gaa45f3d32332f8410c35c51a77ee20740" title="Cette routine permet de lire le nombre de valeurs à lire dans un champ pour une...">MEDfieldnValueWithProfile</a>(fid, fieldname, numdt, numit, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470abdd6b14142920f599bbe4e97c4bb921e">MED_STRUCT_ELEMENT</a>, geotype,
                                                   pit+1, <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, profilename, &amp;profilesize,
                                                   localizationname, &amp;nintegrationpoint)) &lt; 0) {
            <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read number of values with a profile ...&quot;</span>);
            <span class="keywordflow">return</span> -1;
          } 
          
          <span class="keywordflow">if</span> (nvalues) {
            <span class="keywordflow">if</span> ((values = (<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> *) malloc(<span class="keyword">sizeof</span>(<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>)*nvalues*ncomponent*nintegrationpoint)) == NULL) {
              <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : memory allocation ...&quot;</span>);
              <span class="keywordflow">return</span> -1;
            }
            <span class="keywordflow">if</span> (<a class="code" href="a01004_ga85cf40e4f76b7f6e6036445a6c6108b4.html#ga85cf40e4f76b7f6e6036445a6c6108b4" title="Cette routine permet de lire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueWithProfileRd</a>(fid, fieldname, numdt, numit, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470abdd6b14142920f599bbe4e97c4bb921e">MED_STRUCT_ELEMENT</a>, geotype,
                                           <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>, profilename,
                                           <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>, <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>, 
                                           (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) values) &lt; 0) {
              <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : read fields values for cells ...&quot;</span>); 
              free(values);
              <span class="keywordflow">return</span> -1; 
            }  
            free(values);
          }
        }
      }
    }

    ret=0;
  ERROR:
    <span class="keywordflow">if</span> (nvaratt)
      free(nvaratt);
    <span class="keywordflow">if</span> (geotypes)
      free(geotypes);

  }



  <span class="keywordflow">if</span> ( <a class="code" href="a01005_ga73ad912a369c3da7f22caf482093e47b.html#ga73ad912a369c3da7f22caf482093e47b" title="Une fois le démontage effectué, les données précédemment montées ne sont plus...">MEDfileObjectsUnmount</a>(fid, mfid, <a class="code" href="a00321_a5e06cfaa421118c530bd15f0628dc648.html#a5e06cfaa421118c530bd15f0628dc648aacc8c82fc9fded29cf134979f0379a06">MED_MESH_SUPPORT</a>) &lt; 0 ) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file unmounting ...&quot;</span>);
    ret=-1;
  }

  <span class="keywordflow">if</span> ( <a class="code" href="a01005_ga73ad912a369c3da7f22caf482093e47b.html#ga73ad912a369c3da7f22caf482093e47b" title="Une fois le démontage effectué, les données précédemment montées ne sont plus...">MEDfileObjectsUnmount</a>(fid, sfid, <a class="code" href="a00321_a5e06cfaa421118c530bd15f0628dc648.html#a5e06cfaa421118c530bd15f0628dc648a422c5a461a7ab3dba706091e79863ea1">MED_ELSTRUCT</a>) &lt; 0 ) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file unmounting ...&quot;</span>);
    ret=-1;
  }


  <span class="keywordflow">if</span> ( <a class="code" href="a01005_ga73ad912a369c3da7f22caf482093e47b.html#ga73ad912a369c3da7f22caf482093e47b" title="Une fois le démontage effectué, les données précédemment montées ne sont plus...">MEDfileObjectsUnmount</a>(fid, cmfid, <a class="code" href="a00321_a5e06cfaa421118c530bd15f0628dc648.html#a5e06cfaa421118c530bd15f0628dc648a741065b9e55fc3dc2ca055b74461adc9">MED_MESH</a>) &lt; 0 ) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : file unmounting ...&quot;</span>);
    ret=-1;
  }

  <span class="comment">/* close file */</span>
  <span class="keywordflow">if</span> (<a class="code" href="a01005_ga12a0e901c376be997a41a073ce426283.html#ga12a0e901c376be997a41a073ce426283" title="Fermeture d&amp;#39;un fichier MED.">MEDfileClose</a>(fid) &lt; 0) {
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;ERROR : close file ...&quot;</span>);             
    ret=-1; 
  } 
  
  <span class="keywordflow">return</span> ret;
}
</pre></div> <h3><a class="anchor" id="6."></a>Ecrire et lire un maillage ou un champ en filtrant les donn&eacute;es</h3>
<p>Dans MED, un filtre de donn&eacute;es peut &ecirc;tre utilis&eacute; pour contr&ocirc;ler un sous-ensemble d'entit&eacute;s concern&eacute;es par un appel &agrave; l'API.  </p>
<p>En mode s&eacute;quentiel, la routine <a class="el" href="a01006_ga8bd4fe1ea6e331d606b2b708a34d8b3b.html#ga8bd4fe1ea6e331d606b2b708a34d8b3b">MEDfilterEntityCr</a> / <a class="el" href="a01021_gaa66afba0490f4d46eb35bdca621a7a8c.html#gaa66afba0490f4d46eb35bdca621a7a8c">mfrcre</a> permet de cr&eacute;er un filtre &eacute;l&eacute;mentaire en s&eacute;lectionnant les entit&eacute;s pour lesquelles on veut lire/&eacute;crire des valeurs. Cette s&eacute;lection permet une lecture/&eacute;criture avanc&eacute;e vers/depuis les emplacements m&eacute;moire s&eacute;lectionn&eacute;s. Elle s'utilise uniquement en mode s&eacute;quentiel (un seul processus). </p>
<p>Une fois cr&eacute;&eacute; un filtre peut &ecirc;tre pass&eacute; en arguments aux routines avanc&eacute;es de l'API. Ces routines ne manipuleront que les donn&eacute;es filtr&eacute;es. Ces routines avanc&eacute;es sont celles qui permettent d'&eacute;crire et lire les coordonn&eacute;es des noeuds, la connectivit&eacute; des &eacute;l&eacute;ments d'un maillage non structur&eacute;, les valeurs des champs de r&eacute;sultats : <a class="el" href="a01004_ga9e55366753425d010b8d1e95b1a53025.html#ga9e55366753425d010b8d1e95b1a53025">MEDfieldValueAdvancedWr</a> / <a class="el" href="a01019_ga6af39493ffe1cdd1a2fe98c99bd685e5.html#ga6af39493ffe1cdd1a2fe98c99bd685e5">mfdraw</a>, <a class="el" href="a01019_gacb21099bf05bbd8e18fc3f74d0342628.html#gacb21099bf05bbd8e18fc3f74d0342628">mfdiaw</a>, <a class="el" href="a01004_ga404dad06b207dace4270b18140f173e0.html#ga404dad06b207dace4270b18140f173e0">MEDfieldValueAdvancedRd</a> / <a class="el" href="a01019_gab4468903e0aad8b5dce0e88b0c350de1.html#gab4468903e0aad8b5dce0e88b0c350de1">mfdrar</a>, <a class="el" href="a01019_gaa8ed6b6531344aa1e68469ba7591070f.html#gaa8ed6b6531344aa1e68469ba7591070f">mfdiar</a>, <a class="el" href="a01011_gac5b9136db8c5f8a3c347eae677ad31d6.html#gac5b9136db8c5f8a3c347eae677ad31d6">MEDmeshElementConnectivityAdvancedWr</a> / <a class="el" href="a01026_gad04a514acf2f731eb17303fcc6f72a67.html#gad04a514acf2f731eb17303fcc6f72a67">mmhyaw</a>, <a class="el" href="a01011_gae9c0d58eebecdf274724ffd0d9d1bb5d.html#gae9c0d58eebecdf274724ffd0d9d1bb5d">MEDmeshElementConnectivityAdvancedRd</a> / <a class="el" href="a01026_gaebb66b7b0a1f85931387438c94d45a64.html#gaebb66b7b0a1f85931387438c94d45a64">mmhyar</a>, <a class="el" href="a01011_gaef211b5f4d84a8a4aae211f94034d85f.html#gaef211b5f4d84a8a4aae211f94034d85f">MEDmeshNodeCoordinateAdvancedWr</a> / <a class="el" href="a01026_gae186bc0012adc043d3244adca5b87f7a.html#gae186bc0012adc043d3244adca5b87f7a">mmhcaw</a>, <a class="el" href="a01011_gaf417124265009d6860705965fa651dfc.html#gaf417124265009d6860705965fa651dfc">MEDmeshNodeCoordinateAdvancedRd</a> / <a class="el" href="a01026_gaa6f7c63cba6b1ae9eccc7600bc3c0f41.html#gaa6f7c63cba6b1ae9eccc7600bc3c0f41">mmhcar</a>. </p>
<p>Il est possible d'allouer un tableau de filtre avec la routine <a class="el" href="a01006_ga47410be6d049065e980828936de3324a.html#ga47410be6d049065e980828936de3324a">MEDfilterAllocate</a> / <a class="el" href="a01021_gabc69b90f5af8c5aca1dbd4b685b5a953.html#gabc69b90f5af8c5aca1dbd4b685b5a953">mfrall</a>, puis de le d&eacute;-allouer avec la routine <a class="el" href="a01006_ga6c987c612fe52678b0c90f6d713634e7.html#ga6c987c612fe52678b0c90f6d713634e7">MEDfilterDeAllocate</a> / <a class="el" href="a01021_gad95791e5fe16d7d6c7b99ef5f39923e2.html#gad95791e5fe16d7d6c7b99ef5f39923e2">mfrdea</a>.  </p>
<h3><a class="anchor" id="7."></a>Ecriture et lecture en parall&egrave;le dans un seul fichier</h3>
<p>En mode parall&egrave;le, le filtre est un moyen de d&eacute;finir le domaine concern&eacute; par chacun des processeurs. Les &eacute;critures et lectures peuvent donc se faire en parall&egrave;le entre plusieurs processeurs dans un seul et m&ecirc;me fichier MED.  </p>
<p>La routine <a class="el" href="a01006_ga9ceeb4d2bf17d106d7dc41b921962ec6.html#ga9ceeb4d2bf17d106d7dc41b921962ec6">MEDfilterBlockOfEntityCr</a> / <a class="el" href="a01021_ga160e0f69194873d2265bc7eed58cf74c.html#ga160e0f69194873d2265bc7eed58cf74c">mfrblc</a> permet de cr&eacute;er un filtre en s&eacute;lectionnant les entit&eacute;s par blocs continus de taille constante pour lesquelles on veut lire/&eacute;crire des valeurs. Cette s&eacute;lection permet une lecture/&eacute;criture avanc&eacute;e vers/depuis les emplacements m&eacute;moire s&eacute;lectionn&eacute;s. Elle s'utilise aussi bien en mode s&eacute;quentiel qu'en mode parall&egrave;le (un ou plusieurs processus). </p>
<p>Dans ce cadre d'utilisation, le fichier doit &ecirc;tre ouvert avec la routine <a class="el" href="a01005_gad5a6655e312d3e5146f358c42c7c904f.html#gad5a6655e312d3e5146f358c42c7c904f">MEDparFileOpen</a> / mfipfo. </p>
<p>L'exemple suivant montre un cas d'utilisation en parall&egrave;le en &eacute;criture et lecture de champs de r&eacute;sultats. </p>
<div class="fragment"><pre class="fragment"><span class="comment">/*  This file is part of MED.</span>
<span class="comment"> *</span>
<span class="comment"> *  COPYRIGHT (C) 1999 - 2012  EDF R&amp;D, CEA/DEN</span>
<span class="comment"> *  MED is free software: you can redistribute it and/or modify</span>
<span class="comment"> *  it under the terms of the GNU Lesser General Public License as published by</span>
<span class="comment"> *  the Free Software Foundation, either version 3 of the License, or</span>
<span class="comment"> *  (at your option) any later version.</span>
<span class="comment"> *</span>
<span class="comment"> *  MED is distributed in the hope that it will be useful,</span>
<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment"> *  GNU Lesser General Public License for more details.</span>
<span class="comment"> *</span>
<span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span>
<span class="comment"> *  along with MED.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="comment"> */</span>

<span class="preprocessor">#define MAX(a,b) ((a) &gt; (b) ? (a) : (b))</span>
<span class="preprocessor"></span>
<span class="preprocessor">#include &lt;med.h&gt;</span>
<span class="preprocessor">#define MESGERR 1</span>
<span class="preprocessor"></span><span class="preprocessor">#include &quot;med_utils.h&quot;</span>
<span class="preprocessor">#include &quot;med_config.h&quot;</span>

<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>
<span class="preprocessor">#include &lt;assert.h&gt;</span>

<span class="preprocessor">#if TIME_WITH_SYS_TIME</span>
<span class="preprocessor"></span><span class="preprocessor"># include &lt;sys/time.h&gt;</span>
<span class="preprocessor"># include &lt;time.h&gt;</span>
<span class="preprocessor">#else</span>
<span class="preprocessor"></span><span class="preprocessor"># if HAVE_SYS_TIME_H</span>
<span class="preprocessor"></span><span class="preprocessor">#  include &lt;sys/time.h&gt;</span>
<span class="preprocessor"># else</span>
<span class="preprocessor"></span><span class="preprocessor">#  include &lt;time.h&gt;</span>
<span class="preprocessor"># endif</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#ifndef HAVE_UNISTD_H</span>
<span class="preprocessor"></span><span class="preprocessor">#error &quot;unistd.h reuired.&quot;</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="preprocessor">#include &quot;<a class="code" href="a00285.html">getBlocksOfEntitiesPartition.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="a00281.html">generateDatas.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="a00283.html">generateFilterArray.h</a>&quot;</span>


<span class="preprocessor">#ifdef DEF_LECT_ECR</span>
<span class="preprocessor"></span><span class="preprocessor">#define MODE_ACCES MED_ACC_RDWR</span>
<span class="preprocessor"></span><span class="preprocessor">#elif DEF_LECT_AJOUT</span>
<span class="preprocessor"></span><span class="preprocessor">#define MODE_ACCES MED_ACC_RDEXT</span>
<span class="preprocessor"></span><span class="preprocessor">#else</span>
<span class="preprocessor"></span><span class="preprocessor">#define MODE_ACCES MED_ACC_CREAT</span>
<span class="preprocessor"></span><span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
<span class="comment">/*Valeur de l&apos;enum dans med.h.in*/</span>
<span class="comment">/* #define MED_NO_INTERLACE 2 */</span>
<span class="comment">/* #define MED_FULL_INTERLACE 1 */</span>


<span class="comment">/* #ifndef USER_INTERLACE */</span>
<span class="comment">/* #define USER_INTERLACE MED_FULL_INTERLACE */</span>
<span class="comment">/* #warning &quot;Defining MED_FULL_INTERLACE mode...&quot; */</span>
<span class="comment">/* #endif */</span>

<span class="comment">/* #if USER_INTERLACE == MED_NO_INTERLACE */</span>
<span class="comment">/* #define generateDatas generateNoIDatas */</span>
<span class="comment">/* #warning &quot;Using generateNoIDatas...&quot; */</span>
<span class="comment">/* #elif USER_INTERLACE == MED_FULL_INTERLACE */</span>
<span class="comment">/* #define generateDatas generateFullIDatas */</span>
<span class="comment">/* #warning &quot;Using generateFullIDatas...&quot; */</span>
<span class="comment">/* #else */</span>
<span class="comment">/* #error &quot;The USER_INTERLACE macro value match neither MED_NO_INTERLACE nor MED_FULL_INTERLACE&quot; */</span>
<span class="comment">/* #endif */</span>

<span class="comment">/* #define USER_MODE MED_COMPACT */</span>


<span class="keywordtype">int</span> <a class="code" href="a00750_a3c04138a5bfe5d72780bb7e82a18e627.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)


{
  <a class="code" href="a00320_abd29d7c6abaef5da2a5ed1b73464f0ba.html#abd29d7c6abaef5da2a5ed1b73464f0ba">med_err</a> _ret=0;
  <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a> _fid;

  <span class="keywordtype">int</span> mpi_size, mpi_rank;
  MPI_Comm comm = MPI_COMM_WORLD;
  MPI_Info info = MPI_INFO_NULL;

  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>    _nentitiesfiltered=0;
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>    *_filterarray=NULL;


  MPI_Init(&amp;argc, &amp;argv);
  MPI_Comm_size(MPI_COMM_WORLD, &amp;mpi_size);
  MPI_Comm_rank(MPI_COMM_WORLD, &amp;mpi_rank);


  <a class="code" href="a00320_abd29d7c6abaef5da2a5ed1b73464f0ba.html#abd29d7c6abaef5da2a5ed1b73464f0ba">med_err</a> generateFieldFile( <span class="keyword">const</span> <a class="code" href="a00320_abc4b2f6b68a545b7b3441b0d3d860629.html#abc4b2f6b68a545b7b3441b0d3d860629">med_size</a> nentities, <span class="keyword">const</span> <a class="code" href="a00320_abc4b2f6b68a545b7b3441b0d3d860629.html#abc4b2f6b68a545b7b3441b0d3d860629">med_size</a> nvaluesperentity, <span class="keyword">const</span> <a class="code" href="a00320_abc4b2f6b68a545b7b3441b0d3d860629.html#abc4b2f6b68a545b7b3441b0d3d860629">med_size</a> nconstituentpervalue,
                             <span class="keyword">const</span> <a class="code" href="a00321_a0d451e4036adbb12b14cb16d7db0c37d.html#a0d451e4036adbb12b14cb16d7db0c37d">med_switch_mode</a> constituentmode,<a class="code" href="a00285_a78f40b6b8ddccfcfd0bddbd13d3d1a13.html#a78f40b6b8ddccfcfd0bddbd13d3d1a13">GetBlocksOfEntitiesType</a> getBlockOfEntities, <span class="keyword">const</span> <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a> nbblocksperproc,
                             <a class="code" href="a00281_a61d073884976a932c07d21708877799c.html#a61d073884976a932c07d21708877799c">GenerateDataType</a> generateDatas,
                             <span class="keyword">const</span> <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8d">med_storage_mode</a> storagemode, <span class="keyword">const</span> <a class="code" href="a00320_abc4b2f6b68a545b7b3441b0d3d860629.html#abc4b2f6b68a545b7b3441b0d3d860629">med_size</a> profilearraysize,  <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> fieldnameprefix ) {

<span class="comment">/*     static int   _fileno=0; */</span>
    <a class="code" href="a00320_abd29d7c6abaef5da2a5ed1b73464f0ba.html#abd29d7c6abaef5da2a5ed1b73464f0ba">med_err</a>      _ret=-1;
    <span class="keywordtype">char</span>         _filename   [255]=<span class="stringliteral">&quot;&quot;</span>;
    <span class="keywordtype">char</span>         _meshname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;Empty mesh&quot;</span>;
    <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>      _meshdim=3;
    <span class="keywordtype">char</span>         _meshcomponentname[3*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1] = <span class="stringliteral">&quot;x               y               z               &quot;</span>;
    <span class="keywordtype">char</span>         _meshcomponentunit[3*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1] = <span class="stringliteral">&quot;cm              cm              cm              &quot;</span>;
    <span class="keywordtype">char</span>         _fieldname  [<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<span class="stringliteral">&quot;&quot;</span>;
    <span class="keywordtype">char</span>         *componentname,*componentunit;
    <span class="keywordtype">char</span>         _profilename[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1]=<a class="code" href="a00321_aaa89a5e5e6d32de69614b70cf74e29cc.html#aaa89a5e5e6d32de69614b70cf74e29cc">MED_NO_PROFILE</a>;
    <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>       *_profilearray=0;
    <span class="keywordtype">int</span>          _i=0,_j=0,_k=0, _lastusedrank=0;
    <a class="code" href="a00320_abc4b2f6b68a545b7b3441b0d3d860629.html#abc4b2f6b68a545b7b3441b0d3d860629">med_size</a>     _blocksize=0,_lastblocksize=0,_count=0,_stride=0,_start=0,_index=0;
    <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>    *_arrayvalues;
    <a class="code" href="a00245.html" title="Filtre de sélection.">med_filter</a>   filter = <a class="code" href="a00321_a12fb4e45273e33fdbad01821ca0d3ea8.html#a12fb4e45273e33fdbad01821ca0d3ea8">MED_FILTER_INIT</a>;
    <a class="code" href="a00320_abc4b2f6b68a545b7b3441b0d3d860629.html#abc4b2f6b68a545b7b3441b0d3d860629">med_size</a>     _nusedentities        = nentities;
    <a class="code" href="a00320_abc4b2f6b68a545b7b3441b0d3d860629.html#abc4b2f6b68a545b7b3441b0d3d860629">med_size</a>     _io_count                = nbblocksperproc;
    <a class="code" href="a00320_afa4ec8284026c8c5545e5333475fb65a.html#afa4ec8284026c8c5545e5333475fb65a">med_idt</a>      _fidseq;

    <span class="comment">/*TODO : EXTERNALISER CES DEFINITIONS ET GENERALISER LE PRINCIPE */</span>
    <span class="keywordtype">char</span>         *_MED_MODE_SWITCH_MSG[3]={<span class="stringliteral">&quot;MED_FULL_INTERLACE&quot;</span>, <span class="stringliteral">&quot;MED_NO_INTERLACE&quot;</span>,<span class="stringliteral">&quot;MED_UNDEF_INTERLACE&quot;</span>,};
    <span class="keywordtype">char</span>         *_MED_STORAGE_MODE_MSG[3]={<span class="stringliteral">&quot;MED_NO_PFLMODE&quot;</span>,<span class="stringliteral">&quot;MED_GLOBAL_PFLMODE&quot;</span>, <span class="stringliteral">&quot;MED_COMPACT_PFLMODE&quot;</span>};

    <a class="code" href="a00321_a1043613afc3cd2e24785dfc7c0452ab8.html#a1043613afc3cd2e24785dfc7c0452ab8">med_geometry_type</a>     _geotype       = <a class="code" href="a00321_a85970ad0ffaf58419c2afa36e43b1ea3.html#a85970ad0ffaf58419c2afa36e43b1ea3">MED_TRIA6</a>;
    <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>               _geodim        = _geotype/100;
    <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>               _geonnodes  = _geotype%100;
    <span class="keywordtype">char</span>       _ipointname[<a class="code" href="a00321_a0ae989cbbfeecbb5296b3ceba8dab886.html#a0ae989cbbfeecbb5296b3ceba8dab886">MED_NAME_SIZE</a>+1];
    <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>* _ipointrefcoo = 0;
    <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>    _ipoint       = nvaluesperentity;
    <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>* _ipointcoo    = 0;
    <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>* _ipointwg     = 0;

    sprintf(_filename,<span class="stringliteral">&quot;%s_CPU-%03d_@_%s_%s.med&quot;</span>,fieldnameprefix,mpi_size,_MED_MODE_SWITCH_MSG[constituentmode],_MED_STORAGE_MODE_MSG[storagemode]);
<span class="comment">/*     SSCRUTE(_filename); */</span>
    <span class="comment">/* Ouverture du fichier en mode parallel */</span>
    <span class="keywordflow">if</span> ((_fid = <a class="code" href="a01005_gad5a6655e312d3e5146f358c42c7c904f.html#gad5a6655e312d3e5146f358c42c7c904f" title="Ouverture d&amp;#39;un fichier MED pour une utilisation parallèle.">MEDparFileOpen</a>(_filename, <a class="code" href="a00750_a29a43500a889d39744e184ece0d749be.html#a29a43500a889d39744e184ece0d749be">MODE_ACCES</a> ,comm, info)) &lt; 0){
      <a class="code" href="a00349_a07852156956867e0134fc219d370b8d4.html#a07852156956867e0134fc219d370b8d4">MED_ERR_</a>(_ret,<a class="code" href="a00335_a0bbda4699e6c5e9a9c3189b702e6f6e6.html#a0bbda4699e6c5e9a9c3189b702e6f6e6">MED_ERR_OPEN</a>,<a class="code" href="a00335_a768428f78b9f7416a35939e54404fca7.html#a768428f78b9f7416a35939e54404fca7">MED_ERR_FILE</a>,_filename);
      <span class="keywordflow">goto</span> ERROR;
    }

<span class="comment">/*     SSCRUTE(_meshname); */</span>
    <span class="keywordflow">if</span> (<a class="code" href="a01011_ga6007c3f1a62732e7a46c5eca232be78a.html#ga6007c3f1a62732e7a46c5eca232be78a" title="Cette routine permet de créer un maillage dans un fichier.">MEDmeshCr</a>( _fid,_meshname,_meshdim,_meshdim, <a class="code" href="a00321_a821a4dd94c5c6b095318432bdec8d8a1.html#a821a4dd94c5c6b095318432bdec8d8a1a3719e53a4838d222f0a58148292fda41">MED_UNSTRUCTURED_MESH</a>,
                   <span class="stringliteral">&quot;Un maillage pour le test parallel&quot;</span>,<span class="stringliteral">&quot;s&quot;</span>, <a class="code" href="a00321_a5b97067a30629cd60470d074691d6798.html#a5b97067a30629cd60470d074691d6798ae896b6adfbde9870b4e875e5167eddd0">MED_SORT_DTIT</a>,
                   <a class="code" href="a00321_a57867e4bed1d104c865cfc9d23c9204d.html#a57867e4bed1d104c865cfc9d23c9204da682ef7f1042079519664eae87f90297e">MED_CARTESIAN</a>, _meshcomponentname, _meshcomponentunit) &lt; 0) {
      <a class="code" href="a00349_a07852156956867e0134fc219d370b8d4.html#a07852156956867e0134fc219d370b8d4">MED_ERR_</a>(_ret,<a class="code" href="a00335_a92354d1153d9e053407f2f8c0dedbda7.html#a92354d1153d9e053407f2f8c0dedbda7">MED_ERR_CREATE</a>,<a class="code" href="a00335_a8767f86ed60bd189b0e714b775846f24.html#a8767f86ed60bd189b0e714b775846f24">MED_ERR_MESH</a>,_meshname);
      <span class="keywordflow">goto</span> ERROR;
    };

    componentname = (<span class="keywordtype">char</span>*) malloc((nconstituentpervalue*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1)*<span class="keyword">sizeof</span>(char));
    componentunit = (<span class="keywordtype">char</span>*) malloc((nconstituentpervalue*<a class="code" href="a00321_a213ecd1a546eb96092b980a870bc386b.html#a213ecd1a546eb96092b980a870bc386b">MED_SNAME_SIZE</a>+1)*<span class="keyword">sizeof</span>(char));
    <span class="comment">/*TODO : Compléter le nom */</span>
    strcpy(componentname,<span class="stringliteral">&quot;&quot;</span>);
    strcpy(componentunit,<span class="stringliteral">&quot;&quot;</span>);
    strcpy(_fieldname,fieldnameprefix);
    <span class="keywordflow">if</span> ( <a class="code" href="a01004_ga8f73c6eb1a1b85f5e1e8bc1823c01ab9.html#ga8f73c6eb1a1b85f5e1e8bc1823c01ab9" title="Cette routine permet de créer un champ dans un fichier.">MEDfieldCr</a>(_fid,_fieldname,<a class="code" href="a00320_a7d730da9417184bffcdccc90a1749e27.html#a7d730da9417184bffcdccc90a1749e27ad44e111629f7a5811626b87c8b42b3ea">MED_FLOAT64</a>,nconstituentpervalue,componentname,componentunit,<span class="stringliteral">&quot;s&quot;</span>,_meshname ) &lt; 0) {
      <a class="code" href="a00349_a07852156956867e0134fc219d370b8d4.html#a07852156956867e0134fc219d370b8d4">MED_ERR_</a>(_ret,<a class="code" href="a00335_a92354d1153d9e053407f2f8c0dedbda7.html#a92354d1153d9e053407f2f8c0dedbda7">MED_ERR_CREATE</a>,<a class="code" href="a00335_a56c28cd068a46a59d0692b642a560324.html#a56c28cd068a46a59d0692b642a560324">MED_ERR_FIELD</a>,_fieldname);
      <span class="keywordflow">goto</span> ERROR;
    };
    free(componentname);
    free(componentunit);


    <span class="keywordflow">if</span> ( _ipoint &gt; 1 ) {

      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Creating a localization of integration points...&quot;</span>);
      strcpy(_ipointname,_fieldname);
      strcat(_ipointname,<span class="stringliteral">&quot;_loc&quot;</span>);

      <span class="comment">/*Attention ancienne spec*/</span>
      _ipointrefcoo = (<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> *) calloc(_geodim*_geonnodes,<span class="keyword">sizeof</span>(<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>));
      _ipointcoo    = (<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> *) calloc(_ipoint*_geodim,<span class="keyword">sizeof</span>(<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>));
      _ipointwg     = (<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a> *) calloc(_ipoint,<span class="keyword">sizeof</span>(<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>));

      <span class="keywordflow">if</span> (<a class="code" href="a01010_ga77e9d9cfe12058f20762fe61fbf14172.html#ga77e9d9cfe12058f20762fe61fbf14172" title="Cette routine permet l&amp;#39;écriture d&amp;#39;une localisation localizationname de points...">MEDlocalizationWr</a>(_fid, _ipointname, _geotype, _geotype/100, _ipointrefcoo, constituentmode,
                            _ipoint, _ipointcoo, _ipointwg, <a class="code" href="a00321_a3e7915fabbbc5946451ebbb836ca0816.html#a3e7915fabbbc5946451ebbb836ca0816">MED_NO_INTERPOLATION</a>, <a class="code" href="a00321_aeb44e16b6ecf0f5f8aeefab3e60a1a2c.html#aeb44e16b6ecf0f5f8aeefab3e60a1a2c">MED_NO_MESH_SUPPORT</a> ) &lt; 0) {
        <a class="code" href="a00349_a07852156956867e0134fc219d370b8d4.html#a07852156956867e0134fc219d370b8d4">MED_ERR_</a>(_ret,<a class="code" href="a00335_a92354d1153d9e053407f2f8c0dedbda7.html#a92354d1153d9e053407f2f8c0dedbda7">MED_ERR_CREATE</a>,<a class="code" href="a00335_ada54cea0286293e0c155a0dc7e006c4e.html#ada54cea0286293e0c155a0dc7e006c4e">MED_ERR_LOCALIZATION</a>,_ipointname);
        <a class="code" href="a00348_ae7ba0433e91c450cd44c3808c2acb497.html#ae7ba0433e91c450cd44c3808c2acb497">ISCRUTE_int</a>(constituentmode);
        <span class="keywordflow">goto</span> ERROR;
      }
      free(_ipointrefcoo );
      free(_ipointcoo    );
      free(_ipointwg     );

    } <span class="keywordflow">else</span> {
      strcpy(_ipointname,<a class="code" href="a00321_a2acd5f0b336ddb4026fe1dd314fbd1e0.html#a2acd5f0b336ddb4026fe1dd314fbd1e0">MED_NO_LOCALIZATION</a>);
    }

    <span class="keywordflow">if</span> (profilearraysize) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Creating a profile...&quot;</span>);

      strcpy(_profilename,_fieldname);strcat(_profilename,<span class="stringliteral">&quot;_profile&quot;</span>);

      _profilearray = (<a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>*) calloc(profilearraysize,<span class="keyword">sizeof</span>(<a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>));

      <span class="keywordflow">for</span> (_i=0; _i &lt; profilearraysize; ++_i) _profilearray[_i]=_i;
      <span class="keywordflow">if</span> ( <a class="code" href="a01013_gaf7ec6ed01898dcfe98556f399ed044d1.html#gaf7ec6ed01898dcfe98556f399ed044d1" title="Cette routine permet d&amp;#39;écrire un profil dans un fichier MED.">MEDprofileWr</a>(_fid,_profilename,profilearraysize,_profilearray) &lt; 0) {
        <a class="code" href="a00349_a07852156956867e0134fc219d370b8d4.html#a07852156956867e0134fc219d370b8d4">MED_ERR_</a>(_ret,<a class="code" href="a00335_a92354d1153d9e053407f2f8c0dedbda7.html#a92354d1153d9e053407f2f8c0dedbda7">MED_ERR_CREATE</a>,<a class="code" href="a00335_a422b2f1b0d06225813610e0527ab871e.html#a422b2f1b0d06225813610e0527ab871e">MED_ERR_PROFILE</a>,_profilename);
        <span class="keywordflow">goto</span> ERROR;
      };
      _nusedentities = profilearraysize;
    } <span class="keywordflow">else</span> {
      strcpy(_profilename,<a class="code" href="a00321_aaa89a5e5e6d32de69614b70cf74e29cc.html#aaa89a5e5e6d32de69614b70cf74e29cc">MED_NO_PROFILE</a>);
    }


    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Generating partition...&quot;</span>);
    getBlockOfEntities ( mpi_rank , mpi_size, _nusedentities,
                         &amp;_start, &amp;_stride, &amp;_io_count, &amp;_blocksize,
                         &amp;_lastusedrank, &amp;_lastblocksize);

    _count=_io_count;
    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Generating filter...&quot;</span>);
    <span class="keywordflow">if</span> ( <a class="code" href="a01006_ga9ceeb4d2bf17d106d7dc41b921962ec6.html#ga9ceeb4d2bf17d106d7dc41b921962ec6" title="Crée un filtre en selectionnant par blocs les entités pour lesquelles on veut lire/écrire...">MEDfilterBlockOfEntityCr</a>(_fid, nentities, nvaluesperentity, nconstituentpervalue,
                                  <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>, constituentmode, storagemode, _profilename,
                                  _start,_stride,_count,_blocksize,_lastblocksize,  &amp;filter) &lt; 0 ) {
        <a class="code" href="a00349_a07852156956867e0134fc219d370b8d4.html#a07852156956867e0134fc219d370b8d4">MED_ERR_</a>(_ret,<a class="code" href="a00335_a92354d1153d9e053407f2f8c0dedbda7.html#a92354d1153d9e053407f2f8c0dedbda7">MED_ERR_CREATE</a>,<a class="code" href="a00335_a2a30a97f3fd5a2961e657aeb19cccfb1.html#a2a30a97f3fd5a2961e657aeb19cccfb1">MED_ERR_FILTER</a>,<span class="stringliteral">&quot;&quot;</span>);
        <span class="keywordflow">goto</span> ERROR;
    }

    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Generating datas...&quot;</span>);
    generateDatas(mpi_rank, _lastusedrank, <span class="keyword">sizeof</span>(<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>),
                  storagemode, profilearraysize, _profilearray,
                  _start, _stride, _count, _blocksize, _lastblocksize,
                  nentities, nvaluesperentity, nconstituentpervalue,
                  &amp;_arrayvalues );

    <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Writing field...&quot;</span>);
    <span class="keywordflow">if</span> ( <a class="code" href="a01004_ga9e55366753425d010b8d1e95b1a53025.html#ga9e55366753425d010b8d1e95b1a53025" title="Cette routine permet d&amp;#39;écire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueAdvancedWr</a>(_fid,_fieldname,<a class="code" href="a00321_a8f72b6ceb3b6f5a67f9efd46cb90707a.html#a8f72b6ceb3b6f5a67f9efd46cb90707a">MED_NO_DT</a>,<a class="code" href="a00321_a95919207fd7a18ba26e6e03f04811e3f.html#a95919207fd7a18ba26e6e03f04811e3f">MED_NO_IT</a>,0.0, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>, _geotype,
                                 _ipointname, &amp;filter, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)_arrayvalues ) &lt; 0) {
      <a class="code" href="a00349_a07852156956867e0134fc219d370b8d4.html#a07852156956867e0134fc219d370b8d4">MED_ERR_</a>(_ret,<a class="code" href="a00335_ada9ad358d137c53e288ff59d49e45541.html#ada9ad358d137c53e288ff59d49e45541">MED_ERR_WRITE</a>,<a class="code" href="a00335_a56c28cd068a46a59d0692b642a560324.html#a56c28cd068a46a59d0692b642a560324">MED_ERR_FIELD</a>,_fieldname);
      <a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(mpi_rank);
      <span class="keywordflow">goto</span> ERROR;
    }

    <span class="comment">/* Test de lecture du même fichier avec filtre simple par un seul processeur */</span>
    <span class="comment">/* TODO : Créer MEDflush */</span>
    H5Fflush(_fid, H5F_SCOPE_GLOBAL );

    <span class="comment">/*Le flush suffit pas besoin de synchroniser les processus : MPI_Barrier(MPI_COMM_WORLD); */</span>
    <span class="keywordflow">if</span> (mpi_rank == 0 ) {
      <a class="code" href="a00348_a3756046b0a6a7e51b8eb544d0d77c17c.html#a3756046b0a6a7e51b8eb544d0d77c17c">MESSAGE</a>(<span class="stringliteral">&quot;Reading field...&quot;</span>);


      <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>    _nentitiesarrayvalues=0;
      <a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>  *_filteredarrayvalues=NULL;
      <a class="code" href="a00245.html" title="Filtre de sélection.">med_filter</a> filter2=<a class="code" href="a00321_a12fb4e45273e33fdbad01821ca0d3ea8.html#a12fb4e45273e33fdbad01821ca0d3ea8">MED_FILTER_INIT</a>;
      <span class="keywordtype">int</span>        _ind=0;
      FILE *     _asciifile;
      <span class="keywordtype">char</span>       _asciifilename[255]=<span class="stringliteral">&quot;&quot;</span>;


      <span class="keywordflow">if</span> ((_fidseq = <a class="code" href="a01005_ga9376a1654b7bf099c3f8941074c5fdfb.html#ga9376a1654b7bf099c3f8941074c5fdfb" title="Ouverture d&amp;#39;un fichier MED.">MEDfileOpen</a>(_filename, <a class="code" href="a00321_adcd0322de9fec3b5e199ffeda3f44c85.html#adcd0322de9fec3b5e199ffeda3f44c85a616bf8345c622a34f0787f42eb400f25">MED_ACC_RDONLY</a> )) &lt; 0){
        <a class="code" href="a00349_a07852156956867e0134fc219d370b8d4.html#a07852156956867e0134fc219d370b8d4">MED_ERR_</a>(_ret,<a class="code" href="a00335_a0bbda4699e6c5e9a9c3189b702e6f6e6.html#a0bbda4699e6c5e9a9c3189b702e6f6e6">MED_ERR_OPEN</a>,<a class="code" href="a00335_a768428f78b9f7416a35939e54404fca7.html#a768428f78b9f7416a35939e54404fca7">MED_ERR_FILE</a>,_filename);
        <span class="keywordflow">goto</span> ERROR;
      }

      sprintf(_asciifilename,<span class="stringliteral">&quot;%s_CPU-%03d_@_%s_%s.ascii&quot;</span>,fieldnameprefix,mpi_size,_MED_MODE_SWITCH_MSG[constituentmode],_MED_STORAGE_MODE_MSG[storagemode]);
      _asciifile=fopen(_asciifilename, <span class="stringliteral">&quot;w&quot;</span>);

      <span class="comment">/*Génère un filtre de selection simple s&apos;il n&apos;a pas déjà été généré lors d&apos;un précédent appel */</span>
      <span class="comment">/*TODO : Déplacer cette appel dans le main après avoir externaliser la génération du profile */</span>
      <span class="keywordflow">if</span> (!_filterarray)
        <span class="keywordflow">if</span> ( <a class="code" href="a00282_a388c7cc13e2d139b5518828c5979b041.html#a388c7cc13e2d139b5518828c5979b041">generateFilterArray</a>(  nentities,  nvaluesperentity, nconstituentpervalue,
                                   profilearraysize, _profilearray,
                                   &amp;_nentitiesfiltered, &amp;_filterarray ) &lt; 0 ) {
          <span class="keywordflow">goto</span> ERROR;
        }

      <a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(_nentitiesfiltered);
      <span class="comment">/*Stocke le filtre utilisé dans le fichier .ascii*/</span>
      <span class="keywordflow">for</span> (_i=0; _i &lt; _nentitiesfiltered; ++_i ) {
<span class="comment">/*      ISCRUTE(_filterarray[_i]); */</span>
        fprintf(_asciifile,<span class="stringliteral">&quot;%d &quot;</span>,_filterarray[_i]) ;
      }
      fprintf(_asciifile,<span class="stringliteral">&quot;\n&quot;</span>) ;


      <span class="comment">/*Pas de profile possible (profilearraysize == 0) en MED_GLOBAL_PFLMODE sur un fichier géré en parallel */</span>
      <span class="keywordflow">if</span> ( profilearraysize ) {
        _nentitiesarrayvalues = profilearraysize;
      } <span class="keywordflow">else</span> {
        _nentitiesarrayvalues = nentities;
      }

      <span class="comment">/*Attention allocation mémoire potentiellement grosse car réalisée uniquement par le processus 0</span>
<span class="comment">       qui rassemble les données.*/</span>
      _filteredarrayvalues = (<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>*) malloc(_nentitiesarrayvalues*
                                                 nvaluesperentity*
                                                 nconstituentpervalue*<span class="keyword">sizeof</span>(<a class="code" href="a00320_ab1eab99ca56ac95ce5b1c0e4ae0f095a.html#ab1eab99ca56ac95ce5b1c0e4ae0f095a">med_float</a>));

      <span class="comment">/* Permet de vérifier une erreur d&apos;indiçage après la lecture */</span>
      <span class="keywordflow">for</span> (_i=0;_i&lt;_nentitiesarrayvalues*nvaluesperentity*nconstituentpervalue; ++_i)
        _filteredarrayvalues[_i]=-_i;


      <span class="comment">/*Création d&apos;un filtre de sélection simple, pour une lecture séquentielle par le processys 0*/</span>
      <span class="keywordflow">if</span> ( <a class="code" href="a01006_ga8bd4fe1ea6e331d606b2b708a34d8b3b.html#ga8bd4fe1ea6e331d606b2b708a34d8b3b">MEDfilterEntityCr</a>(_fidseq, nentities, nvaluesperentity, nconstituentpervalue,
                             <a class="code" href="a00321_a65a18ab6db672a2d21312d1813a3bb19.html#a65a18ab6db672a2d21312d1813a3bb19">MED_ALL_CONSTITUENT</a>, constituentmode, storagemode, _profilename,
                             _nentitiesfiltered,_filterarray, &amp;filter2) &lt; 0 ) {
        <a class="code" href="a00349_a07852156956867e0134fc219d370b8d4.html#a07852156956867e0134fc219d370b8d4">MED_ERR_</a>(_ret,<a class="code" href="a00335_a92354d1153d9e053407f2f8c0dedbda7.html#a92354d1153d9e053407f2f8c0dedbda7">MED_ERR_CREATE</a>,<a class="code" href="a00335_a2a30a97f3fd5a2961e657aeb19cccfb1.html#a2a30a97f3fd5a2961e657aeb19cccfb1">MED_ERR_FILTER</a>,<span class="stringliteral">&quot;&quot;</span>);
        <span class="keywordflow">goto</span> ERROR;
      }

      <span class="keywordflow">if</span> ( <a class="code" href="a01004_ga404dad06b207dace4270b18140f173e0.html#ga404dad06b207dace4270b18140f173e0" title="Cette routine permet de lire les valeurs d&amp;#39;un champ définies sur des entités...">MEDfieldValueAdvancedRd</a>(_fidseq,_fieldname,<a class="code" href="a00321_a8f72b6ceb3b6f5a67f9efd46cb90707a.html#a8f72b6ceb3b6f5a67f9efd46cb90707a">MED_NO_DT</a>,<a class="code" href="a00321_a95919207fd7a18ba26e6e03f04811e3f.html#a95919207fd7a18ba26e6e03f04811e3f">MED_NO_IT</a>, <a class="code" href="a00321_aab0e957294723517d5c3641bb71b0470.html#aab0e957294723517d5c3641bb71b0470a227d14957ec5f221685cb1d6ec3b6c67">MED_CELL</a>, _geotype,
                                   &amp;filter2, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)_filteredarrayvalues ) &lt; 0) {
        <a class="code" href="a00349_a07852156956867e0134fc219d370b8d4.html#a07852156956867e0134fc219d370b8d4">MED_ERR_</a>(_ret,<a class="code" href="a00335_ac3d72eee2022402ffdc5851d2dc98584.html#ac3d72eee2022402ffdc5851d2dc98584">MED_ERR_READ</a>,<a class="code" href="a00335_a56c28cd068a46a59d0692b642a560324.html#a56c28cd068a46a59d0692b642a560324">MED_ERR_FIELD</a>,_fieldname);
        <a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(mpi_rank);
        <span class="keywordflow">goto</span> ERROR;
      }

      <span class="comment">/*AFFICHAGE TOUJOURS EN FULL INTERLACE QUELQUES SOIENT LES COMBINAISONS*/</span>
      <span class="comment">/*TODO : Externaliser l&apos;affichage*/</span>
      <span class="keywordflow">if</span> ( storagemode == <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da56cfcdcbbab7ddfc577de288697cd291">MED_GLOBAL_PFLMODE</a> ) {
        <span class="keywordflow">switch</span> (constituentmode) {
        <span class="keywordflow">case</span> <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>:
          <span class="keywordflow">for</span> (_i=0; _i &lt; _nentitiesfiltered; ++_i)
            <span class="keywordflow">for</span> (_j=0; _j &lt; nvaluesperentity; ++_j)
              <span class="keywordflow">for</span> (_k=0; _k &lt; nconstituentpervalue; ++_k) {
                _ind = (_filterarray[_i]-1)*nvaluesperentity*nconstituentpervalue+ _j*nconstituentpervalue+_k;
<span class="comment">/*              fprintf(stdout,&quot;%s%3d%s = %f\n&quot;,&quot;_filteredarrayvaluesFULLGLB[&quot;,_ind,&quot;]&quot;,_filteredarrayvalues[_ind]) ; */</span>
                fprintf(_asciifile,<span class="stringliteral">&quot;%f\n&quot;</span>,_filteredarrayvalues[_ind]) ;
              }
          <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa5c7f85d1c271fe5dbaf9e9f1d3211fea">MED_NO_INTERLACE</a>:
          <span class="keywordflow">for</span> (_j=0; _j &lt; _nentitiesfiltered; ++_j)
            <span class="keywordflow">for</span> (_k=0; _k &lt; nvaluesperentity; ++_k)
              <span class="keywordflow">for</span> (_i=0; _i &lt; nconstituentpervalue; ++_i) {
                _ind =_i*nentities*nvaluesperentity+ (_filterarray[_j]-1)*nvaluesperentity +_k;
<span class="comment">/*              fprintf(stdout,&quot;%s%3d%s = %f\n&quot;,&quot;_filteredarrayvaluesNOGLB[&quot;,_ind,&quot;]&quot;,_filteredarrayvalues[_ind]); */</span>
                fprintf(_asciifile,<span class="stringliteral">&quot;%f\n&quot;</span>,_filteredarrayvalues[_ind]);
              }
          <span class="keywordflow">break</span>;
        }
      }  <span class="keywordflow">else</span>
        <span class="keywordflow">switch</span> (constituentmode) {
        <span class="keywordflow">case</span> <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a>:
          <span class="keywordflow">for</span> (_i=0; _i &lt; _nentitiesfiltered; ++_i )
            <span class="keywordflow">for</span> (_j=0; _j &lt; nvaluesperentity; ++_j)
              <span class="keywordflow">for</span> (_k=0; _k &lt; nconstituentpervalue; ++_k) {
                _ind = (_filterarray[_i]-1)*nvaluesperentity*nconstituentpervalue+_j*nconstituentpervalue+_k;
<span class="comment">/*              fprintf(stdout,&quot;%s%3d%s = %f\n&quot;,&quot;_filteredarrayvaluesFULLCP[&quot;,_ind,&quot;]&quot;,_filteredarrayvalues[_ind]) ; */</span>
                fprintf(_asciifile,<span class="stringliteral">&quot;%f\n&quot;</span>,_filteredarrayvalues[_ind]) ;
          }
          <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa5c7f85d1c271fe5dbaf9e9f1d3211fea">MED_NO_INTERLACE</a>:
          <span class="keywordflow">for</span> (_j=0; _j &lt; _nentitiesfiltered; ++_j)
            <span class="keywordflow">for</span> (_k=0; _k &lt; nvaluesperentity; ++_k)
              <span class="keywordflow">for</span> (_i=0; _i &lt; nconstituentpervalue; ++_i) {
                _ind =_i*_nentitiesarrayvalues*nvaluesperentity+ (_filterarray[_j]-1)*nvaluesperentity +_k;
<span class="comment">/*              fprintf(stdout,&quot;%s%3d%s = %f\n&quot;,&quot;_filteredarrayvaluesNOCP[&quot;,_ind,&quot;]&quot;,_filteredarrayvalues[_ind]); */</span>
                fprintf(_asciifile,<span class="stringliteral">&quot;%f\n&quot;</span>,_filteredarrayvalues[_ind]);
              }
          <span class="keywordflow">break</span>;
        }


      free(_filteredarrayvalues);

      fclose(_asciifile);

      <span class="keywordflow">if</span> ( <a class="code" href="a01006_ga5e48f17469f18350f3dd1d9bee49e1fb.html#ga5e48f17469f18350f3dd1d9bee49e1fb" title="Désalloue les ressources hdf détenues par un filtre.">MEDfilterClose</a>(&amp;filter2) &lt; 0 ) {
        <a class="code" href="a00349_a07852156956867e0134fc219d370b8d4.html#a07852156956867e0134fc219d370b8d4">MED_ERR_</a>(_ret,<a class="code" href="a00335_a444c5e2cb5b9f60b769909297300ac14.html#a444c5e2cb5b9f60b769909297300ac14">MED_ERR_CLOSE</a>,<a class="code" href="a00335_a2a30a97f3fd5a2961e657aeb19cccfb1.html#a2a30a97f3fd5a2961e657aeb19cccfb1">MED_ERR_FILTER</a>,<span class="stringliteral">&quot;&quot;</span>);
        <span class="keywordflow">goto</span> ERROR;
      }

    } <span class="comment">/*fin if (mpi_rank == 0) */</span>

  <span class="keywordflow">if</span> ( <a class="code" href="a01006_ga5e48f17469f18350f3dd1d9bee49e1fb.html#ga5e48f17469f18350f3dd1d9bee49e1fb" title="Désalloue les ressources hdf détenues par un filtre.">MEDfilterClose</a>(&amp;filter) &lt; 0 ) {
    <a class="code" href="a00349_a07852156956867e0134fc219d370b8d4.html#a07852156956867e0134fc219d370b8d4">MED_ERR_</a>(_ret,<a class="code" href="a00335_a444c5e2cb5b9f60b769909297300ac14.html#a444c5e2cb5b9f60b769909297300ac14">MED_ERR_CLOSE</a>,<a class="code" href="a00335_a2a30a97f3fd5a2961e657aeb19cccfb1.html#a2a30a97f3fd5a2961e657aeb19cccfb1">MED_ERR_FILTER</a>,<span class="stringliteral">&quot;&quot;</span>);
    <span class="keywordflow">goto</span> ERROR;
  }


    _ret=0;
  ERROR:
    <span class="keywordflow">if</span> (_arrayvalues)     free(_arrayvalues);
    <span class="keywordflow">if</span> (profilearraysize) free(_profilearray);

    <span class="keywordflow">if</span> (  <a class="code" href="a01005_ga12a0e901c376be997a41a073ce426283.html#ga12a0e901c376be997a41a073ce426283" title="Fermeture d&amp;#39;un fichier MED.">MEDfileClose</a>(_fid) &lt; 0) {
      <a class="code" href="a00349_a07852156956867e0134fc219d370b8d4.html#a07852156956867e0134fc219d370b8d4">MED_ERR_</a>(_ret,<a class="code" href="a00335_a444c5e2cb5b9f60b769909297300ac14.html#a444c5e2cb5b9f60b769909297300ac14">MED_ERR_CLOSE</a>,<a class="code" href="a00335_a768428f78b9f7416a35939e54404fca7.html#a768428f78b9f7416a35939e54404fca7">MED_ERR_FILE</a>,<span class="stringliteral">&quot;&quot;</span>); _ret = -1;
    }

    <span class="keywordflow">if</span> (mpi_rank == 0 ) {
      <span class="keywordflow">if</span> (  <a class="code" href="a01005_ga12a0e901c376be997a41a073ce426283.html#ga12a0e901c376be997a41a073ce426283" title="Fermeture d&amp;#39;un fichier MED.">MEDfileClose</a>(_fidseq) &lt; 0) {
        <a class="code" href="a00349_a07852156956867e0134fc219d370b8d4.html#a07852156956867e0134fc219d370b8d4">MED_ERR_</a>(_ret,<a class="code" href="a00335_a444c5e2cb5b9f60b769909297300ac14.html#a444c5e2cb5b9f60b769909297300ac14">MED_ERR_CLOSE</a>,<a class="code" href="a00335_a768428f78b9f7416a35939e54404fca7.html#a768428f78b9f7416a35939e54404fca7">MED_ERR_FILE</a>,<span class="stringliteral">&quot;&quot;</span>); _ret = -1;
      }
    }

    <span class="keywordflow">return</span> _ret;
  }




  <span class="comment">/* MAIN */</span>
  <a class="code" href="a00320_abc4b2f6b68a545b7b3441b0d3d860629.html#abc4b2f6b68a545b7b3441b0d3d860629">med_size</a>            _nbblocksperproc    = 0;
  <span class="keywordtype">int</span>           _nentities             = 0;
  <span class="keywordtype">int</span>           _nvaluesperentity      = 0;
  <span class="keywordtype">int</span>           _nconstituentpervalue  = 0;

  <span class="keywordflow">if</span> (mpi_rank == 0 ) {

    <span class="keyword">struct </span>tm *_tm ;
    time_t _tt=time(0);
    _tm = localtime(&amp;_tt);

    srandom((*_tm).tm_sec * (*_tm).tm_min );
    _nbblocksperproc         = 1 + (int) (mpi_size * (random() / (RAND_MAX + 1.0)));
    _nentities            = 1 + (int) (1000.0 * (random() / (RAND_MAX + 1.0)));
    _nvaluesperentity     = 1 + (int) (11.0 * (random() / (RAND_MAX + 1.0)));
    _nconstituentpervalue = 1 + (int) (7.0 * (random() / (RAND_MAX + 1.0)));
<span class="comment">/*     _nbblocksperproc         = 1 + (int) (mpi_size * (random() / (RAND_MAX + 1.0))); */</span>
<span class="comment">/*     _nentities            = 1 + (int) (5.0 * (random() / (RAND_MAX + 1.0))); */</span>
<span class="comment">/*     _nvaluesperentity     = 1 + (int) (3.0 * (random() / (RAND_MAX + 1.0))); */</span>
<span class="comment">/*     _nconstituentpervalue = 1 + (int) (3.0 * (random() / (RAND_MAX + 1.0))); */</span>
<span class="comment">/*     _nbblocksperproc         = 2; */</span>
<span class="comment">/*     _nentities            = 4; */</span>
<span class="comment">/*     _nvaluesperentity     = 1; */</span>
<span class="comment">/*     _nconstituentpervalue = 1; */</span>

  }

  <span class="keywordflow">if</span> ( (<span class="keyword">sizeof</span>(<a class="code" href="a00320_abc4b2f6b68a545b7b3441b0d3d860629.html#abc4b2f6b68a545b7b3441b0d3d860629">med_size</a>)%(<span class="keyword">sizeof</span>(MPI_LONG)))==0 ) {

    MPI_Bcast(&amp;_nbblocksperproc         , <span class="keyword">sizeof</span>(<a class="code" href="a00320_abc4b2f6b68a545b7b3441b0d3d860629.html#abc4b2f6b68a545b7b3441b0d3d860629">med_size</a>)/<span class="keyword">sizeof</span>(MPI_LONG), MPI_LONG, 0, MPI_COMM_WORLD);
    MPI_Bcast(&amp;_nentities            , <span class="keyword">sizeof</span>(<a class="code" href="a00320_abc4b2f6b68a545b7b3441b0d3d860629.html#abc4b2f6b68a545b7b3441b0d3d860629">med_size</a>)/<span class="keyword">sizeof</span>(MPI_LONG), MPI_LONG, 0, MPI_COMM_WORLD);
    MPI_Bcast(&amp;_nvaluesperentity     , <span class="keyword">sizeof</span>(<a class="code" href="a00320_abc4b2f6b68a545b7b3441b0d3d860629.html#abc4b2f6b68a545b7b3441b0d3d860629">med_size</a>)/<span class="keyword">sizeof</span>(MPI_LONG), MPI_LONG, 0, MPI_COMM_WORLD);
    MPI_Bcast(&amp;_nconstituentpervalue , <span class="keyword">sizeof</span>(<a class="code" href="a00320_abc4b2f6b68a545b7b3441b0d3d860629.html#abc4b2f6b68a545b7b3441b0d3d860629">med_size</a>)/<span class="keyword">sizeof</span>(MPI_LONG), MPI_LONG, 0, MPI_COMM_WORLD);
  } <span class="keywordflow">else</span> {
    assert(<span class="keyword">sizeof</span>(<a class="code" href="a00320_abc4b2f6b68a545b7b3441b0d3d860629.html#abc4b2f6b68a545b7b3441b0d3d860629">med_size</a>) == (<span class="keyword">sizeof</span>(MPI_LONG)));
  }

  <span class="keywordtype">char</span>                _fieldnameprefix[256] = <span class="stringliteral">&quot;&quot;</span>;

  sprintf(_fieldnameprefix,<span class="stringliteral">&quot;NENT-%03d_NVAL-%03d_NCST-%03d_NBL-%03llu&quot;</span>,_nentities,_nvaluesperentity,
          _nconstituentpervalue,_nbblocksperproc);

  <a class="code" href="a00281_a61d073884976a932c07d21708877799c.html#a61d073884976a932c07d21708877799c">GenerateDataType</a> generateDatas = 0;
  <a class="code" href="a00321_a0d451e4036adbb12b14cb16d7db0c37d.html#a0d451e4036adbb12b14cb16d7db0c37d">med_switch_mode</a>  _switchmode  = <a class="code" href="a00321_a0d451e4036adbb12b14cb16d7db0c37d.html#a0d451e4036adbb12b14cb16d7db0c37da8c2ff3c323a55ab7c52781f9ca5b9fb4">MED_UNDEF_INTERLACE</a>;
  <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8d">med_storage_mode</a> _storagemode = <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da1d61fac0ada3cd4e77ded20e1e0a26d1">MED_UNDEF_PFLMODE</a>;
  <span class="comment">/*Pour que les 4 fichiers générés soient identiques, on désactive l&apos;utilisation des profils</span>
<span class="comment">    qui n&apos;est pas utilisable en mode GLOBAL et // */</span>
  <a class="code" href="a00320_a88dc15143f934cc7b771bc89f46372dc.html#a88dc15143f934cc7b771bc89f46372dc">med_int</a>          _profilearraysize=0;
  <span class="comment">/*   med_int       _profilearraysize=_nentities/2; */</span>

  <span class="keywordflow">for</span> (_switchmode = <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a> ; _switchmode &lt;= <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa5c7f85d1c271fe5dbaf9e9f1d3211fea">MED_NO_INTERLACE</a>; ++_switchmode) {

    <span class="keywordflow">if</span> ( _switchmode == <a class="code" href="a00320_a0ac861d71fe5e0be056a86f9212f1c6a.html#a0ac861d71fe5e0be056a86f9212f1c6aa9a1509b3f93e5915a24f555890c73ee1">MED_FULL_INTERLACE</a> ) generateDatas = <a class="code" href="a00280_aacb98bb0155d664e9d8a9626b9144bc3.html#aacb98bb0155d664e9d8a9626b9144bc3">generateFullIDatas</a>;
    <span class="keywordflow">else</span> generateDatas = <a class="code" href="a00280_aa5abc2daa1769bad363d8d7d935a3249.html#aa5abc2daa1769bad363d8d7d935a3249">generateNoIDatas</a>;

    <span class="keywordflow">for</span> (_storagemode = <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da56cfcdcbbab7ddfc577de288697cd291">MED_GLOBAL_PFLMODE</a> ; _storagemode &lt;= <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da285ff6474ec39fcb4c49b66a9376ec92">MED_COMPACT_PFLMODE</a>; ++_storagemode) {

      <span class="keywordflow">if</span> ( (_storagemode == <a class="code" href="a00321_a3f7b3a3c5ddcaba3fa1741a367503c8d.html#a3f7b3a3c5ddcaba3fa1741a367503c8da56cfcdcbbab7ddfc577de288697cd291">MED_GLOBAL_PFLMODE</a> ) &amp;&amp; (_profilearraysize) ) _profilearraysize=0;

      <span class="keywordflow">if</span> ( generateFieldFile( _nentities,  _nvaluesperentity, _nconstituentpervalue,
                              _switchmode, <a class="code" href="a00284_a9a1191a9ceaa2926cc07e5cdd38339cb.html#a9a1191a9ceaa2926cc07e5cdd38339cb">getCyclicBlocksOfEntities</a>, _nbblocksperproc, generateDatas,
                              _storagemode, _profilearraysize,  _fieldnameprefix ) &lt; 0 ) {
        <a class="code" href="a00349_a07852156956867e0134fc219d370b8d4.html#a07852156956867e0134fc219d370b8d4">MED_ERR_</a>(_ret,<a class="code" href="a00335_ada9ad358d137c53e288ff59d49e45541.html#ada9ad358d137c53e288ff59d49e45541">MED_ERR_WRITE</a>,<a class="code" href="a00335_a56c28cd068a46a59d0692b642a560324.html#a56c28cd068a46a59d0692b642a560324">MED_ERR_FIELD</a>,_fieldnameprefix);
        <a class="code" href="a00348_a818470a84d2ad18a3fbb48170296cd95.html#a818470a84d2ad18a3fbb48170296cd95">ISCRUTE</a>(mpi_rank);
        <span class="keywordflow">goto</span> ERROR;
      }

    }
  }


  _ret = 0;
 ERROR:

  <span class="keywordflow">if</span> (_filterarray) free(_filterarray);

  <span class="comment">/*pour arch. BLueGene : Sync entre GPFS et LSF : sleep(360) */</span>

  <span class="comment">/* MPI_Finalize must be called AFTER MEDclose which may use MPI calls */</span>
  MPI_Finalize();

  <span class="comment">/* Catcher l&apos;erreur en retour mpirun  et .sh*/</span>
  <span class="keywordflow">return</span> _ret;
}




</pre></div> <p><br/>
<br/>
  </p>
</div>
<hr size="1"/><address style="text-align: right;"><small>Généré le Mon Nov 19 15:43:44 2012 pour MED fichier par&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
